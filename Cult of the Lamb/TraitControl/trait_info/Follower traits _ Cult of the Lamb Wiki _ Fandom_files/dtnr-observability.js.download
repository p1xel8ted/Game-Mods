!function(){"use strict";function n(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=n[t];return o}function e(e,t){return function(n){if(Array.isArray(n))return n}(e)||function(n,e){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var o,r,i=[],a=!0,c=!1;try{for(t=t.call(n);!(a=(o=t.next()).done)&&(i.push(o.value),!e||i.length!==e);a=!0);}catch(n){c=!0,r=n}finally{try{a||null==t.return||t.return()}finally{if(c)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(o):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var t=function(){var n,t,o,r,i,a=(n="exp_bucket",(2===(null==(i=("; "+document.cookie).split("; "+n+"="))?void 0:i.length)&&null!==(r=null==i||null===(o=i.pop())||void 0===o||null===(t=o.split(";"))||void 0===t?void 0:t.shift())&&void 0!==r?r:null)||"");if(!/^v[0-9]+-[0-9]{2}$/.test(a))return/^[0-9]{1,2}$/.test(a)?{version:"",bucket:a,value:a}:{version:"",bucket:"",value:""};var c=e(a.split("-",2),2);return{version:c[0],bucket:c[1],value:a}},o=function(){var n=document.querySelector("html");if(!n)return"";var e=n.className.split(" "),t=new RegExp("^(?:sse|l2u)-([^-]+-\\d+)-(variant\\d+|control)$"),o=e.filter((function(n){return(n.startsWith("sse-")||n.startsWith("l2u-"))&&t.test(n)}));return o.length?o.map((function(n){var e=t.exec(n);return!e||e.length<3?null:"".concat(e[1],":").concat(e[2])})).filter(Boolean).join(","):""},r={},i=["exp_bucket","wikia_beacon_id","tracking_session_id","sessionId"],a=["prod","verify","sandbox","preview"];window.dtnrObservability=window.dtnrObservability||[];var c,l,s,u,d=function(n){var e=n.name;if(e&&i.includes(e)){var a=(r[e]||0)+1;if(r[e]=a,a>1&&a<=5){var c,l;console.warn("Cookie ".concat(e," has changed more than once!"),n);var s=null===(c=document.cookie)||void 0===c?void 0:c.length,u=null===(l=document.cookie)||void 0===l?void 0:l.split(";").length,d=n.domain,m="nope",w=f(),g=w.beaconId,b=w.sessionId;"wikia_beacon_id"===e&&g!==n.value&&(m="wikia_beacon_id",console.warn("Beacon ID changed from ".concat(g," to ").concat(n.value))),"tracking_session_id"===e&&b!==n.value&&(m="tracking_session_id",console.warn("Session ID changed from ".concat(b," to ").concat(n.value))),"sessionId"===e&&b!==n.value&&(m="sessionId",console.warn("Session ID changed from ".concat(b," to ").concat(n.value))),v(JSON.stringify({url:window.location.href,env:h(),counters:r,valueChanged:m,cookieDomain:d,cookiesLength:s,cookiesNumber:u,expBucket:t().bucket,expAssignment:o()}))}}},v=function(n){var e=a.includes(h())?"https://services.fandom.com":"https://services.fandom-dev.pl",t="".concat(e,"/frontend-metrics/dtnr/cookie-change");fetch(t,{method:"POST",mode:"no-cors",body:n}).then((function(n){return console.debug("response from cookie change tracking: ".concat(n.status))})).catch((function(n){return console.error("Error sending cookie change tracking request:",n)}))},f=function(){return window.fandomContext&&window.fandomContext.tracking?window.fandomContext.tracking:{beaconId:null,sessionId:null,pvUID:null}},h=function(){var n,e;return(null===(e=window)||void 0===e||null===(n=e.RLCONF)||void 0===n?void 0:n.wgWikiaEnvironment)||"dev"};u=t(),/^99$/.test(u.bucket)?(Date.now()>new Date("2025-12-03T12:00:00Z").getTime()&&(c=0,l=setInterval((function(){if(c>=5)clearInterval(l);else{var n=window.dtnrObservability.splice(0);n.length>0&&(c++,v(JSON.stringify({url:window.location.href,env:h(),msg:n.join(",")})))}}),1e3)),(s=window.cookieStore)?s.addEventListener?s.addEventListener("change",(function(n){try{var e=!0,t=!1,o=void 0;try{for(var r,i=n.changed[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;d(a)}}catch(n){t=!0,o=n}finally{try{e||null==i.return||i.return()}finally{if(t)throw o}}var c=!0,l=!1,s=void 0;try{for(var u,v=n.deleted[Symbol.iterator]();!(c=(u=v.next()).done);c=!0){var f=u.value;d(f)}}catch(n){l=!0,s=n}finally{try{c||null==v.return||v.return()}finally{if(l)throw s}}}catch(n){console.error("Failed to mark cookie change:",n)}})):console.warn("Cookie Store API does not support addEventListener."):console.warn("Cookie Store API is not supported in this browser.")):console.info("exp_bucket cookie is not set or has an invalid value. DTNR observability will not be initialized.")}();
