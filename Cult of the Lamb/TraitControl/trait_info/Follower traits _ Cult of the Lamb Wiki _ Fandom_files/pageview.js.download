!function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var t=function(){return t=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t},t.apply(this,arguments)},n={channelId:"default",host:window,coordinatorHost:window.top},e={connect:"connect",connected:"connected"},o="@wikia/post-quecast";function r(t){return t.channelId&&t.libId===o&&t.action&&function(t){return"string"==typeof t.type&&"number"==typeof t.timestamp}(t.action)}function i(t){return!t.data.private}function c(t,n){return t.data.channelId===n}function a(t){return t.data.action}var s=function(){function t(){}return t.make=function(t){return function(t){var n;return t.host===t.coordinatorHost&&!!(null===(n=t.coordinatorHost[o])||void 0===n?void 0:n.callbackConnector)}(t)?t.coordinatorHost[o].callbackConnector:new d({senderHost:t.coordinatorHost,listenerHost:t.host})},t}(),u=function(){function t(t){this.coordinatorHost=t,this.callbacks=[]}return t.prototype.dispatch=function(t){var n=this;if(!r(t))throw new Error("Incorrect object type. Expected PostMessageData, but got "+t);this.callbacks.forEach((function(e){return e({data:t,source:n.coordinatorHost})}))},t.prototype.addListener=function(t){this.callbacks.push(t)},t.prototype.removeListener=function(t){this.callbacks=this.callbacks.filter((function(n){return n!==t}))},t}(),d=function(){function t(t){this.options=t,this.map=new Map}return t.prototype.dispatch=function(t){if(!r(t))throw new Error("Incorrect object type. Expected PostMessageData, but got "+t);this.options.senderHost.postMessage(t,"*")},t.prototype.addListener=function(t){var n=function(n){var e;(e=n)&&e.source&&e.data&&r(e.data)&&t(n)};this.map.set(t,n),this.options.listenerHost.addEventListener("message",n)},t.prototype.removeListener=function(t){var n=this.map.get(t);this.options.listenerHost.removeEventListener("message",n),this.map.delete(t)},t}(),l=function(){function t(t){this.callbacks=[],this.history=[],this.channelId=t.channelId,this.connector=s.make(t),this.setupActions(),this.setupConnection()}return t.prototype.setupActions=function(){this.getHistory(),this.listenEvent()},t.prototype.getHistory=function(){var t=this,n=function(o){if(c(o,t.channelId)&&function(t){return!!t.data.private}(o)){var r=a(o);(function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];return n.some((function(n){return t.type===n}))})(r,e.connected)&&(t.connector.removeListener(n),t.handleActions.apply(t,r.history))}};this.connector.addListener(n)},t.prototype.listenEvent=function(){var t=this;this.connector.addListener((function(n){if(c(n,t.channelId)&&i(n)){var e=a(n);t.handleActions(e)}}))},t.prototype.handleActions=function(){for(var t,n=this,e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];(t=this.history).push.apply(t,e),e.forEach((function(t){return n.callbacks.forEach((function(n){return n(t)}))}))},t.prototype.setupConnection=function(){this.connector.dispatch({action:{type:e.connect,timestamp:Date.now()},channelId:this.channelId,private:!0,libId:o})},t.prototype.addListener=function(t){this.history.forEach((function(n){return t(n)})),this.callbacks.push(t)},t.prototype.removeListener=function(t){this.callbacks=this.callbacks.filter((function(n){return n!==t}))},t}(),p=function(){function e(e){void 0===e&&(e={});var o=t(t({},n),e);this.channelId=o.channelId,this.connector=s.make(o)}return e.prototype.dispatch=function(n){this.connector.dispatch({action:t(t({},n),{timestamp:Date.now()}),channelId:this.channelId,private:!0,libId:o})},e}(),h=function(){function e(e){void 0===e&&(e={});var o=t(t({},n),e);this.transmitter=new p(o),this.receiver=new l(o)}return e.prototype.dispatch=function(t){this.transmitter.dispatch(t)},e.prototype.addListener=function(t){this.receiver.addListener(t)},e.prototype.removeListener=function(t){this.receiver.removeListener(t)},e}(),f=function(){function t(t,n){this.channelId=t,this.connectors=new Map,this.history=[],this.connectors.set(n,n[o].callbackConnector)}return t.prototype.addConnection=function(t){this.ensureConnector(t).dispatch({action:this.createConnectedAction(),private:!0,channelId:this.channelId,libId:o})},t.prototype.createConnectedAction=function(){return{type:e.connected,history:this.history,timestamp:Date.now()}},t.prototype.broadcast=function(t){var n=this;this.history.push(t),this.connectors.forEach((function(e){e.dispatch({action:t,channelId:n.channelId,libId:o})}))},t.prototype.ensureConnector=function(t){return this.connectors.has(t)||this.connectors.set(t,new d({senderHost:t,listenerHost:t})),this.connectors.get(t)},t}(),v=function(){function t(t){this.coordinatorHost=t,this.channels=new Map,this.callbackConnector=new u(t),this.postMessageConnector=new d({senderHost:t,listenerHost:t})}return t.prototype.init=function(){var t=this,n=function(n){i(n)||(t.handleConnect(n),t.handleBroadcast(n))};this.callbackConnector.addListener(n),this.postMessageConnector.addListener(n)},t.prototype.handleConnect=function(t){(function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];return n.some((function(n){return t.data.action.type===n}))})(t,e.connect)&&this.ensureChannel(t.data.channelId).addConnection(t.source)},t.prototype.handleBroadcast=function(t){(function(t){return!Object.values(e).some((function(n){return t.data.action.type===n}))})(t)&&this.ensureChannel(t.data.channelId).broadcast(t.data.action)},t.prototype.ensureChannel=function(t){return this.channels.has(t)||this.channels.set(t,new f(t,this.coordinatorHost)),this.channels.get(t)},t}();var w=function(t){var n,e,o,r=("; "+document.cookie).split("; "+t+"=");return 2===(null==r?void 0:r.length)&&null!==(o=null==r||null===(e=r.pop())||void 0===e||null===(n=e.split(";"))||void 0===n?void 0:n.shift())&&void 0!==o?o:null};function y(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,o=new Array(n);e<n;e++)o[e]=t[e];return o}function m(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var o,r,i=[],c=!0,a=!1;try{for(e=e.call(t);!(c=(o=e.next()).done)&&(i.push(o.value),!n||i.length!==n);c=!0);}catch(t){a=!0,r=t}finally{try{c||null==e.return||e.return()}finally{if(a)throw r}}return i}}(t,n)||function(t,n){if(t){if("string"==typeof t)return y(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?y(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var b=window.EARLY_PV_ID?window.pvUID:window.crypto.randomUUID();window.EARLY_PV_ID||(window.RLQ=window.RLQ||[]).push((function(){var t;return null===(t=window.mw)||void 0===t?void 0:t.config.set("pvUID",b)})),window.DW_PV_SENT=!0,window.AMPLITUDE_PV_SENT=!0;var I=function(){var t,n=window.fandomContext.tracking,e=n.beaconId,o=n.sessionId,r=n.pvUID,i=n.pvNumber,c=n.pvNumberGlobal,a=window.RLCONF.wgTitle,s=window.RLCONF.wgUserId,u=window.RLCONF.viewTrackURL,d=null!==(t=w("_b2"))&&void 0!==t?t:"",l=function(){var t=w("exp_bucket")||"";if(!/^v[0-9]+-[0-9]{2}$/.test(t))return/^[0-9]{1,2}$/.test(t)?{version:"",bucket:t,value:t}:{version:"",bucket:"",value:""};var n=m(t.split("-",2),2);return{version:n[0],bucket:n[1],value:t}}();return{beaconId:e,sessionId:o,pvUID:r,pvNumber:i,pvNumberGlobal:c,title:a,userId:s,trackUrl:u,b2:d,expBucket:l.bucket,expBucketVersion:l.version,expBucket2:w("exp_bucket_2"),expData:function(){var t=document.querySelector("html");if(!t)return"";var n=t.className.split(" "),e=new RegExp("^(?:sse|l2u)-([^-]+-\\d+)-(variant\\d+|control)$"),o=n.filter((function(t){return(t.startsWith("sse-")||t.startsWith("l2u-"))&&e.test(t)}));return o.length?o.map((function(t){var n=e.exec(t);return!n||n.length<3?null:"".concat(n[1],":").concat(n[2])})).filter(Boolean).join(","):""}(),timeSinceTimeOrigin:"undefined"!=typeof performance&&"function"==typeof performance.now?Math.round(performance.now()):-1}},g=!1,k=function(){if(window.fandomContext.tracking){var t=I(),n=t.expBucket,e=t.expBucketVersion,o=t.expBucket2,r=t.expData,i=t.beaconId,c=t.sessionId,a=t.pvUID,s=t.pvNumber,u=t.pvNumberGlobal,d=t.title,l=t.userId,p=t.trackUrl,h=t.b2,f=t.timeSinceTimeOrigin;g||(g=!0,(window.RLQ=window.RLQ||[]).push((function(){var t,n;null===(t=window.mw)||void 0===t||t.config.set("beaconId",i),null===(n=window.mw)||void 0===n||n.config.set("b2",h)})),function(t,n,e,o,r,i,c,a,s,u,d,l,p,h){var f={pg:a,r:document.referrer,url:window.location.href,cb:(new Date).valueOf(),session_id:s,pv_unique_id:u,pv_number:d,pv_number_global:l,u:p||0,exp_bucket:n,exp_bucket_v:e,exp_bucket_2:o,exp_data:r,beacon:i,b2:c,tsto:h},v=Object.keys(f).filter((function(t){return f[t]||0===f[t]})).map((function(t){return"&"+encodeURIComponent(t)+"="+encodeURIComponent(f[t])})).join("");fetch(t+v,{mode:"no-cors",keepalive:!0})}(p,n,e,o,r,i,h,d,c,a,s,u,l,f))}};!function(){var t=function(t,e){var o=function(r){r.type===t&&(e(r),n.removeListener(o))};n.addListener(o)};!function(t){if(void 0===t&&(t=window),!t[o]){var n=new v(t);n.init(),t[o]=n}}();var n=new h;t("[AdEngine OptIn] set opt in",(function(n){var e=n.geoRequiresConsent?n.gdprConsent:!n.geoRequiresSignal||!n.ccpaSignal;t("[IdentityEngine] Fandom context set",(function(){e&&k()}))}))}()}();
