/*! For license information please see index.js.LICENSE.txt */
(()=>{var t,e,n={50:(t,e,n)=>{"use strict";n.d(e,{e:()=>i});const i=["ai","aw","ax","at","be","bg","bm","vg","br","bq","ky","hr","cw","cy","cz","dk","ee","fk","fo","fi","fr","gf","pf","tf","de","gi","gr","gl","gp","hu","is","ie","im","it","re","lv","li","lt","lu","mq","mt","yt","ms","nl","nc","no","pn","pl","pt","ro","bl","sh","mf","pm","bq","sx","sk","si","es","se","ch","tc","gb","uk","wf","ad","cn"]},115:(t,e,n)=>{var i;!function(t){!function(){var e="object"==typeof globalThis?globalThis:"object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:function(){throw new ReferenceError("globalThis could not be found. Please polyfill globalThis before loading this module.")}(),i=o(t);function o(t,e){return function(n,i){Object.defineProperty(t,n,{configurable:!0,writable:!0,value:i}),e&&e(n,i)}}void 0!==e.Reflect&&(i=o(e.Reflect,i)),function(t,e){var n="function"==typeof Symbol,i=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:_("Symbol.toPrimitive not found."),o=n&&void 0!==Symbol.iterator?Symbol.iterator:_("Symbol.iterator not found."),r=Object.getPrototypeOf(Function),s="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:_("A valid Map constructor could not be found."),a="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:_("A valid Set constructor could not be found."),c="function"==typeof WeakMap?WeakMap:_("A valid WeakMap constructor could not be found."),d=n?Symbol.for("@reflect-metadata:registry"):void 0,u=function(){var t;return!b(d)&&S(e.Reflect)&&Object.isExtensible(e.Reflect)&&(t=e.Reflect[d]),b(t)&&(t=function(){var t,n,i,o;b(d)||void 0===e.Reflect||d in e.Reflect||"function"!=typeof e.Reflect.defineMetadata||(t=function(t){var e=t.defineMetadata,n=t.hasOwnMetadata,i=t.getOwnMetadata,o=t.getOwnMetadataKeys,r=t.deleteMetadata,s=new c;return{isProviderFor:function(t,e){var n=s.get(t);return!(b(n)||!n.has(e))||!!o(t,e).length&&(b(n)&&(n=new a,s.set(t,n)),n.add(e),!0)},OrdinaryDefineOwnMetadata:e,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:i,OrdinaryOwnMetadataKeys:o,OrdinaryDeleteMetadata:r}}(e.Reflect));var r=new c,u={registerProvider:l,getProvider:g,setProvider:f};return u;function l(e){if(!Object.isExtensible(u))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case t===e:break;case b(n):n=e;break;case n===e:break;case b(i):i=e;break;case i===e:break;default:void 0===o&&(o=new a),o.add(e)}}function h(e,r){if(!b(n)){if(n.isProviderFor(e,r))return n;if(!b(i)){if(i.isProviderFor(e,r))return n;if(!b(o))for(var s=A(o);;){var a=P(s);if(!a)return;var c=M(a);if(c.isProviderFor(e,r))return R(s),c}}}if(!b(t)&&t.isProviderFor(e,r))return t}function g(t,e){var n,i=r.get(t);return b(i)||(n=i.get(e)),b(n)?(b(n=h(t,e))||(b(i)&&(i=new s,r.set(t,i)),i.set(e,n)),n):n}function p(t){if(b(t))throw new TypeError;return n===t||i===t||!b(o)&&o.has(t)}function f(t,e,n){if(!p(n))throw new Error("Metadata provider not registered.");var i=g(t,e);if(i!==n){if(!b(i))return!1;var o=r.get(t);b(o)&&(o=new s,r.set(t,o)),o.set(e,n)}return!0}}()),!b(d)&&S(e.Reflect)&&Object.isExtensible(e.Reflect)&&Object.defineProperty(e.Reflect,d,{enumerable:!1,configurable:!1,writable:!1,value:t}),t}(),l=function(t){var e=new c,n={isProviderFor:function(t,n){var i=e.get(t);return!b(i)&&i.has(n)},OrdinaryDefineOwnMetadata:function(t,e,n,o){i(n,o,!0).set(t,e)},OrdinaryHasOwnMetadata:function(t,e,n){var o=i(e,n,!1);return!b(o)&&T(o.has(t))},OrdinaryGetOwnMetadata:function(t,e,n){var o=i(e,n,!1);if(!b(o))return o.get(t)},OrdinaryOwnMetadataKeys:function(t,e){var n=[],o=i(t,e,!1);if(b(o))return n;for(var r=A(o.keys()),s=0;;){var a=P(r);if(!a)return n.length=s,n;var c=M(a);try{n[s]=c}catch(t){try{R(r)}finally{throw t}}s++}},OrdinaryDeleteMetadata:function(t,n,o){var r=i(n,o,!1);if(b(r))return!1;if(!r.delete(t))return!1;if(0===r.size){var s=e.get(n);b(s)||(s.delete(o),0===s.size&&e.delete(s))}return!0}};return u.registerProvider(n),n;function i(i,o,r){var a=e.get(i),c=!1;if(b(a)){if(!r)return;a=new s,e.set(i,a),c=!0}var d=a.get(o);if(b(d)){if(!r)return;if(d=new s,a.set(o,d),!t.setProvider(i,o,n))throw a.delete(o),c&&e.delete(i),new Error("Wrong provider for target.")}return d}}(u);function h(t,e,n){if(g(t,e,n))return!0;var i=x(e);return!C(i)&&h(t,i,n)}function g(t,e,n){var i=L(e,n,!1);return!b(i)&&T(i.OrdinaryHasOwnMetadata(t,e,n))}function p(t,e,n){if(g(t,e,n))return f(t,e,n);var i=x(e);return C(i)?void 0:p(t,i,n)}function f(t,e,n){var i=L(e,n,!1);if(!b(i))return i.OrdinaryGetOwnMetadata(t,e,n)}function v(t,e,n,i){L(n,i,!0).OrdinaryDefineOwnMetadata(t,e,n,i)}function m(t,e){var n=y(t,e),i=x(t);if(null===i)return n;var o=m(i,e);if(o.length<=0)return n;if(n.length<=0)return o;for(var r=new a,s=[],c=0,d=n;c<d.length;c++){var u=d[c];r.has(u)||(r.add(u),s.push(u))}for(var l=0,h=o;l<h.length;l++)u=h[l],r.has(u)||(r.add(u),s.push(u));return s}function y(t,e){var n=L(t,e,!1);return n?n.OrdinaryOwnMetadataKeys(t,e):[]}function w(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function b(t){return void 0===t}function C(t){return null===t}function S(t){return"object"==typeof t?null!==t:"function"==typeof t}function k(t,e){switch(w(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",o=j(t,i);if(void 0!==o){var r=o.call(t,n);if(S(r))throw new TypeError;return r}return function(t,e){if("string"===e){var n=t.toString;if(I(n)&&!S(o=n.call(t)))return o;if(I(i=t.valueOf)&&!S(o=i.call(t)))return o}else{var i;if(I(i=t.valueOf)&&!S(o=i.call(t)))return o;var o,r=t.toString;if(I(r)&&!S(o=r.call(t)))return o}throw new TypeError}(t,"default"===n?"number":n)}function T(t){return!!t}function O(t){var e=k(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function E(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function I(t){return"function"==typeof t}function Q(t){return"function"==typeof t}function j(t,e){var n=t[e];if(null!=n){if(!I(n))throw new TypeError;return n}}function A(t){var e=j(t,o);if(!I(e))throw new TypeError;var n=e.call(t);if(!S(n))throw new TypeError;return n}function M(t){return t.value}function P(t){var e=t.next();return!e.done&&e}function R(t){var e=t.return;e&&e.call(t)}function x(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===r)return e;if(e!==r)return e;var n=t.prototype,i=n&&Object.getPrototypeOf(n);if(null==i||i===Object.prototype)return e;var o=i.constructor;return"function"!=typeof o||o===t?e:o}function _(t){throw t}function L(t,e,n){var i=u.getProvider(t,e);if(!b(i))return i;if(n){if(u.setProvider(t,e,l))return l;throw new Error("Illegal state.")}}t("decorate",function(t,e,n,i){if(b(n)){if(!E(t))throw new TypeError;if(!Q(e))throw new TypeError;return function(t,e){for(var n=t.length-1;n>=0;--n){var i=(0,t[n])(e);if(!b(i)&&!C(i)){if(!Q(i))throw new TypeError;e=i}}return e}(t,e)}if(!E(t))throw new TypeError;if(!S(e))throw new TypeError;if(!S(i)&&!b(i)&&!C(i))throw new TypeError;return C(i)&&(i=void 0),function(t,e,n,i){for(var o=t.length-1;o>=0;--o){var r=(0,t[o])(e,n,i);if(!b(r)&&!C(r)){if(!S(r))throw new TypeError;i=r}}return i}(t,e,n=O(n),i)}),t("metadata",function(t,e){return function(n,i){if(!S(n))throw new TypeError;if(!b(i)&&!function(t){switch(w(t)){case 3:case 4:return!0;default:return!1}}(i))throw new TypeError;v(t,e,n,i)}}),t("defineMetadata",function(t,e,n,i){if(!S(n))throw new TypeError;return b(i)||(i=O(i)),v(t,e,n,i)}),t("hasMetadata",function(t,e,n){if(!S(e))throw new TypeError;return b(n)||(n=O(n)),h(t,e,n)}),t("hasOwnMetadata",function(t,e,n){if(!S(e))throw new TypeError;return b(n)||(n=O(n)),g(t,e,n)}),t("getMetadata",function(t,e,n){if(!S(e))throw new TypeError;return b(n)||(n=O(n)),p(t,e,n)}),t("getOwnMetadata",function(t,e,n){if(!S(e))throw new TypeError;return b(n)||(n=O(n)),f(t,e,n)}),t("getMetadataKeys",function(t,e){if(!S(t))throw new TypeError;return b(e)||(e=O(e)),m(t,e)}),t("getOwnMetadataKeys",function(t,e){if(!S(t))throw new TypeError;return b(e)||(e=O(e)),y(t,e)}),t("deleteMetadata",function(t,e,n){if(!S(e))throw new TypeError;b(n)||(n=O(n));var i=L(e,n,!1);return!b(i)&&i.OrdinaryDeleteMetadata(t,e,n)})}(i,e),void 0===e.Reflect&&(e.Reflect=t)}()}(i||(i={}))},117:(t,e,n)=>{"use strict";var i;n.d(e,{kL:()=>E,cb:()=>g,WQ:()=>Q,_G:()=>j,Gr:()=>A}),function(t){t[t.Transient=0]="Transient",t[t.Singleton=1]="Singleton",t[t.ResolutionScoped=2]="ResolutionScoped",t[t.ContainerScoped=3]="ContainerScoped"}(i||(i={}));const o=i;var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},r(t,e)};function s(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function a(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function d(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}function u(t){return!!t.useClass}function l(t){return!!t.useFactory}var h=function(){function t(t){this.wrap=t,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return t.prototype.createProxy=function(t){var e,n=this,i=!1;return new Proxy({},this.createHandler(function(){return i||(e=t(n.wrap()),i=!0),e}))},t.prototype.createHandler=function(t){var e={};return this.reflectMethods.forEach(function(n){e[n]=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e[0]=t(),Reflect[n].apply(void 0,d(e))}}),e},t}();function g(t){if(void 0===t)throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new h(t)}function p(t){return"string"==typeof t||"symbol"==typeof t}function f(t){return"object"==typeof t&&"token"in t&&"transform"in t}function v(t){return!!t.useToken}function m(t){return null!=t.useValue}const y=function(){function t(){this._registryMap=new Map}return t.prototype.entries=function(){return this._registryMap.entries()},t.prototype.getAll=function(t){return this.ensure(t),this._registryMap.get(t)},t.prototype.get=function(t){this.ensure(t);var e=this._registryMap.get(t);return e[e.length-1]||null},t.prototype.set=function(t,e){this.ensure(t),this._registryMap.get(t).push(e)},t.prototype.setAll=function(t,e){this._registryMap.set(t,e)},t.prototype.has=function(t){return this.ensure(t),this._registryMap.get(t).length>0},t.prototype.clear=function(){this._registryMap.clear()},t.prototype.ensure=function(t){this._registryMap.has(t)||this._registryMap.set(t,[])},t}(),w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(y),b=function(){this.scopedResolutions=new Map};var C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(y),S=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(y);const k=function(){this.preResolution=new C,this.postResolution=new S};var T=new Map,O=function(){function t(t){this.parent=t,this._registry=new w,this.interceptors=new k,this.disposed=!1,this.disposables=new Set}return t.prototype.register=function(t,e,n){var i;if(void 0===n&&(n={lifecycle:o.Transient}),this.ensureNotDisposed(),i=function(t){return u(t)||m(t)||v(t)||l(t)}(e)?e:{useClass:e},v(i))for(var r=[t],s=i;null!=s;){var a=s.useToken;if(r.includes(a))throw new Error("Token registration cycle detected! "+d(r,[a]).join(" -> "));r.push(a);var c=this._registry.get(a);s=c&&v(c.provider)?c.provider:null}if((n.lifecycle===o.Singleton||n.lifecycle==o.ContainerScoped||n.lifecycle==o.ResolutionScoped)&&(m(i)||l(i)))throw new Error('Cannot use lifecycle "'+o[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(t,{provider:i,options:n}),this},t.prototype.registerType=function(t,e){return this.ensureNotDisposed(),p(e)?this.register(t,{useToken:e}):this.register(t,{useClass:e})},t.prototype.registerInstance=function(t,e){return this.ensureNotDisposed(),this.register(t,{useValue:e})},t.prototype.registerSingleton=function(t,e){if(this.ensureNotDisposed(),p(t)){if(p(e))return this.register(t,{useToken:e},{lifecycle:o.Singleton});if(e)return this.register(t,{useClass:e},{lifecycle:o.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=t;return e&&!p(e)&&(n=e),this.register(t,{useClass:n},{lifecycle:o.Singleton})},t.prototype.resolve=function(t,e){void 0===e&&(e=new b),this.ensureNotDisposed();var n=this.getRegistration(t);if(!n&&p(t))throw new Error('Attempted to resolve unregistered dependency token: "'+t.toString()+'"');if(this.executePreResolutionInterceptor(t,"Single"),n){var i=this.resolveRegistration(n,e);return this.executePostResolutionInterceptor(t,i,"Single"),i}if(function(t){return"function"==typeof t||t instanceof h}(t))return i=this.construct(t,e),this.executePostResolutionInterceptor(t,i,"Single"),i;throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},t.prototype.executePreResolutionInterceptor=function(t,e){var n,i;if(this.interceptors.preResolution.has(t)){var o=[];try{for(var r=a(this.interceptors.preResolution.getAll(t)),s=r.next();!s.done;s=r.next()){var c=s.value;"Once"!=c.options.frequency&&o.push(c),c.callback(t,e)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(t,o)}},t.prototype.executePostResolutionInterceptor=function(t,e,n){var i,o;if(this.interceptors.postResolution.has(t)){var r=[];try{for(var s=a(this.interceptors.postResolution.getAll(t)),c=s.next();!c.done;c=s.next()){var d=c.value;"Once"!=d.options.frequency&&r.push(d),d.callback(t,e,n)}}catch(t){i={error:t}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(t,r)}},t.prototype.resolveRegistration=function(t,e){if(this.ensureNotDisposed(),t.options.lifecycle===o.ResolutionScoped&&e.scopedResolutions.has(t))return e.scopedResolutions.get(t);var n,i=t.options.lifecycle===o.Singleton,r=t.options.lifecycle===o.ContainerScoped,s=i||r;return n=m(t.provider)?t.provider.useValue:v(t.provider)?s?t.instance||(t.instance=this.resolve(t.provider.useToken,e)):this.resolve(t.provider.useToken,e):u(t.provider)?s?t.instance||(t.instance=this.construct(t.provider.useClass,e)):this.construct(t.provider.useClass,e):l(t.provider)?t.provider.useFactory(this):this.construct(t.provider,e),t.options.lifecycle===o.ResolutionScoped&&e.scopedResolutions.set(t,n),n},t.prototype.resolveAll=function(t,e){var n=this;void 0===e&&(e=new b),this.ensureNotDisposed();var i=this.getAllRegistrations(t);if(!i&&p(t))throw new Error('Attempted to resolve unregistered dependency token: "'+t.toString()+'"');if(this.executePreResolutionInterceptor(t,"All"),i){var o=i.map(function(t){return n.resolveRegistration(t,e)});return this.executePostResolutionInterceptor(t,o,"All"),o}var r=[this.construct(t,e)];return this.executePostResolutionInterceptor(t,r,"All"),r},t.prototype.isRegistered=function(t,e){return void 0===e&&(e=!1),this.ensureNotDisposed(),this._registry.has(t)||e&&(this.parent||!1)&&this.parent.isRegistered(t,!0)},t.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},t.prototype.clearInstances=function(){var t,e;this.ensureNotDisposed();try{for(var n=a(this._registry.entries()),i=n.next();!i.done;i=n.next()){var o=c(i.value,2),r=o[0],s=o[1];this._registry.setAll(r,s.filter(function(t){return!m(t.provider)}).map(function(t){return t.instance=void 0,t}))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t.prototype.createChildContainer=function(){var e,n;this.ensureNotDisposed();var i=new t(this);try{for(var r=a(this._registry.entries()),s=r.next();!s.done;s=r.next()){var d=c(s.value,2),u=d[0],l=d[1];l.some(function(t){return t.options.lifecycle===o.ContainerScoped})&&i._registry.setAll(u,l.map(function(t){return t.options.lifecycle===o.ContainerScoped?{provider:t.provider,options:t.options}:t}))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return i},t.prototype.beforeResolution=function(t,e,n){void 0===n&&(n={frequency:"Always"}),this.interceptors.preResolution.set(t,{callback:e,options:n})},t.prototype.afterResolution=function(t,e,n){void 0===n&&(n={frequency:"Always"}),this.interceptors.postResolution.set(t,{callback:e,options:n})},t.prototype.dispose=function(){return t=this,e=void 0,i=function(){var t;return function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,function(e){switch(e.label){case 0:return this.disposed=!0,t=[],this.disposables.forEach(function(e){var n=e.dispose();n&&t.push(n)}),[4,Promise.all(t)];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,r){function s(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}c((i=i.apply(t,e||[])).next())});var t,e,n,i},t.prototype.getRegistration=function(t){return this.isRegistered(t)?this._registry.get(t):this.parent?this.parent.getRegistration(t):null},t.prototype.getAllRegistrations=function(t){return this.isRegistered(t)?this._registry.getAll(t):this.parent?this.parent.getAllRegistrations(t):null},t.prototype.construct=function(t,e){var n=this;if(t instanceof h)return t.createProxy(function(t){return n.resolve(t,e)});var i,o=function(){var i=T.get(t);if(!i||0===i.length){if(0===t.length)return new t;throw new Error('TypeInfo not known for "'+t.name+'"')}var o=i.map(n.resolveParams(e,t));return new(t.bind.apply(t,d([void 0],o)))}();return"function"!=typeof(i=o).dispose||i.dispose.length>0||this.disposables.add(o),o},t.prototype.resolveParams=function(t,e){var n=this;return function(i,o){var r,s,a,u;try{return"object"==typeof(u=i)&&"token"in u&&"multiple"in u?f(i)?i.multiple?(r=n.resolve(i.transform)).transform.apply(r,d([n.resolveAll(i.token)],i.transformArgs)):(s=n.resolve(i.transform)).transform.apply(s,d([n.resolve(i.token,t)],i.transformArgs)):i.multiple?n.resolveAll(i.token):n.resolve(i.token,t):f(i)?(a=n.resolve(i.transform,t)).transform.apply(a,d([n.resolve(i.token,t)],i.transformArgs)):n.resolve(i,t)}catch(t){throw new Error(function(t,e,n){var i,o,r,s,a=c(t.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1];return i="Cannot inject the dependency "+(s=e,(null===(r=void 0===a?null:a)?"at position #"+s:'"'+r.split(",")[s].trim()+'" at position #'+s)+' of "')+t.name+'" constructor. Reason:',void 0===o&&(o="    "),d([i],n.message.split("\n").map(function(t){return o+t})).join("\n")}(e,o,t))}}},t.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},t}(),E=new O,I="injectionTokens";const Q=function(t){return e=t,function(t,n,i){var o=Reflect.getOwnMetadata(I,t)||{};o[i]=e,Reflect.defineMetadata(I,o,t)};var e},j=function(){return function(t){T.set(t,function(t){var e=Reflect.getMetadata("design:paramtypes",t)||[],n=Reflect.getOwnMetadata(I,t)||{};return Object.keys(n).forEach(function(t){e[+t]=n[t]}),e}(t))}},A=function(){return function(t){j()(t),E.registerSingleton(t)}};if("undefined"==typeof Reflect||!Reflect.getMetadata)throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.")},205:(t,e,n)=>{"use strict";var i;function o(t,e){const n=new Date,i=Math.floor(t>=0?t:0);return new Date(n.getTime()+i*e)}n.d(e,{S:()=>o,y:()=>i}),function(t){t[t.SECONDS=1e3]="SECONDS",t[t.MINUTES=6e4]="MINUTES",t[t.HOURS=36e5]="HOURS",t[t.DAYS=864e5]="DAYS",t[t.WEEKS=6048e5]="WEEKS",t[t.MONTHS=2592e6]="MONTHS",t[t.YEARS=31536e6]="YEARS"}(i||(i={}))},312:(t,e,n)=>{"use strict";function i(t,e=10,n=50,i=0){return new Promise((o,r)=>{i?function(t,e,n,i,o,r){let s=0;const a=()=>t()?o():s>=e?r():(s++,void setTimeout(a,n+i*s));setTimeout(a,n)}(t,e,n,i,o,r):function(t,e,n,i,o){let r=0;const s=setInterval(()=>{t()&&(clearInterval(s),i()),r++>e&&(clearInterval(s),o())},n)}(t,e,n,o,r)})}n.d(e,{f:()=>i})},482:(t,e,n)=>{"use strict";function i(t,e,n,i){var o,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,n,s):o(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s}function o(t,e){return function(n,i){e(n,i,t)}}function r(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{c(i.next(t))}catch(t){r(t)}}function a(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}c((i=i.apply(t,e||[])).next())})}n.d(e,{Cg:()=>i,Qj:()=>o,sH:()=>r}),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError},676:(t,e,n)=>{"use strict";n.d(e,{AZ:()=>i,Os:()=>h,aK:()=>l,db:()=>d,h5:()=>c,i9:()=>u,jf:()=>r,kW:()=>o,kk:()=>s,m$:()=>a});const i=Symbol("COOKIES"),o=Symbol("NAVIGATOR"),r=Symbol("WINDOW"),s=Symbol("UUID"),a=(Symbol("SENTRY"),Symbol("GEO")),c=Symbol("BROWSER"),d=Symbol("DEVICE"),u=Symbol("PLATFORM"),l=Symbol("SKIN"),h=Symbol("OPERATING_SYSTEM")},741:(t,e,n)=>{"use strict";n.d(e,{GZ:()=>a,K6:()=>r,Ri:()=>o,TV:()=>s});var i=n(205);const o=t=>{const e=("; "+document.cookie).split("; "+t+"=");return e.length>=2?e.pop().split(";").shift():null},r=(t=window.location.hostname)=>{const e=t.split(".");return e.length<2?t:`.${e[e.length-2]}.${e[e.length-1]}`},s=(t,e,n=365)=>{const o=(0,i.S)(n,i.y.DAYS);document.cookie=`${t}=${e}; domain=${r()}; path=/; SameSite=Lax; expires=${o.toUTCString()}`},a=()=>{const t=o("Geo");try{return null!==t?JSON.parse(decodeURIComponent(t)):{}}catch(t){return{}}}},888:(t,e,n)=>{"use strict";n.d(e,{_U:()=>c,Aw:()=>u,U4:()=>d});var i=n(482),o=n(50),r=n(741);const s="ZZ",a={country:s,region:s,continent:s},c=()=>(0,i.sH)(void 0,void 0,void 0,function*(){const t=(0,r.GZ)();if((null==t?void 0:t.country)&&(null==t?void 0:t.region)&&(null==t?void 0:t.continent))return t;try{const t=yield function(t){return(0,i.sH)(this,arguments,void 0,function*(t,e=1e3,n={}){const i=new AbortController,o=setTimeout(()=>i.abort("The request has timed out"),e);try{const e=yield fetch(t,Object.assign({signal:i.signal},n));return clearTimeout(o),e}finally{clearTimeout(o)}})}("https://services.fandom.com/geoip/location");if(!t.ok)return a;const{country_code:e,region:n,continent_code:o}=yield t.json();return{country:e,region:n,continent:o}}catch(t){return a}}),d=t=>{(0,r.Ri)("Geo")||(0,r.TV)("Geo",encodeURIComponent(JSON.stringify(t)),365)},u=t=>{var e,n;return o.e.includes(null!==(n=null===(e=null==t?void 0:t.country)||void 0===e?void 0:e.toLowerCase())&&void 0!==n?n:s)}}},i={};function o(t){var e=i[t];if(void 0!==e)return e.exports;var r=i[t]={exports:{}};return n[t](r,r.exports,o),r.exports}o.m=n,o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce((e,n)=>(o.f[n](t,e),e),[])),o.u=t=>({319:"static-consents",852:"cookiebot"}[t]+".js"),o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="identity-engine:",o.l=(n,i,r,s)=>{if(t[n])t[n].push(i);else{var a,c;if(void 0!==r)for(var d=document.getElementsByTagName("script"),u=0;u<d.length;u++){var l=d[u];if(l.getAttribute("src")==n||l.getAttribute("data-webpack")==e+r){a=l;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",e+r),a.src=n),t[n]=[i];var h=(e,i)=>{a.onerror=a.onload=null,clearTimeout(g);var o=t[n];if(delete t[n],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach(t=>t(i)),e)return e(i)},g=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=n[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={57:0};o.f.j=(e,n)=>{var i=o.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise((n,o)=>i=t[e]=[n,o]);n.push(i[2]=r);var s=o.p+o.u(e),a=new Error;o.l(s,n=>{if(o.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+s+")",a.name="ChunkLoadError",a.type=r,a.request=s,i[1](a)}},"chunk-"+e,e)}};var e=(e,n)=>{var i,r,[s,a,c]=n,d=0;if(s.some(e=>0!==t[e])){for(i in a)o.o(a,i)&&(o.m[i]=a[i]);c&&c(o)}for(e&&e(n);d<s.length;d++)r=s[d],o.o(t,r)&&t[r]&&t[r][0](),t[r]=0},n=self.webpackChunkidentity_engine=self.webpackChunkidentity_engine||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),(()=>{"use strict";var t=o(482),e=(o(115),o(117));function n(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}var i,r=function t(e,i){function o(t,o,r){if("undefined"!=typeof document){"number"==typeof(r=n({},i,r)).expires&&(r.expires=new Date(Date.now()+864e5*r.expires)),r.expires&&(r.expires=r.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var a in r)r[a]&&(s+="; "+a,!0!==r[a]&&(s+="="+r[a].split(";")[0]));return document.cookie=t+"="+e.write(o,t)+s}}return Object.create({set:o,get:function(t){if("undefined"!=typeof document&&(!arguments.length||t)){for(var n=document.cookie?document.cookie.split("; "):[],i={},o=0;o<n.length;o++){var r=n[o].split("="),s=r.slice(1).join("=");try{var a=decodeURIComponent(r[0]);if(i[a]=e.read(s,a),t===a)break}catch(t){}}return t?i[t]:i}},remove:function(t,e){o(t,"",n({},e,{expires:-1}))},withAttributes:function(e){return t(this.converter,n({},this.attributes,e))},withConverter:function(e){return t(n({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(i)},converter:{value:Object.freeze(e)}})}({read:function(t){return'"'===t[0]&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});!function(t){t.F2="f2",t.FUTHEAD="futhead",t.MUTHEAD="muthead",t.GAMESPOT="gamespot",t.COMICVINE="comicvine",t.GAMEFAQS="gamefaqs",t.METACRITIC="metacritic",t.METACRITIC_NEUTRON="metacritic-neutron",t.TVGUIDE="tvguide",t.TVGUIDE_MTC="tvguide-mtc",t.GIANTBOMB="giantbomb",t.FANATICAL="fanatical",t.FANDOMDESKTOP="fandomdesktop",t.FANDOMMOBILE="fandommobile"}(i||(i={}));const s=/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i,a={muthead:"turf",futhead:"turf",giantbomb:"giantbomb",gamefaqs:"gamefaqs",gamespot:"gamespot",metacritic:"metacritic","metacritic-neutron":"metacritic_neutron",comicvine:"comicvine",f2:"fandom",tvguide:"tvguide",fandomdesktop:"ucp",fandommobile:"ucp",fanatical:"fanatical"};var c=o(888),d=o(676);let u=class{constructor(t,e,n,i){this.browser=t,this.device=e,this.platform=n,this.geo=i,this.tagsAlreadySet=!1}isSupported(){return[i.FANDOMDESKTOP,i.FANDOMMOBILE].includes(this.platform)}setTags(t){var e,n,i;this.tagsAlreadySet||(t.setTags({browser:this.browser,device:this.device,platform:this.platform,geo_country:null!==(e=this.geo.country)&&void 0!==e?e:"",geo_continent:null!==(n=this.geo.continent)&&void 0!==n?n:"",geo_region:null!==(i=this.geo.region)&&void 0!==i?i:""}),this.tagsAlreadySet=!0)}};u=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(d.h5)),(0,t.Qj)(1,(0,e.WQ)(d.db)),(0,t.Qj)(2,(0,e.WQ)(d.i9)),(0,t.Qj)(3,(0,e.WQ)(d.m$))],u);const l=(t=window)=>Boolean(t.FANDOM_ODYSSEY);function h(n){return(0,t.sH)(this,void 0,void 0,function*(){if(!l(window))return;const t=yield function(){const t=e.kL.resolve(u);return new Promise(e=>{t.isSupported()||e(null),window.fandomSentry?e(window.fandomSentry):window.addEventListener("fandomSentryLoaded",()=>{e(window.fandomSentry)})})}();t&&(e.kL.resolve(u).setTags(t),t.captureException(n))})}const g=()=>window.fandomCmp&&window.fandomCmp.ready;class p{static getURLSearchParams(){const t=window.location.search.substring(1);return new URLSearchParams(t)}static get(t){return p.getURLSearchParams().get(t)}static stringify(t){const e=new URLSearchParams(t);return e.sort(),e.toString()}}function f(){return"1"===p.get("identity_debug")}let v=class{constructor(t){var e,n;this.logGroup="Global",this.debugGroup=this.getDebugGroup(),this.groups=this.debugGroup.split(","),this.initTime=null!==(n=null===(e=null==t?void 0:t.performance)||void 0===e?void 0:e.timeOrigin)&&void 0!==n?n:Date.now()}setLoggerGroup(t){return this.logGroup=t,this}getTimeDelta(){return Date.now()-this.initTime}getDebugGroup(){var t;return null!==(t=p.get("identity_debug"))&&void 0!==t?t:""}getTimeDeltaFixed(){return(this.getTimeDelta()/1e3).toFixed(4)}info(...t){this.loggingEnabled()&&console.info(`${this.getTimeDeltaFixed()}s\t\t [IE] ${this.logGroup}`,t)}warn(...t){this.loggingEnabled()&&console.warn(`${this.getTimeDeltaFixed()}s\t\t [IE] ${this.logGroup}`,t)}error(...t){this.loggingEnabled()&&console.error(`${this.getTimeDeltaFixed()}s\t\t [IE] ${this.logGroup}`,t)}loggingEnabled(){return f()||-1!==this.groups.indexOf(this.logGroup)}};v=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(d.jf))],v);class m{constructor(t,e){this.__global=!0,this.timestamp=Date.now(),this.name=t.name,this.category=t.category||"[Identity]",this.type=`${this.category} ${t.name}`,Object.assign(this,e)}}const y={category:"[AdEngine OptIn]",name:"set opt in"},w={category:"[AdEngine OptIn]",name:"update opt in"},b={category:"[IdentityEngine]",name:"Fandom context set"},C={category:"[IdentityEngine]",name:"Identity ready"},S={category:"[AdEngine]",name:"Identity partner data obtained"},k={name:"Age gate result",category:"[Identity]"},T={name:"Page changed",category:"[Platform]"},O={category:"[AdEngine]",name:"Update consent"};var E=function(){return E=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},E.apply(this,arguments)},I={channelId:"default",host:window,coordinatorHost:window.top},Q={connect:"connect",connected:"connected"},j="@wikia/post-quecast";function A(t){return t.channelId&&t.libId===j&&t.action&&function(t){return"string"==typeof t.type&&"number"==typeof t.timestamp}(t.action)}function M(t){return!t.data.private}function P(t,e){return t.data.channelId===e}function R(t){return t.data.action}var x=function(){function t(){}return t.make=function(t){return function(t){var e;return t.host===t.coordinatorHost&&!!(null===(e=t.coordinatorHost[j])||void 0===e?void 0:e.callbackConnector)}(t)?t.coordinatorHost[j].callbackConnector:new L({senderHost:t.coordinatorHost,listenerHost:t.host})},t}(),_=function(){function t(t){this.coordinatorHost=t,this.callbacks=[]}return t.prototype.dispatch=function(t){var e=this;if(!A(t))throw new Error("Incorrect object type. Expected PostMessageData, but got "+t);this.callbacks.forEach(function(n){return n({data:t,source:e.coordinatorHost})})},t.prototype.addListener=function(t){this.callbacks.push(t)},t.prototype.removeListener=function(t){this.callbacks=this.callbacks.filter(function(e){return e!==t})},t}(),L=function(){function t(t){this.options=t,this.map=new Map}return t.prototype.dispatch=function(t){if(!A(t))throw new Error("Incorrect object type. Expected PostMessageData, but got "+t);this.options.senderHost.postMessage(t,"*")},t.prototype.addListener=function(t){var e=function(e){var n;(n=e)&&n.source&&n.data&&A(n.data)&&t(e)};this.map.set(t,e),this.options.listenerHost.addEventListener("message",e)},t.prototype.removeListener=function(t){var e=this.map.get(t);this.options.listenerHost.removeEventListener("message",e),this.map.delete(t)},t}(),D=function(){function t(t){this.callbacks=[],this.history=[],this.channelId=t.channelId,this.connector=x.make(t),this.setupActions(),this.setupConnection()}return t.prototype.setupActions=function(){this.getHistory(),this.listenEvent()},t.prototype.getHistory=function(){var t=this,e=function(n){if(P(n,t.channelId)&&function(t){return!!t.data.private}(n)){var i=R(n);(function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.some(function(e){return t.type===e})})(i,Q.connected)&&(t.connector.removeListener(e),t.handleActions.apply(t,i.history))}};this.connector.addListener(e)},t.prototype.listenEvent=function(){var t=this;this.connector.addListener(function(e){if(P(e,t.channelId)&&M(e)){var n=R(e);t.handleActions(n)}})},t.prototype.handleActions=function(){for(var t,e=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];(t=this.history).push.apply(t,n),n.forEach(function(t){return e.callbacks.forEach(function(e){return e(t)})})},t.prototype.setupConnection=function(){this.connector.dispatch({action:{type:Q.connect,timestamp:Date.now()},channelId:this.channelId,private:!0,libId:j})},t.prototype.addListener=function(t){this.history.forEach(function(e){return t(e)}),this.callbacks.push(t)},t.prototype.removeListener=function(t){this.callbacks=this.callbacks.filter(function(e){return e!==t})},t}(),W=function(){function t(t){void 0===t&&(t={});var e=E(E({},I),t);this.channelId=e.channelId,this.connector=x.make(e)}return t.prototype.dispatch=function(t){this.connector.dispatch({action:E(E({},t),{timestamp:Date.now()}),channelId:this.channelId,private:!0,libId:j})},t}(),N=function(){function t(t){void 0===t&&(t={});var e=E(E({},I),t);this.transmitter=new W(e),this.receiver=new D(e)}return t.prototype.dispatch=function(t){this.transmitter.dispatch(t)},t.prototype.addListener=function(t){this.receiver.addListener(t)},t.prototype.removeListener=function(t){this.receiver.removeListener(t)},t}(),G=function(){function t(t,e){this.channelId=t,this.connectors=new Map,this.history=[],this.connectors.set(e,e[j].callbackConnector)}return t.prototype.addConnection=function(t){this.ensureConnector(t).dispatch({action:this.createConnectedAction(),private:!0,channelId:this.channelId,libId:j})},t.prototype.createConnectedAction=function(){return{type:Q.connected,history:this.history,timestamp:Date.now()}},t.prototype.broadcast=function(t){var e=this;this.history.push(t),this.connectors.forEach(function(n){n.dispatch({action:t,channelId:e.channelId,libId:j})})},t.prototype.ensureConnector=function(t){return this.connectors.has(t)||this.connectors.set(t,new L({senderHost:t,listenerHost:t})),this.connectors.get(t)},t}(),U=function(){function t(t){this.coordinatorHost=t,this.channels=new Map,this.callbackConnector=new _(t),this.postMessageConnector=new L({senderHost:t,listenerHost:t})}return t.prototype.init=function(){var t=this,e=function(e){M(e)||(t.handleConnect(e),t.handleBroadcast(e))};this.callbackConnector.addListener(e),this.postMessageConnector.addListener(e)},t.prototype.handleConnect=function(t){(function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.some(function(e){return t.data.action.type===e})})(t,Q.connect)&&this.ensureChannel(t.data.channelId).addConnection(t.source)},t.prototype.handleBroadcast=function(t){(function(t){return!Object.values(Q).some(function(e){return t.data.action.type===e})})(t)&&this.ensureChannel(t.data.channelId).broadcast(t.data.action)},t.prototype.ensureChannel=function(t){return this.channels.has(t)||this.channels.set(t,new G(t,this.coordinatorHost)),this.channels.get(t)},t}();function V(t){if(void 0===t&&(t=window),!t[j]){var e=new U(t);e.init(),t[j]=e}}let $=class{constructor(t){this.window=t,this.history=new Map;const{channelId:e,coordinatorName:n}=this.getSettings();V(),this.communicator=new N({channelId:e||"default",coordinatorHost:n&&n in t?t[n]:top})}emit(t){this.communicator.dispatch(t)}on(t,e){this.communicator.addListener(n=>this.run(n,t,e))}once(t,e){this.communicator.addListener(n=>this.runOnce(n,t,e))}getSettings(){return this.window["@wikia/post-quecast-settings"]||{}}run(t,e,n){this.ofType(t,e)&&n(t)}runOnce(t,e,n){const i=e.category+" "+e.name;this.ofType(t,e)&&(this.history.has(i)||(this.history.set(i,!0),n(t)))}ofType(t,e){return t.category===e.category&&t.name===e.name||t.type===e.category+" "+e.name}};$=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(d.jf))],$);const H="fandomConsentUpdate",B="fandomContextUpdate",F=(t=window)=>{const e=()=>{var e;return void 0!==t.fandomCmp&&t.fandomCmp.ready&&(null===(e=t.fandomCmp.allowed)||void 0===e?void 0:e.ads)};return new Promise(n=>{if(e())return n();const i=()=>{e()&&(t.removeEventListener(H,i),n())};t.addEventListener(H,i)})};var K;!function(t){t.COOKIEBOT="cookiebot",t.ONETRUST="onetrust"}(K||(K={}));var q=o(741),z=o(50);function Y(t,e="text/javascript",n=!0,i=null,o={},r={}){return new Promise((s,a)=>{var c;const d=document.createElement("script");if(d.async=n,d.defer=!n,d.type=e,d.src=t,Object.keys(o).forEach(t=>{d.setAttribute(t,o[t])}),Object.keys(r).forEach(t=>{d.dataset[t]=r[t]}),"string"==typeof i){const t=document.getElementsByTagName("script")[0];null===(c=t.parentNode)||void 0===c||c.insertBefore(d,t)}else(i||document.body).append(d);d.onload=s,d.onerror=a})}var Z,J=o(312),X=o(205);!function(t){t.yes="Y",t.no="N",t.na="-"}(Z||(Z={}));let tt=class{constructor(t,e){this.window=t,this.cookiesManager=e,this.usPrivacyCookie="usprivacy",this.USP_API_VERSION=1,this.explicitNotice=Z.yes,this.lspaSupport=Z.no}createPrivacyCookie(t=Z.na){const e=(0,q.K6)(this.window.location.hostname),n=t===Z.na?`${this.USP_API_VERSION}${Z.na}${Z.na}${Z.na}`:`${this.USP_API_VERSION}${this.explicitNotice}${t}${this.lspaSupport}`;this.cookiesManager.set(this.usPrivacyCookie,n,{domain:e,sameSite:"Lax",expires:(0,X.S)(365,X.y.DAYS)})}getPrivacyString(){return this.cookiesManager.get(this.usPrivacyCookie)}};tt=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(d.jf)),(0,t.Qj)(1,(0,e.WQ)(d.AZ))],tt);const et={C0001:"necessary",C0002:"performance",C0003:"functional",C0004:"targeting",C0005:"social"},nt=(t=!1,e={})=>Object.assign({necessary:t,performance:t,functional:t,targeting:t,social:t},e),it=()=>null!==(0,q.Ri)("OptanonAlertBoxClosed"),ot=t=>void 0!==t&&"string"==typeof t.groups&&t.groups.length>0,rt=t=>{const e=new URLSearchParams(t),n={};return e.forEach((t,e)=>{n[e]=t}),n},st={attributes:!1,childList:!0,characterData:!1},at="onetrust-banner-sdk",ct=(t,e)=>new Promise(n=>{const i=document.getElementById(t);if(i)return n(i);const o=new MutationObserver(()=>{const e=document.getElementById(t);e&&(n(e),o.disconnect())});o.observe(e,st)}),dt=(t=window)=>{const e=()=>{var e,n,i,o,r,s;return(null===(n=null===(e=t.fandomContext)||void 0===e?void 0:e.tracking)||void 0===n?void 0:n.pvNumber)&&(null===(o=null===(i=t.fandomContext)||void 0===i?void 0:i.tracking)||void 0===o?void 0:o.pvNumberGlobal)&&(null===(s=null===(r=t.fandomContext)||void 0===r?void 0:r.tracking)||void 0===s?void 0:s.pvUID)};return new Promise(n=>{if(e())return n();const i=()=>{e()&&(t.removeEventListener(B,i),n())};t.addEventListener(B,i)})};var ut,lt;!function(t){t[t.identity=0]="identity",t[t.loadTime=1]="loadTime",t[t.consents=2]="consents"}(ut||(ut={}));class ht extends Error{constructor(t){super(t),this.name=this.constructor.name}}let gt=lt=class{get(e){return(0,t.sH)(this,arguments,void 0,function*(t,e={mode:"cors"},n=lt.DEFAULT_TIMEOUT){return this.fetch(t,"GET",e,n)})}put(e,n){return(0,t.sH)(this,arguments,void 0,function*(t,e,n={mode:"cors"}){return this.fetch(t,"PUT",n,0,e)})}fetch(e,n){return(0,t.sH)(this,arguments,void 0,function*(t,e,n={mode:"cors"},i=0,o){let r,s;if(i>0){const t=new AbortController;s=setTimeout(()=>t.abort(new DOMException("signal is aborted due to a timeout","AbortError")),i),r=t.signal}try{const i=yield fetch(t,Object.assign({method:e,signal:r,headers:o?{"Content-Type":"application/json"}:void 0,keepalive:!0,body:o?JSON.stringify(o):void 0},n));if(void 0!==s&&clearTimeout(s),!i.ok)throw new ht(`HTTP error ${t}! Status: ${i.status}`);return i}catch(e){if(e instanceof ht)throw e;throw new ht(`HTTP error ${e} while sending request to ${t}!`)}})}};gt.DEFAULT_TIMEOUT=1e3,gt=lt=(0,t.Cg)([(0,e._G)()],gt);let pt=class{constructor(t){this.cookiesManager=t}getForcedBucket(){return p.get("pf_pathfinder_force_bucket")}getWikiaBucket(){const t=this.cookiesManager.get("exp_bucket");if(t)return/^(?:v\d-)?(\d{2})/.test(t)?t:"vN-"+t}getCurrentBucket(){var t,e;const n=this.getForcedBucket();return(null!==(e=(null!==(t=null!=n?n:this.getWikiaBucket())&&void 0!==t?t:"v5-100").split("-").pop())&&void 0!==e?e:"").padStart(2,"0")}};pt=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(d.AZ))],pt);let ft=class{constructor(t,e,n,i,o,r,s,a){this.logger=t,this.httpClient=e,this.skin=n,this.window=i,this.geo=o,this.browser=r,this.operatingSystem=s,this.experimentBucketing=a,this.logger.setLoggerGroup("DataWarehouseSender");const c=new Date;this.startTime=this.getTimeOrigin(),this.tzOffset=c.getTimezoneOffset()}getTimeOrigin(){var t;return null===(t=window.performance)||void 0===t?void 0:t.timeOrigin}getCurrentTimestamp(){return Date.now()}getStartTime(){return this.startTime}getTimezoneOffset(){return this.tzOffset}getTrackingParams(){var t,e,n,i,o,r,s,a,c,d,u,l,h,g,p,f,v,m,y,w,b,C,S,k;const T="opted-out",{ready:O,optOut:E}=this.window.fandomCmp,I=O&&!E;return{browser:`${this.operatingSystem} ${this.browser}`,browser_ts:this.getCurrentTimestamp(),tz_offset:this.getTimezoneOffset(),country:this.geo.country?this.geo.country.toLowerCase():"",session_id:I?null===(e=null===(t=this.window.fandomContext)||void 0===t?void 0:t.tracking)||void 0===e?void 0:e.sessionId:T,pv_number:null===(i=null===(n=this.window.fandomContext)||void 0===n?void 0:n.tracking)||void 0===i?void 0:i.pvNumber,pv_number_global:null===(r=null===(o=this.window.fandomContext)||void 0===o?void 0:o.tracking)||void 0===r?void 0:r.pvNumberGlobal,pv_unique_id:null===(a=null===(s=this.window.fandomContext)||void 0===s?void 0:s.tracking)||void 0===a?void 0:a.pvUID,beacon:I?null===(d=null===(c=this.window.fandomContext)||void 0===c?void 0:c.tracking)||void 0===d?void 0:d.beaconId:T,ua:null===(u=this.window.navigator)||void 0===u?void 0:u.userAgent,c:(null===(l=this.window.RLCONF)||void 0===l?void 0:l.wgCityId)||"unknown",ck:(null===(g=null===(h=this.window.mw)||void 0===h?void 0:h.config)||void 0===g?void 0:g.get("dsSiteKey"))||"unknown",lc:(null===(f=null===(p=this.window.mw)||void 0===p?void 0:p.config)||void 0===f?void 0:f.get("wgUserLanguage"))||"unknown",s:this.skin,u:I?(null===(m=null===(v=this.window.mw)||void 0===v?void 0:v.config)||void 0===m?void 0:m.get("wgUserId"))||0:-1,a:(null===(w=null===(y=this.window.fandomContext)||void 0===y?void 0:y.page)||void 0===w?void 0:w.articleId)||-1,x:(null===(C=null===(b=this.window.mw)||void 0===b?void 0:b.config)||void 0===C?void 0:C.get("wgDBname"))||"unknown",n:(null===(k=null===(S=this.window.mw)||void 0===S?void 0:S.config)||void 0===k?void 0:k.get("wgNamespaceNumber"))||-1,exp_bucket:I?this.experimentBucketing.getCurrentBucket():T}}getTimeBasedParams(){return{cb:Math.floor(99999*Math.random()),url:document.URL}}buildDataWarehouseUrl(t,e){if(!e)throw this.logger.error("Error building DWH tracking URL"),new Error("Error while building DWH tracking URL - no baseUrl provided");const n=new URLSearchParams(t);return n.sort(),`${e}?${n.toString()}`}sendEvent(t,e){var n;const i=this.buildDataWarehouseUrl(t,e);i&&(null===(n=this.httpClient.get(i,{mode:"cors"},5e3))||void 0===n||n.catch(t=>{this.logger.error("Failed to send data",t)}))}};ft=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(v)),(0,t.Qj)(1,(0,e.WQ)(gt)),(0,t.Qj)(2,(0,e.WQ)(d.aK)),(0,t.Qj)(3,(0,e.WQ)(d.jf)),(0,t.Qj)(4,(0,e.WQ)(d.m$)),(0,t.Qj)(5,(0,e.WQ)(d.h5)),(0,t.Qj)(6,(0,e.WQ)(d.Os)),(0,t.Qj)(7,(0,e.WQ)(pt))],ft);let vt=class{constructor(t){this.sender=t}send(t){const e=Object.assign(Object.assign(Object.assign({},t),this.sender.getTimeBasedParams()),this.sender.getTrackingParams());this.sender.sendEvent(e,"https://beacon.wikia-services.com/__track/special/identityinfo")}};vt=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(ft))],vt);let mt=class{constructor(t){this.sender=t}send(t){const e=Object.assign(Object.assign({event_name:t,load_time:this.sender.getCurrentTimestamp()-this.sender.getStartTime()},this.sender.getTimeBasedParams()),this.sender.getTrackingParams());this.sender.sendEvent(e,"https://beacon.wikia-services.com/__track/special/adengloadtimes")}};mt=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(ft))],mt);let yt=class{constructor(t,e,n){this.window=t,this.geo=e,this.sender=n}send(t){const e=Object.assign(Object.assign({},t),this.getTrackingParams());this.sender.sendEvent(e,"https://beacon.wikia-services.com/__track/special/gdpr_events")}getTrackingParams(){var t,e,n,i,o,r;const{ready:s,optOut:a}=this.window.fandomCmp,c=s&&!a;return{lang_code:this.getLanguageCode()||"unknown",detected_geo:null!==(t=this.geo.country)&&void 0!==t?t:"",detected_region:null!==(e=this.geo.region)&&void 0!==e?e:"",beacon:c?null===(i=null===(n=this.window.fandomContext)||void 0===n?void 0:n.tracking)||void 0===i?void 0:i.beaconId:"opted-out",pv_unique_id:null===(r=null===(o=this.window.fandomContext)||void 0===o?void 0:o.tracking)||void 0===r?void 0:r.pvUID}}getLanguageCode(){var t,e,n;return null!==(n=null===(e=null===(t=this.window.mw)||void 0===t?void 0:t.config)||void 0===e?void 0:e.get("wgUserLanguage"))&&void 0!==n?n:this.window.navigator.language.toLowerCase().substring(0,2)}};yt=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(d.jf)),(0,t.Qj)(1,(0,e.WQ)(d.m$)),(0,t.Qj)(2,(0,e.WQ)(ft))],yt);const wt=/(?!\.)(pl|us)$/;function bt(){var t,e;return"dev"===(null===(e=null===(t=window.ads)||void 0===t?void 0:t.context)||void 0===e?void 0:e.env)?"https://services.fandom-dev."+(window.location.hostname.match(wt)||["us"])[0]+"/":"https://services.fandom.com/"}function Ct(t,e){return Object.keys(e).forEach(function(n){"default"===n||"__esModule"===n||t.hasOwnProperty(n)||Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[n]}})}),t}function St(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}var kt={},Tt={};function Ot(t){const e=("; "+document.cookie).split("; "+t+"=");return 2===e.length?e.pop().split(";").shift():void 0}St(Tt,"getCookieValue",()=>Ot);var Et={};function It(t){return new Promise(e=>setTimeout(()=>e(),t))}St(Et,"delay",()=>It);var Qt={};function jt(){const t=new URLSearchParams(window.location.search.substring(1));return Boolean(t.get("adengine_debug"))?t.get("adengine_debug"):t.get("identity_debug")}St(Qt,"getDebugGroup",()=>jt);var At={};St(At,"localStorageHelper",()=>Mt);class Mt{constructor(t,e=6e4){this.key=t,this.ttlInMilliseconds=e;let n=!1;try{n=void 0!==window.localStorage&&null!==window.localStorage,n&&(window.localStorage.setItem("__test__","test"),window.localStorage.removeItem("__test__"))}catch(t){n=!1}const i=t=>window?.instantConfigCache?.[t]??null,o=(t,e)=>{void 0===window.instantConfigCache&&(window.instantConfigCache={}),window.instantConfigCache[t]=e};this.storageAdapter={getItem:t=>{try{return n?window.localStorage.getItem(t)??i(t):i(t)}catch(e){return i(t)}},setItem:(t,e)=>{try{if(n)return localStorage.setItem(t,e);o(t,e)}catch(n){o(t,e)}}}}set(t){const e=this.getObjectToStore(t);this.storageAdapter.setItem(this.key,JSON.stringify(e))}get(){const t=this.storageAdapter.getItem(this.key);return t?this.parseStoredValue(JSON.parse(t)):null}expired(t){return!t||t<Date.now()}getObjectToStore(t){return{data:t,ttl:Date.now()+this.ttlInMilliseconds}}parseStoredValue(t){return this.expired(t?.ttl)?null:t.data}}var Pt={};St(Pt,"lock",()=>xt),St(Pt,"release",()=>_t);const Rt=new Mt("instant-config-lock",1e3);function xt(){return"lock"===Rt.get()||(Rt.set("lock"),!1)}function _t(){Rt.set(null)}var Lt={};St(Lt,"getTimeDelta",()=>Gt),St(Lt,"logger",()=>Ut),St(Lt,"warner",()=>Vt);const Dt=jt()||"",Wt=Dt.split(","),Nt=Date.now();function Gt(){return((Date.now()-(window.performance?.timeOrigin??Nt))/1e3).toFixed(4)}function Ut(t,...e){""!==Dt&&("1"!==Dt&&-1===Wt.indexOf(t)||window.console.info(`${Gt()}s\t\t ${t}`,e))}function Vt(t,...e){""!==Dt&&("1"!==Dt&&-1===Wt.indexOf(t)||window.console.warn(t,e))}Ct(kt,Tt),Ct(kt,Et),Ct(kt,Qt),Ct(kt,At),Ct(kt,Pt),Ct(kt,Lt);var $t={},Ht={};St(Ht,"InstantConfigInterpreter",()=>Se);var Bt={},Ft={};function Kt(t){return Array.isArray(t)&&t.length>0&&"object"==typeof t[0]}function qt(t){const e=t.sampling??t.s;return"number"==typeof e&&e>0&&e<100}St(Ft,"shouldBeListOfConfigGroups",()=>Kt),St(Ft,"hasSampling",()=>qt);var zt={};St(zt,"negativePrefix",()=>Yt),St(zt,"cacheSuffix",()=>Zt),St(zt,"samplingSeparator",()=>Jt),St(zt,"worldWide",()=>Xt),St(zt,"precision",()=>te),St(zt,"experimentBucketSettingKey",()=>ee);const Yt="non-",Zt="-cached",Jt="/",Xt="XX",te=10**6,ee="eb";Ct(Bt,{}),Ct(Bt,Ft),Ct(Bt,{}),Ct(Bt,{}),Ct(Bt,{}),Ct(Bt,{}),Ct(Bt,{}),Ct(Bt,{}),Ct(Bt,zt);const ne=/^(?:v\d+-)?(\d{2})$/;function ie(){const t=new URLSearchParams(window.location.search.substring(1)).get("pf_pathfinder_force_bucket"),e=Ot("exp_bucket");let n=t??e;const i=n?.match(ne);return i&&i.length>=2&&(n=i[1]),()=>Number(n??"100")}class oe{constructor(t,e,n){this.container=e,this.settingsRepository=n,"number"==typeof t?this.experimentBucket=this.manageSampling(t):!0===t?this.experimentBucket=this.manageSampling(0):!1===t&&this.clean()}build(){return()=>this.experimentBucket??oe.getRandomBucket()}static getRandomBucket(){return Math.floor(100*Math.random())}manageSampling(t){let e=this.readFromLoaderVariable()??this.readFromSettings()??oe.getRandomBucket();return 100===e&&(e=0),this.storeInLoaderVariable(e),this.storeInSettings(e,t),e}readFromLoaderVariable(){return this.container.fandomContext?.experimentBucket}readFromSettings(){const t=this.settingsRepository&&this.settingsRepository.get(ee);return t&&Number(t)}storeInSettings(t,e){this.settingsRepository&&this.settingsRepository.set(ee,t.toString(),e)}storeInLoaderVariable(t){this.container.fandomContext=this.container.fandomContext||{},this.container.fandomContext.experimentBucket=t}clean(){this.settingsRepository&&this.settingsRepository.remove(ee)}}class re{activeKeyValues=[];activeLabradorKeyValues=[];constructor(t){Array.isArray(t)?this.keyValueNamesMap=t.map(t=>t&&t.toString().split(":")).filter(t=>t&&t.length>=2).reduce((t,e)=>(t[e[0]]=e[1],t),{}):this.keyValueNamesMap={}}getActiveKeyValues(){return this.activeKeyValues}getActiveLabradorKeyValues(){return this.activeLabradorKeyValues}mark(t,e){const n=e?.isActive?e.keyVal:e?.defaultKeyVal;if(e){const n=this.generateKeyValue(e.isActive,e.enabledTraffic,t);this.activeKeyValues.includes(n)||this.activeKeyValues.push(n)}n&&!this.activeLabradorKeyValues.includes(n)&&this.activeLabradorKeyValues.push(n)}deprecatedMark(t,e,n){const i=this.generateKeyValue(n,e,t),o=this.keyValueNamesMap[i]??i;this.activeKeyValues.includes(i)||this.activeKeyValues.push(i),this.activeLabradorKeyValues.includes(o)||this.activeLabradorKeyValues.push(o)}generateKeyValue(t,e,n){return`${n}_${t?"B":"A"}_${t?e:100-e}`}}var se={},ae={};St(ae,"BrowserMatcher",()=>ue);var ce={};function de(t){return t.startsWith(Yt)?{value:t.replace(Yt,""),negated:!0}:{value:t,negated:!1}}St(ce,"extractNegation",()=>de);class ue{constructor(t){this.currentBrowser=t?.toLowerCase()}isValid(t){const e=t.b??t.browsers??[],n=e.map(t=>t.toLowerCase()).map(t=>de(t));return 0===e.length||!this.currentBrowser||!this.isCurrentNegated(this.currentBrowser,n)&&n.some(t=>this.currentBrowser.includes(t.value)!==t.negated)}isCurrentNegated(t,e){return e.some(e=>t.includes(e.value)&&e.negated)}}var le={};function he(t){return t?.bucketing??(void 0!==t?.bu?{source:(e=t.bu).s,rules:{defaultKeyValue:e.r.k,ranges:e.r.r.map(t=>({start:t.s,end:t.e,keyValue:t.k}))}}:void 0);var e}St(le,"getBucketing",()=>he),St(le,"BucketingMatcher",()=>ge);class ge{constructor(t,e=ie()){this.bucketingProviders={exp_bucket:e,eb:t}}match(t){const e=he(t);if(!e?.rules?.ranges||!e.source)return;const n=this.bucketingProviders[e.source];if(!n)return;const i=Math.round(n()),o=e.rules.ranges.find(t=>i>=t.start&&i<=t.end),r=Math.min(e.rules.ranges.reduce((t,e)=>t+(e.end-e.start+1),0),100);return{isActive:!!o,defaultKeyVal:e.rules.defaultKeyValue,keyVal:o?.keyValue,enabledTraffic:r}}}var pe={};St(pe,"DeviceMatcher",()=>fe);class fe{constructor(t){this.currentDevice=t}isValid(t){const e=(t.d??t.devices??[]).map(t=>t.toLowerCase()).map(t=>de(t));return 0===e.length||!this.currentDevice||!this.isCurrentNegated(this.currentDevice,e)&&e.some(t=>t.value===this.currentDevice!==t.negated)}isCurrentNegated(t,e){return e.some(e=>t.includes(e.value)&&e.negated)}}var ve={};St(ve,"DomainMatcher",()=>me);class me{isValid(t){const e=t.o??t.domains??[];return 0===e.length||e.some(t=>window.location.hostname.includes(t))}}var ye={};St(ye,"RegionMatcher",()=>we);class we{constructor(t){this.geo=t}isValid(t,e){const n=t.r??t.regions??[],i=this.filterOutInvalidRegions(n);return e?e(i):this.isProperGeo(i)}getCountryCode(){return this.geo?.country}getRegionCode(){return this.geo?.region}getContinentCode(){return this.geo?.continent}isProperGeo(t=[]){return!(!t||!t.indexOf||this.isGeoExcluded(t)||!(this.isProperContinent(t)||this.isProperCountry(t)||this.isProperRegion(t)))}filterOutInvalidRegions(t){return t.filter(t=>!t.includes(Jt)).filter(t=>!t.includes(Zt))}isProperCountry(t){return!!(t&&t.indexOf&&(t.indexOf(this.getCountryCode())>-1||this.isSampledForGeo(t,this.getCountryCode())))}isProperRegion(t){const e=`${this.getCountryCode()}-${this.getRegionCode()}`;return!!(t&&t.indexOf&&(t.indexOf(e)>-1||this.isSampledForGeo(t,e)))}containsContinent(t){const e=`${Xt}-${this.getContinentCode()}`;return t.indexOf(e)>-1||this.isSampledForGeo(t,e)}containsWorldWide(t){return t.indexOf(Xt)>-1||this.isSampledForGeo(t,Xt)}isProperContinent(t){return!(!t||!t.indexOf||!this.containsWorldWide(t)&&!this.containsContinent(t))}isGeoExcluded(t){return!!(t.indexOf(`${Yt}${this.getCountryCode()}`)>-1||t.indexOf(`${Yt}${this.getCountryCode()}-${this.getRegionCode()}`)>-1||t.indexOf(`${Yt}${Xt}-${this.getContinentCode()}`)>-1)}hasSampling(t){return e=>0!==e.indexOf(Yt)&&e.indexOf(t+Jt)>-1}getSamplingLimits(t){let[,e]=t.split(Jt);return e=e.replace(Zt,""),Math.round(parseFloat(e)*te)||0}isSampledForGeo(t,e){const n=t.filter(this.hasSampling(e));if(0===n.length)return!1;const i=Math.round(Math.random()*(100*te))||0;return n.map(t=>this.getSamplingLimits(t)).some(t=>i<t)}}var be={};St(be,"SamplingMatcher",()=>Ce);class Ce{constructor(t){this.samplingProvider=t,this.precision=10**6}isValid(t){return Math.round(this.samplingProvider()*this.precision)<Math.round(t*this.precision)}}Ct(se,ae),Ct(se,le),Ct(se,pe),Ct(se,ve),Ct(se,ce),Ct(se,ye),Ct(se,be);class Se{constructor(t=new ue,e=new fe,n=new me,i=new we,o){this.browserMatcher=t,this.deviceMatcher=e,this.domainMatcher=n,this.regionMatcher=i,this.settingsRepository=o,this.logGroup="instant-config-interpreter",this.configResponse={}}init(t,e={},n,i=window){this.configResponse={...e,...t},this.regionValidationPredicate=n,this.labradorKeyValuesMapper=new re(this.getValue("icLABradorGamKeyValues"));const o=new oe(this.getValue("icExperimentBucket"),i,this.settingsRepository).build();return this.deprecatedSamplingMatcher=new Ce(o),this.bucketingMatcher=new ge(o,ie()),this}getValues(){return kt.logger(this.logGroup,"get values called with",this.configResponse),void 0===this.values&&(this.values=Object.keys(this.configResponse).reduce((t,e)=>(t[e]=this.getValue(e),t),{})),this.values}getValue(t){const e=this.configResponse[t];if(Kt(e)){const n=e.find(this.predicate(t));return n?.v??n?.value}return e}getActiveKeyValues(){return this.labradorKeyValuesMapper.getActiveKeyValues()}getActiveLabradorKeyValues(){return this.labradorKeyValuesMapper.getActiveLabradorKeyValues()}predicate(t){return e=>{const n=this.browserMatcher.isValid(e)&&this.deviceMatcher.isValid(e)&&this.domainMatcher.isValid(e)&&this.regionMatcher.isValid(e,this.regionValidationPredicate);if(he(e)&&n){const n=this.bucketingMatcher.match(e);if(n)return this.labradorKeyValuesMapper.mark(t,n),n.isActive}if(!qt(e)||!1===n)return n;const i=e?.s??e?.sampling,o=this.deprecatedSamplingMatcher.isValid(i);return this.labradorKeyValuesMapper.deprecatedMark(t,i,o),o}}}var ke={};async function Te(t,e=2e3){const n=new AbortController,i=setTimeout(()=>n.abort(),e),o=await fetch(t,{signal:n.signal});return clearTimeout(i),o}St(ke,"InstantConfigLoader",()=>Ee);const Oe="instant-config-loader";class Ee{constructor(t,e=window){this.params=t,this.container=e,this.storage=new kt.localStorageHelper(`instant-config-${t.appName}`,6e4),this.container.icbm=this.container.icbm||{},this.instantConfig=this.container.instantConfig,this.lockDelay="number"==typeof t.lockDelay?t.lockDelay:500}async getConfig(){if(this.instantConfig)return this.instantConfig;let t;return this.lockDelay>0?t=this.fetchInstantConfigThroughCache():(this.container.icbm.fetch||(this.container.icbm.fetch=this.fetchInstantConfig()),t=this.container.icbm.fetch),t.then(t=>t??this.fetchFallbackConfig())}async fetchInstantConfigThroughCache(t=!1){if(kt.lock()&&!t)return kt.logger(Oe,"locked, awaiting",this.lockDelay),await It(this.lockDelay),this.fetchInstantConfigThroughCache(!0);try{const t=this.storage.get();if(t)return kt.logger(Oe,"instant config pulled from local storage",t),JSON.parse(t);const e=await this.fetchInstantConfig();return e&&this.storage.set(JSON.stringify(e)),kt.release(),e}catch(t){kt.warner(Oe,"could not get instant config via cache",t),kt.release()}}async fetchInstantConfig(){const t=this.params.instantConfigEndpoint??"https://services.fandom.com",e=this.params.instantConfigVariant??"icbm",{appName:n,compact:i}=this.params,o=new URLSearchParams({app:n});i&&o.set("compact","true");const r=`${t}/${e}/api/config?${o.toString()}`;try{const t=await Te(r,this.params.requestTimeout);if(!t.ok)return;const e=await t.json();return kt.logger(Oe,"instant config fetched",e),e}catch(t){return void kt.warner(Oe,"could not fetch instant config",t)}}async fetchFallbackConfig(){kt.logger(Oe,"Fetching fallback config");const t=this.params.instantConfigFallbackEndpoint;if(void 0===t)return{};try{kt.logger(Oe,t);const e=await Te(t,this.params.requestTimeout);if(!e.ok)return{};const n=await e.json();return kt.logger(Oe,"fallback config fetched",n),n}catch(t){return kt.warner(Oe,"could not fetch fallback config",t),{}}}}var Ie={};St(Ie,"InstantConfigOverrider",()=>je);const Qe=["InstantGlobals","icbm"];class je{override(t,e){return[...t.keys()].filter(t=>{return e=t,Qe.some(t=>e.startsWith(`${t}.`)||e.startsWith(`${t}__`));var e}).map(t=>{const[,e]=t.split(".").map(t=>t.split("__")).flat();return{paramKey:t,key:e}}).map(({paramKey:e,key:n})=>({key:n,value:this.parseValue(t.get(e))})).reduce((t,{key:e,value:n})=>({...t,[e]:n}),e)}parseValue(t){if("true"===t||"false"===t)return"true"===t;const e=parseInt(t,10);if(t===`${e}`)return e;try{return JSON.parse(t)}catch(e){return t||null}}}Ct($t,Ht),Ct($t,ke),Ct($t,Ie),Ct($t,se);class Ae{constructor(t,e,n){this.cookiesManager=t,this.communicationService=e,this.topLevelDomain=(0,q.K6)(n.location.hostname)}get(t){return this.cookiesManager.get(t)}remove(t){this.cookiesManager.remove(t,{domain:this.topLevelDomain})}set(t,e,n){this.communicationService.on(y,i=>{if((!i.geoRequiresSignal||!i.ccpaSignal)&&(!i.geoRequiresConsent||i.gdprConsent)){const i={domain:this.topLevelDomain};n&&(i.expires=n),this.cookiesManager.set(t,e,i)}})}}let Me=class{constructor(t,e,n,i,o,r,s){this.device=t,this.browser=e,this.platform=n,this.geo=i,this.window=o,this.cookiesManager=r,this.logger=s,this.repository={},this.logger.setLoggerGroup("InstantConfig"),this.isLoadedByOdyssey=l(this.window)}init(e){return(0,t.sH)(this,arguments,void 0,function*(e,n={}){var i,o;if(this.isLoadedByOdyssey)return this.repository=yield this.loadConfigFromOdyssey(),F(this.window).then(()=>{var t;this.window.fandomCmp.optOut?this.logger.info("User opted out, not setting eb cookie."):!this.cookiesManager.get("eb")&&(null===(t=this.window.fandomContext)||void 0===t?void 0:t.experimentBucket)&&this.cookiesManager.set("eb",this.window.fandomContext.experimentBucket.toString(),{domain:(0,q.K6)(),expires:(0,X.S)(180,X.y.DAYS)})}),this.logger.info("instantiated with",this.repository),this;const r=null===(o=null===(i=this.window.ads)||void 0===i?void 0:i.context)||void 0===o?void 0:o.env,s=bt().slice(0,-1);return this.repository=yield function(e,n,i,o,r,s,a,c){return(0,t.sH)(this,arguments,void 0,function*(t,e,n,i,o,r,s,a,c={},d){const u=new Ee({appName:i,instantConfigEndpoint:a,instantConfigFallbackEndpoint:`https://script.wikia.nocookie.net/fandom-ae-assets/icbm/${null!=d?d:"prod"}/icbm_state_${i}.json`,compact:!0}),l=new Ae(e,t,n),h=new Se(new ue(o),new fe(r),new me,new we(s),l);let g=yield u.getConfig();return g=(new je).override(p.getURLSearchParams(),g),h.init(g,c).getValues()})}(e,this.cookiesManager,this.window,this.platform,this.browser,this.device,this.geo,s,n,r),this.logger.info("instantiated with",this.repository),this})}get(t,e){var n,i;return null!==(i=null===(n=this.repository)||void 0===n?void 0:n[t])&&void 0!==i?i:e}loadConfigFromOdyssey(){var t;return(null===(t=this.window.icbm)||void 0===t?void 0:t.config)?Promise.resolve(this.window.icbm.config):new Promise(t=>{this.window.addEventListener("instantConfigLoaded",()=>{t(this.window.icbm.config)})})}};Me=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(d.db)),(0,t.Qj)(1,(0,e.WQ)(d.h5)),(0,t.Qj)(2,(0,e.WQ)(d.i9)),(0,t.Qj)(3,(0,e.WQ)(d.m$)),(0,t.Qj)(4,(0,e.WQ)(d.jf)),(0,t.Qj)(5,(0,e.WQ)(d.AZ)),(0,t.Qj)(6,(0,e.WQ)(v))],Me);let Pe=class{constructor(t){this.instantConfigService=t,this.cachedValues=new Map}isLimitedTraffic(t){if(f())return!1;if(this.cachedValues.has(t))return this.cachedValues.get(t);const e=this.instantConfigService.get("dwIdentityTrafficLimits",{}),n=this.getEventName(t);if(void 0===(null==e?void 0:e[n])||100===e[n])return!1;const i=e[n]<100*Math.random();return this.cachedValues.set(t,i),i}getEventName(t){var e;return null!==(e=ut[t])&&void 0!==e?e:"undefined"}};Pe=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)((0,e.cb)(()=>Me)))],Pe);let Re=class{constructor(t,e,n,i,o){this.logger=t,this.identityEventSender=e,this.loadTimeEventSender=n,this.consentEventSender=i,this.dataWarehouseTrafficLimiter=o,this.logger.setLoggerGroup("DataWarehouseService")}track(t,e){if(!this.dataWarehouseTrafficLimiter.isLimitedTraffic(t))switch(t){case ut.identity:this.identityEventSender.send(e);break;case ut.loadTime:this.loadTimeEventSender.send(e);break;case ut.consents:this.consentEventSender.send(e);break;default:this.logger.info("Invalid event type to track")}}};Re=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(v)),(0,t.Qj)(1,(0,e.WQ)(vt)),(0,t.Qj)(2,(0,e.WQ)(mt)),(0,t.Qj)(3,(0,e.WQ)(yt)),(0,t.Qj)(4,(0,e.WQ)(Pe))],Re);let xe=class{constructor(t,e,n){this.logger=t,this.dataWarehouse=e,this.geo=n,this.eventQueue=[],this.ready=!1,this.logger.setLoggerGroup("CMPTracker"),Promise.all([F(),dt()]).then(()=>{this.ready=!0,this.sendQueuedEvents()})}init(t){this.cmpName=t,this.logger.info(`Starting ${this.cmpName} tracker`),this.category=this.getCategory(),this.uiShown=`${this.cmpName}-ui-shown`}getCategory(){return(0,c.Aw)(this.geo)?`gdpr-modal-${this.cmpName}`:"US"===this.geo.country?`ccpa-modal-${this.cmpName}`:void this.logger.info(`Not a GDPR or CCPA country, skipping ${this.cmpName} tracker`,this.geo.country)}sendClickEvent(t){this.logger.info("Queued sending action event"),this.sendEvent(t,"click")}sendImpressionEvent(t="modal-view"){this.logger.info("Queued sending impression event"),this.sendEvent(t,"impression"),this.trackLoadTime()}trackLoadTime(){this.dataWarehouse.track(ut.loadTime,this.uiShown),this.logger.info("Loading time tracking event sent")}sendEvent(t,e){this.eventQueue.find(n=>n.label===t&&n.action===e)||this.eventQueue.push({label:t,action:e}),this.ready&&this.sendQueuedEvents()}sendQueuedEvents(){if(this.category)for(;this.eventQueue.length>0;){const t=this.eventQueue.shift(),e={ga_category:this.category,ga_action:t.action,ga_label:t.label};this.dataWarehouse.track(ut.consents,e),this.logger.info("Action tracking event sent",t.label)}}};xe=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(v)),(0,t.Qj)(1,(0,e.WQ)(Re)),(0,t.Qj)(2,(0,e.WQ)(d.m$))],xe);const _e=t=>t.geoRequiresSignal?!t.ccpaSignal:!t.geoRequiresConsent||t.gdprConsent;function Le(t,e=100,n=!1){let i,o,r;function s(...a){const c=Date.now()-o;c<e&&c>=0?i=setTimeout(()=>s(...a),e-c):(i=void 0,n||(r=t(...a)))}return(...a)=>{o=Date.now();const c=n&&!i;return null!=i||(i=setTimeout(()=>s(...a),e)),c&&(r=t(...a)),r}}const De={closed:"cookie-banner-closed",visible:"cookie-banner-visible",loading:"cookie-banner-loading"},We="--cookie-banner-height";let Ne=null;const Ge=t=>{Ue(t),"visible"===t?(Ve(),He()):"closed"===t&&($e(),Be())},Ue=t=>{const e=document.documentElement;Object.values(De).forEach(t=>{e.classList.remove(t)});const n=De[t];n&&e.classList.add(n)},Ve=()=>{const t=document.getElementById(at);if(!t)return;const e=t.offsetHeight;document.documentElement.style.setProperty(We,`${e}px`)},$e=()=>{document.documentElement.style.setProperty(We,"0px")},He=()=>{Ne||(Ne=Le(Ve,50),window.addEventListener("resize",Ne))},Be=()=>{Ne&&(window.removeEventListener("resize",Ne),Ne=null)};class Fe{constructor(t){this.window=t}createFromConsents(t,e,n){const i=!_e(n),o=t.applies(i);let r=Object.assign(Object.assign({},{ready:!1,coppa:!1,optOut:!1,allowed:{ads:!1,tracking:!1},consentApi:void 0,consentString:void 0,consents:void 0,banner:"loading"}),{ready:!0,coppa:t.resolveCoppaStatus(i),optOut:i,allowed:{ads:!o,tracking:!0}});var s,a;return s=e,Boolean(s&&"getConsentApi"in s&&"getConsentString"in s&&"getConsents"in s&&"getBannerStatus"in s)&&(r=Object.assign(Object.assign({},r),{consentApi:e.getConsentApi(),consentString:e.getConsentString(),consents:e.getConsents(i),banner:e.getBannerStatus()})),a=r.consentApi,document.documentElement.classList.add((t=>`cookie-banner-api-${t}`)(null!=a?a:"other")),Ge(r.banner),r}update(t){const e=Object.assign(Object.assign({},this.window.fandomCmp),t);this.window.fandomCmp=e,this.window.dispatchEvent(new CustomEvent(H,{detail:e})),Ge(e.banner)}}const Ke={".fanatical.com":"0ab0e172-dc9c-44b9-8a58-c80d9ba4fae0",".futhead.com":"82c642a4-d3a9-4a78-a310-21a7b49ab17b",".gamespot.com":"73588546-b116-4dbc-ab64-9db97e11fc0d",".metacritic.com":"50e16f1d-a929-4cc0-80a7-3c5c303eea6a",".muthead.com":"fb34a16e-696d-4748-af9f-96f3b9e2b4da",".tvguide.com":"ffc22311-f4da-4e03-a1ad-32aecd522c5b",".fandom.com":"dea70a1b-c82d-4fe0-86ff-5e164b0a6022",".fandom-dev.pl":"0195d37b-9d1b-7a59-ae6e-31a365aca256",".fandom-dev.us":"0195d387-ba18-754d-9ad7-8673011966c3"};let qe=class{constructor(t,e,n,i,o,r,s){this.window=t,this.navigator=e,this.geo=n,this.usPrivacy=i,this.logger=o,this.oneTrustTracker=r,this.communicationService=s,this.testMode=!!p.get("ot_test"),this.logger.setLoggerGroup("OneTrust"),this.fandomCmpHandler=new Fe(this.window),this.oneTrustTracker.init(K.ONETRUST),this.loadOneTrustScripts(),this.initializeModalListeners(),this.addConsentUpdatedListener()}getConsentApi(){return"US"===this.geo.country?"usp":(0,c.Aw)(this.geo)?"tcf":void 0}getConsentString(){var t;return"tcf"===this.getConsentApi()?null!==(t=(0,q.Ri)("eupubconsent-v2"))&&void 0!==t?t:void 0:"usp"===this.getConsentApi()?this.usPrivacy.getPrivacyString():void 0}getConsents(t){const e=this.getOneTrustConsentCookie();return ot(e)?(t=>{const e=nt();return Object.entries(et).reduce((e,[n,i])=>(ot(t)&&t.groups.includes(`${n}:1`)&&(e[i]=!0),e),e)})(e):nt(!t,{necessary:!0})}getBannerStatus(){return void 0===this.showBanner?"loading":this.showBanner?it()?"closed":document.getElementById(at)?"visible":"loading":"closed"}subscribe(t){!it()&&(0,c.Aw)(this.geo)||this.consentsUpdated(t),this.initialize(t)}oneTrustScriptLoaded(){const t=document.querySelectorAll(`script[data-domain-script="${this.getDomainId()}"]`);let e=!1;return t.forEach(t=>{var n;(null===(n=t.getAttribute("src"))||void 0===n?void 0:n.includes("otSDKStub.js"))&&(e=!0)}),e}initialize(t){this.logger.info("Initializing OneTrust");const e=this.window.OptanonWrapper;this.window.OptanonWrapper=()=>{var n,i,o;this.logger.info("OneTrust Wrapper Called"),this.showBanner=null===(o=null===(i=null===(n=this.window.OneTrust)||void 0===n?void 0:n.GetDomainData)||void 0===i?void 0:i.call(n))||void 0===o?void 0:o.ShowAlertNotice,this.fandomCmpHandler.update({banner:this.getBannerStatus()});const r=it(),s=(0,c.Aw)(this.geo)||"US"===this.geo.country;if(r||!s)return this.consentsUpdated(t),null==e?void 0:e()}}getOneTrustConsentCookie(){const t=(0,q.Ri)("OptanonConsent");if(t)return rt(t)}readTrackingConsents(){const t=(t=>{var e;const n=(0,q.Ri)("OptanonConsent");if(!n)return;const i=null===(e=rt(n))||void 0===e?void 0:e.groups;return i?i.includes(t):void 0})("C0004:1");return void 0===t?"US"===this.geo.country&&!this.navigator.globalPrivacyControl:t}consentsUpdated(t){if((0,c.Aw)(this.geo)&&!this.getOneTrustConsentCookie())return void this.logger.info("OneTrust cookie not found");const e=this.geo.country,n=this.readTrackingConsents();if(e){if("US"===e){if(this.navigator.globalPrivacyControl)return this.logger.info("OneTrust GPC registered"),this.oneTrustTracker.sendImpressionEvent("gpc"),this.usPrivacy.createPrivacyCookie(Z.yes),void t({gdprConsent:!0,geoRequiresConsent:!1,geoRequiresSignal:!0,ccpaSignal:!0});this.usPrivacy.createPrivacyCookie(n?Z.no:Z.yes)}t({gdprConsent:!z.e.includes(e.toLowerCase())||n,geoRequiresConsent:z.e.includes(e.toLowerCase()),geoRequiresSignal:"US"===e,ccpaSignal:"US"===e&&!n})}}loadOneTrustScripts(){return(0,t.sH)(this,void 0,void 0,function*(){var t;this.logger.info("Loading OneTrust scripts"),this.oneTrustScriptLoaded()||(this.logger.info("Loading OneTrust SDK"),yield Y("https://cdn.cookielaw.org/scripttemplates/otSDKStub.js","text/javascript",!0,null,{charSet:"UTF-8","data-domain-script":this.getDomainId()}));const e=null!==(t=this.geo.country)&&void 0!==t?t:"";z.e.includes(e.toLowerCase())&&void 0===this.window.__tcfapi&&(this.logger.info("Loading OneTrust TCF stub"),yield Y("https://cdn.cookielaw.org/consent/tcf.stub.js","text/javascript",!0,null,{charSet:"UTF-8"})),"US"===e&&void 0===this.window.__uspapi&&(this.logger.info("Loading OneTrust USPAPI"),yield Y("https://cdn.cookielaw.org/opt-out/otCCPAiab.js","text/javascript",!0,null,{charSet:"UTF-8","ccpa-opt-out-geo":"us","ccpa-opt-out-ids":"C0004","ccpa-opt-out-lspa":"false"}))})}getDomainId(){var t;const e=(0,q.K6)(this.window.location.hostname),n=null!==(t=Ke[e])&&void 0!==t?t:Ke[".fandom.com"];return this.testMode?`${n}-test`:n}addConsentUpdatedListener(){this.communicationService.on(O,({optOut:t,rejectAll:e})=>{this.setConsent(t,e)})}setConsent(e,n){return(0,t.sH)(this,void 0,void 0,function*(){if(yield(0,J.f)(()=>{var t;return!!(null===(t=this.window.OneTrust)||void 0===t?void 0:t.UpdateConsent)},50),n)return this.logger.info("Rejecting all OneTrust consents"),void this.window.OneTrust.RejectAll();const t=e?"0":"1";this.logger.info("Setting OneTrust consent",t),this.window.OneTrust.UpdateConsent("Category",`C0001:1,C0002:1,C0004:${t},C0003:1,C0005:1`)})}initializeModalListeners(){this.logger.info("Initializing listeners"),this.addClickListener(),this.addImpressionListener()}addClickListener(){this.window.addEventListener("OTConsentApplied",()=>{this.oneTrustTracker.sendClickEvent(this.readTrackingConsents()?"accept":"reject")})}addImpressionListener(){this.window.addEventListener("OneTrustPCLoaded",()=>{this.oneTrustTracker.sendImpressionEvent()}),(0,t.sH)(void 0,void 0,void 0,function*(){const t=yield ct("onetrust-consent-sdk",document.body);return ct(at,t)}).then(()=>{this.logger.info("OneTrust modal is visible"),this.fandomCmpHandler.update({banner:"visible"}),this.oneTrustTracker.sendImpressionEvent()})}};qe=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(d.jf)),(0,t.Qj)(1,(0,e.WQ)(d.kW)),(0,t.Qj)(2,(0,e.WQ)(d.m$)),(0,t.Qj)(3,(0,e.WQ)(tt)),(0,t.Qj)(4,(0,e.WQ)(v)),(0,t.Qj)(5,(0,e.WQ)(xe)),(0,t.Qj)(6,(0,e.WQ)($))],qe);let ze=class{get(n){return(0,t.sH)(this,void 0,void 0,function*(){if(n===K.ONETRUST)return e.kL.resolve(qe);if(n===K.COOKIEBOT){const{CookieBot:t}=yield o.e(852).then(o.bind(o,525));return e.kL.resolve(t)}const{StaticConsent:t}=yield o.e(319).then(o.bind(o,721));return e.kL.resolve(t)})}};function Ye(t,e){let n=t;return"1"===e&&(n=!1),n}var Ze;ze=(0,t.Cg)([(0,e.Gr)()],ze),function(t){t.tracking="tracking",t.page="page",t.site="site",t.partners="partners",t.targeting="targeting"}(Ze||(Ze={}));let Je=class{constructor(t){this.window=t}get(t,e){if(this.window.fandomContext&&this.window.fandomContext[t])return this.window.fandomContext[t][e]}set(t,e,n){this.window.fandomContext&&this.window.fandomContext[t]?this.window.fandomContext[t][e]=n:this.window.fandomContext=Object.assign(Object.assign({page:{},site:{}},this.window.fandomContext),{[t]:{[e]:n}})}remove(t,e){if(this.window.fandomContext&&this.window.fandomContext[t])try{delete this.window.fandomContext[t][e]}catch(t){}}};Je=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(d.jf))],Je);const Xe="ag";let tn=class{constructor(t,e,n,i,o,r,s){this.cookiesManager=t,this.window=e,this.logger=n,this.geo=i,this.communicationService=o,this.contextRepository=r,this.usPrivacy=s,this.logger.setLoggerGroup("AgeGate")}applies(t){if(!this.isEnabled()||t)return this.logger.info("disabled"),!1;const e=void 0===this.cookiesManager.get(Xe);return this.logger.info("applies",e),e}resolveCoppaStatus(t){var e,n,i;if(!this.isEnabled())return this.setIsCoppaSubjectInContext(!1),!1;if(t)return this.setIsCoppaSubjectInContext(!0),!0;const o=Ye(Boolean(null===(i=null===(n=null===(e=this.window.ads)||void 0===e?void 0:e.context)||void 0===n?void 0:n.targeting)||void 0===i?void 0:i.directedAtChildren),this.cookiesManager.get(Xe));return this.setIsCoppaSubjectInContext(o),o}isEnabled(){var t,e,n,i;const o=Boolean(null===(n=null===(e=null===(t=this.window.ads)||void 0===t?void 0:t.context)||void 0===e?void 0:e.targeting)||void 0===n?void 0:n.directedAtChildren),r=Boolean(null===(i=this.window.RLCONF)||void 0===i?void 0:i.wgAgeGateEnabled);return o&&r}waitForAgeGateDataAndSetCookie(){return(0,t.sH)(this,void 0,void 0,function*(){return new Promise(t=>{var e,n,i;const o=this.cookiesManager.get(Xe);if(void 0!==o){this.logger.info("Age gate cookie already set");const r=Ye(null===(i=null===(n=null===(e=this.window.ads)||void 0===e?void 0:e.context)||void 0===n?void 0:n.targeting)||void 0===i?void 0:i.directedAtChildren,o);return void t(this.updateConsents(r))}this.communicationService.on(k,({payload:e})=>{var n,i,o;const r=this.setAgeGateCookie(e),s=Ye(null===(o=null===(i=null===(n=this.window.ads)||void 0===n?void 0:n.context)||void 0===i?void 0:i.targeting)||void 0===o?void 0:o.directedAtChildren,r);"US"===this.geo.country&&s&&(this.usPrivacy.createPrivacyCookie(Z.yes),this.updateConsentCookie(s,!0)),(0,c.Aw)(this.geo)&&s&&this.updateConsentCookie(s,!0),t(this.updateConsents(s))})})})}setAgeGateCookie(t){var e;t||this.logger.warn("Payload data missing, using defaults");const n=null!==(e=null==t?void 0:t.adult)&&void 0!==e&&e?"1":"0";return this.cookiesManager.set(Xe,n,{domain:(0,q.K6)(this.window.location.hostname),expires:(0,X.S)(365,X.y.DAYS)}),n}updateConsentCookie(t,e=!1){this.communicationService.emit(new m(O,{optOut:t,rejectAll:e}))}updateConsents(t){return{ccpaSignal:t,geoRequiresSignal:"US"===this.geo.country,gdprConsent:!t,geoRequiresConsent:(0,c.Aw)(this.geo)}}setIsCoppaSubjectInContext(t){this.contextRepository.set(Ze.partners,"directedAtChildren",t),this.contextRepository.set(Ze.partners,"blockthrough",{directedAtChildren:t})}};tn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(d.AZ)),(0,t.Qj)(1,(0,e.WQ)(d.jf)),(0,t.Qj)(2,(0,e.WQ)(v)),(0,t.Qj)(3,(0,e.WQ)(d.m$)),(0,t.Qj)(4,(0,e.WQ)($)),(0,t.Qj)(5,(0,e.WQ)(Je)),(0,t.Qj)(6,(0,e.WQ)(tt))],tn);let en=class{constructor(t,e,n,i,o){this.communicationService=t,this.logger=e,this.consentProviderFactory=n,this.ageGateHandler=i,this.window=o,this.consentProvider=null,this.consentUpdated=!1,this.logger.setLoggerGroup("OptInService"),this.fandomCmpHandler=new Fe(this.window)}init(e){return(0,t.sH)(this,void 0,void 0,function*(){const n=e.get("icPreferredCMP");this.consentProvider=yield this.consentProviderFactory.get(n),this.consentProvider.subscribe(e=>(0,t.sH)(this,void 0,void 0,function*(){if(this.handleConsents(e),this.ageGateHandler.applies(!_e(e))){const t=yield this.ageGateHandler.waitForAgeGateDataAndSetCookie();this.handleConsents(t)}}))})}onReady(){return F(this.window)}handleConsents(t){this.logger.info("Sending consents: ",t,"update?",this.consentUpdated),this.consentUpdated&&this.sendConsentsToAdEngine(w,t),this.sendConsentsToAdEngine(y,t),this.sendFandomCmpEvent(t),this.consentUpdated||(this.consentUpdated=!0)}sendConsentsToAdEngine(t,e){this.communicationService.emit(new m(t,e))}sendFandomCmpEvent(t){const e=this.fandomCmpHandler.createFromConsents(this.ageGateHandler,this.consentProvider,t);this.fandomCmpHandler.update(e)}};en=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)($)),(0,t.Qj)(1,(0,e.WQ)(v)),(0,t.Qj)(2,(0,e.WQ)(ze)),(0,t.Qj)(3,(0,e.WQ)(tn)),(0,t.Qj)(4,(0,e.WQ)(d.jf))],en);let nn=class{constructor(t,e,n){this.dataWarehouse=t,this.window=e,this.logger=n,this.logger.setLoggerGroup("HemTracking")}activateTracking(){if(!this.isEnabled())return void this.logger.info("Hem Tracking is disabled");const t=this.extractHEMs();Object.keys(t).forEach(e=>{t[e]&&this.dataWarehouse.track(ut.identity,{partner_name:"MediaWiki-"+e,partner_identity_id:t[e]})})}isEnabled(){var t,e,n;return Boolean((null===(n=null===(e=null===(t=this.window.ads)||void 0===t?void 0:t.context)||void 0===e?void 0:e.opts)||void 0===n?void 0:n.userEmailHashes)&&this.window.ads.context.opts.userEmailHashes.length>0)}extractHEMs(){const[t,e,n]=this.window.ads.context.opts.userEmailHashes;return{md5:t,sha1:e,sha256:n}}};nn=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(Re)),(0,t.Qj)(1,(0,e.WQ)(d.jf)),(0,t.Qj)(2,(0,e.WQ)(v))],nn);const on="dtnrObservability";function rn(){return Array.from({length:10},()=>"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-"[Math.floor(64*Math.random())]).join("")}function sn(t){var e;try{const n=performance.getEntriesByType("navigation")[0];if(!n.serverTiming)return null;const i=n.serverTiming.find(e=>e.name===t);return/\bexp_bucket=v\d+-99\b/i.test((null===document||void 0===document?void 0:document.cookie)||"")&&(window[on]=window[on]||[],i||window[on].push("getFromServerTiming failed for("+t+")")),null!==(e=null==i?void 0:i.description)&&void 0!==e?e:null}catch(t){return null}}let an=class{constructor(t,e,n,i,o){this.contextRepository=t,this.cookiesManager=e,this.uuid=n,this.window=i,this.communicationService=o,this.communicationService.on(T,()=>{this.updatePageViewData()}),this.window.addEventListener("platformPageChanged",()=>{this.updatePageViewData()}),this.pageViewNumberGenerator=function(t){return e=>{const n=t.get(e);if(!n)return 1;const i=parseInt(n);return Number.isNaN(i)?1:i+1}}(this.cookiesManager)}set(t,e,n){this.contextRepository.set(Ze.tracking,t,e),this.cookiesManager.set(t,e.toString(),n)}remove(t){this.contextRepository.remove(Ze.tracking,t),this.cookiesManager.remove(t)}updatePageViewData(){var t,e;const n=this.window.location.hostname,i=(0,q.K6)(n);this.contextRepository.set(Ze.tracking,"pvUID",(null===(e=null===(t=this.window.mw)||void 0===t?void 0:t.config)||void 0===e?void 0:e.get("pvUID"))||this.window.pvUID||this.uuid()),this.set("pvNumber",this.pageViewNumberGenerator("pvNumber"),{domain:n,expires:(0,X.S)(30,X.y.MINUTES)}),this.set("pvNumberGlobal",this.pageViewNumberGenerator("pvNumberGlobal"),{domain:i,expires:(0,X.S)(30,X.y.MINUTES)})}updateUserTrackingData(){var t,e,n,i,o;const r=this.window.location.hostname,s=(0,q.K6)(r),a=this.cookiesManager.get("wikia_beacon_id")||this.cookiesManager.get("beaconId")||function(){var t;return null!==(t=sn("beacon"))&&void 0!==t?t:rn()}();this.contextRepository.set(Ze.tracking,"beaconId",a),this.cookiesManager.set("wikia_beacon_id",a,{domain:s,expires:(0,X.S)(180,X.y.DAYS)});const c=this.cookiesManager.get("_b2");this.cookiesManager.set("_b2",c||function(){var t;return null!==(t=sn("b2"))&&void 0!==t?t:`${rn()}.${Date.now()}`}(),{domain:s,expires:(0,X.S)(730,X.y.DAYS)});const d=(null===(e=null===(t=this.window.mw)||void 0===t?void 0:t.config)||void 0===e?void 0:e.get("sessionId"))||this.window.sessionId||this.cookiesManager.get("sessionId"),u={domain:s,expires:(0,X.S)(30,X.y.MINUTES)};this.set("sessionId",d||this.uuid(),u);const l=this.cookiesManager.get("wikia_session_id");this.cookiesManager.set("wikia_session_id",l||rn(),{domain:s,expires:(0,X.S)(180,X.y.DAYS)});const h=(null===(i=null===(n=this.window.mw)||void 0===n?void 0:n.config)||void 0===i?void 0:i.get("userId"))||(null===(o=this.window.RLCONF)||void 0===o?void 0:o.wgUserId)||0;this.contextRepository.set(Ze.tracking,"userId",h)}setup(){this.updateUserTrackingData(),this.updatePageViewData(),this.communicationService.emit(new m(b));const t=new CustomEvent(B);this.window.dispatchEvent(t)}clear(){this.remove("beaconId"),this.remove("sessionId"),this.remove("pvNumber"),this.remove("pvNumberGlobal")}};var cn;an=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(Je)),(0,t.Qj)(1,(0,e.WQ)(d.AZ)),(0,t.Qj)(2,(0,e.WQ)(d.kk)),(0,t.Qj)(3,(0,e.WQ)(d.jf)),(0,t.Qj)(4,(0,e.WQ)($))],an),function(t){t.LOCAL="local",t.IDENTITY_STORAGE="identity_storage"}(cn||(cn={}));class dn{constructor(){this.storage={}}get length(){return Object.keys(this.storage).length}key(t){var e;return null!==(e=Object.keys(this.storage)[t])&&void 0!==e?e:null}clear(){this.storage={}}getItem(t){var e,n;return null!==(n=null===(e=this.storage)||void 0===e?void 0:e[t])&&void 0!==n?n:null}removeItem(t){delete this.storage[t]}setItem(t,e){this.storage[t]=e}}let un=class{constructor(t=()=>window.localStorage){this.fallbackStorage=new dn;try{this.provider=t(),this.isAvailable()||(this.provider=this.fallbackStorage)}catch(t){this.provider=this.fallbackStorage}}isAvailable(){const t=`__o${Date.now()}__`;try{this.provider.setItem(t,t);const e=this.provider.getItem(t)===t;return this.provider.removeItem(t),e}catch(t){return!1}}getItem(t,e=!1){try{const n=this.provider.getItem(t);return null===n||e?n:this.parseValue(n)}catch(n){const i=this.fallbackStorage.getItem(t);return null===i||e?i:this.parseValue(i)}}parseValue(t){try{return JSON.parse(t)}catch(e){return t}}setItem(t,e){const n=e instanceof Object?JSON.stringify(e):e;try{this.provider.setItem(t,n)}catch(e){this.fallbackStorage.setItem(t,n)}return!0}removeItem(t){try{this.provider.removeItem(t)}catch(e){this.fallbackStorage.removeItem(t)}}clear(){try{this.provider.clear()}catch(t){this.fallbackStorage.clear()}}};un=(0,t.Cg)([(0,e._G)()],un);let ln=class{constructor(t,e,n,i){this.logger=t,this.uuid=e,this.storage=n,this.httpClient=i,this.identityStorageKey="identity",this.logger.setLoggerGroup("UserIdentity"),this.identityServiceUrl=bt()+"identity-storage/"}fetchData(){return(0,t.sH)(this,void 0,void 0,function*(){try{const t=yield this.httpClient.get(this.identityServiceUrl,{mode:"cors",credentials:"include"});if(200===t.status)return t.json()}catch(t){this.logger.error("Fetching identity data failed",t)}return this.createFallbackResponse()})}postData(e){return(0,t.sH)(this,void 0,void 0,function*(){const t={ppid:e.ppid},n=this.identityServiceUrl+"identity";try{const e=yield this.httpClient.put(n,t,{mode:"cors",credentials:"include"});if(202===e.status)return e.json()}catch(t){this.logger.error("Synchronizing identity data failed",t)}return Object.assign(Object.assign({},e),{synced:!1})})}getLocalData(){return this.storage.getItem(this.identityStorageKey)}setLocalData(t){this.storage.setItem(this.identityStorageKey,t)}createFallbackResponse(){return{synced:!1,ppid:this.uuid()}}};ln=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(v)),(0,t.Qj)(1,(0,e.WQ)(d.kk)),(0,t.Qj)(2,(0,e.WQ)(un)),(0,t.Qj)(3,(0,e.WQ)(gt))],ln);let hn=class{constructor(t,e){this.instantConfigService=t,this.identityStorageClient=e}get(){return(0,t.sH)(this,void 0,void 0,function*(){const t=this.identityStorageClient.getLocalData();if(t&&!t.synced&&this.shouldRetryIdentitySync(t))this.setRemote(t).catch(t=>{h(t)});else if(!t||this.isIdentityDeprecated(t))return this.getRemote();return t})}isIdentityDeprecated(t){const e=this.instantConfigService.get("icIdentityTtl",6048e5),n=Date.now()-e;return!t.timestamp||t.timestamp<n}shouldRetryIdentitySync(t){const e=Date.now()-36e5;return!t.lastSyncAttemptTimestamp||t.lastSyncAttemptTimestamp<e}getRemote(){return(0,t.sH)(this,void 0,void 0,function*(){const t=yield this.identityStorageClient.fetchData();return this.identityStorageClient.setLocalData(Object.assign(Object.assign({},t),{timestamp:Date.now()})),t})}setRemote(e){return(0,t.sH)(this,void 0,void 0,function*(){const t=yield this.identityStorageClient.postData(e),n=this.identityStorageClient.getLocalData();this.identityStorageClient.setLocalData(Object.assign({ppid:n.ppid,synced:t.synced,timestamp:Date.now()},t.synced?{}:{lastSyncAttemptTimestamp:Date.now()}))})}};hn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(Me)),(0,t.Qj)(1,(0,e.WQ)(ln))],hn);let gn=class{constructor(t,e){this.logger=t,this.identityStorageService=e,this.logger.setLoggerGroup("UserIdentity")}get(){return(0,t.sH)(this,void 0,void 0,function*(){const t=yield this.identityStorageService.get();return this.logger.info(t),t.ppid})}};gn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(v)),(0,t.Qj)(1,(0,e.WQ)(hn))],gn);let pn=class{constructor(t,e,n){this.logger=t,this.uuid=e,this.storage=n}get(){return Promise.resolve(this.storage.getItem("ppid")||this.generatePPID())}generatePPID(){this.logger.info("did not found a PPID in LocalStorage");const t=this.uuid();return this.storage.setItem("ppid",t),t}};pn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(v)),(0,t.Qj)(1,(0,e.WQ)(d.kk)),(0,t.Qj)(2,(0,e.WQ)(un))],pn);let fn=class{constructor(t,e,n,i,o,r,s){this.dataWarehouse=t,this.logger=e,this.windowContextRepository=n,this.instantConfigService=i,this.identityStorageRepository=o,this.localStorageRepository=r,this.communicationService=s,this.logger.setLoggerGroup("UserIdentity")}getPPID(t){switch(this.logger.info("active strategy: ",t),t){case cn.IDENTITY_STORAGE:return this.identityStorageRepository;case cn.LOCAL:default:return this.localStorageRepository}}generatePPID(){return(0,t.sH)(this,void 0,void 0,function*(){try{const t=this.instantConfigService.get("icPpidRepository",cn.LOCAL),e=yield this.getPPID(t).get();this.dataWarehouse.track(ut.identity,{partner_name:"Google",partner_identity_id:e}),this.communicationService.emit(new m(S,{payload:{partnerName:"Google",partnerIdentityId:e}})),this.windowContextRepository.set(Ze.tracking,"ppid",e),this.logger.info("Passed PPID to page-level targeting")}catch(t){this.logger.error("Setting up PPID has failed!",t)}})}setPpid(){return(0,t.sH)(this,void 0,void 0,function*(){this.instantConfigService.get("icPpid",!1)?(this.logger.info("enabled - awaiting setup"),yield this.generatePPID()):this.logger.info("disabled")})}};fn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(Re)),(0,t.Qj)(1,(0,e.WQ)(v)),(0,t.Qj)(2,(0,e.WQ)(Je)),(0,t.Qj)(3,(0,e.WQ)(Me)),(0,t.Qj)(4,(0,e.WQ)(gn)),(0,t.Qj)(5,(0,e.WQ)(pn)),(0,t.Qj)(6,(0,e.WQ)($))],fn);let vn=class{constructor(t,e,n,i){this.platform=t,this.window=e,this.httpClient=n,this.logger=i,this.enabled=!1,this.logger.setLoggerGroup("MetricReporterService"),this.monitoringBaseUrl=`${bt()}adeng/api/identity/meters/`}isReportingEnabled(t){const e=t.get("icMonitorTrafficThreshold",{identity:0});return!!f()||"object"==typeof(n=e)&&!Array.isArray(n)&&null!==n&&(null==e?void 0:e.identity)>0&&e.identity>=100*Math.random();var n}init(t){var e;this.enabled=this.isReportingEnabled(t),this.logger.info(`Metric reporter enabled: ${this.enabled}`),this.enabled&&("complete"===this.window.document.readyState?this.reportPerformanceMetrics():null===(e=this.window)||void 0===e||e.addEventListener("load",()=>this.reportPerformanceMetrics()))}reportIdentityEngineState(t){this.enabled&&this.reportTimedAction(t)}reportConsentEvent(t){this.enabled&&this.reportAction("opt"+(t?"in":"out"))}reportPerformanceMetrics(){const t=this.window.performance.getEntriesByType("navigation");if(t.length>0){const e=t[0].domContentLoadedEventEnd,n=t[0].loadEventEnd;this.reportTimedAction("document_content_loaded",Math.round(e>0?e:this.logger.getTimeDelta())),this.reportTimedAction("document_load_time",Math.round(n>0?n:this.logger.getTimeDelta()))}}send(t,e,n){if(!this.enabled)return;const i=new URL(t,this.monitoringBaseUrl);i.searchParams.set("app",this.platform),i.searchParams.set("action",e),Object.entries(n).forEach(([t,e])=>i.searchParams.set(t,e)),this.httpClient.get(i.toString(),{mode:"cors"},2e3).catch(()=>{this.logger.error("Failed to send data")})}reportAction(t){this.enabled&&this.send("counter",t,{})}reportTimedAction(t,e){if(!this.enabled)return;const n={value:e?e.toString():Math.round(this.logger.getTimeDelta()).toString()};this.send("histogram",t,n)}};vn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(d.i9)),(0,t.Qj)(1,(0,e.WQ)(d.jf)),(0,t.Qj)(2,(0,e.WQ)(gt)),(0,t.Qj)(3,(0,e.WQ)(v))],vn);let mn=class{constructor(t,e,n,i,o){this.window=t,this.instantConfigService=e,this.dataWarehouse=n,this.logger=i,this.metricReporter=o,this.partnerName="liveConnect",this.liveConnectScriptUrl="https://b-code.liadm.com/a-07ev.min.js",this.fallbackQf="0.3",this.live_connect_tracking_events={LIVE_CONNECT_STARTED:"live_connect_started",LIVE_CONNECT_CACHED:"live_connect_cached",LIVE_CONNECT_RESPONDED_UUID:"live_connect_responded_uuid"},this.idConfigMapping=[{id:"unifiedId",name:`${this.partnerName}-unifiedId`},{id:"sha2",name:this.partnerName,params:{qf:"0.3",resolve:"sha2"}},{id:"md5",name:`${this.partnerName}-md5`,params:{qf:"0.3",resolve:"md5"}},{id:"sha1",name:`${this.partnerName}-sha1`,params:{qf:"0.3",resolve:"sha1"}}],this.logger.setLoggerGroup("liveConnect")}isEnabled(){const{ready:t,allowed:e,coppa:n,optOut:i}=this.window.fandomCmp;return Boolean(t&&e&&e.ads&&!n&&!i&&this.instantConfigService.get("icLiveConnect")&&this.instantConfigService.get("icLiveConnectCachingStrategy")&&this.instantConfigService.get("icIdentityPartners"))}init(){return(0,t.sH)(this,void 0,void 0,function*(){var t;this.isEnabled()?(this.setupStorage(),this.shouldLoadScript()?(this.logger.info("loading"),this.dataWarehouse.track(ut.loadTime,this.live_connect_tracking_events.LIVE_CONNECT_STARTED),Y(this.liveConnectScriptUrl,"text/javascript",!1).then(()=>{this.logger.info("loaded"),this.resolveAndTrackIds(),this.logEvent("live-connect-requested")})):(this.dataWarehouse.track(ut.loadTime,this.live_connect_tracking_events.LIVE_CONNECT_CACHED),this.logger.info(`already loaded and available in ${null===(t=this.storageConfig)||void 0===t?void 0:t.type}Storage`))):this.logger.info("disabled")})}resolveAndTrackIds(){var t;if(!this.window.liQ)return void this.logger.warn("window.liQ not available for tracking");const e=null===(t=this.instantConfigService.get("icLiveConnectQf"))||void 0===t?void 0:t.toString();this.window.liQ.resolve(t=>{this.trackIds(t)},t=>{console.error(t)},{qf:e||this.fallbackQf,resolve:this.idConfigMapping.map(t=>t.id)})}trackIds(t){this.logger.info("resolve response:",t),Object.keys(t).forEach(e=>{var n;if(!t[e])return;const i=this.getNameMapping(e);if(!i||this.isAvailableInStorage(i))return;"unifiedId"===e&&this.dataWarehouse.track(ut.loadTime,this.live_connect_tracking_events.LIVE_CONNECT_RESPONDED_UUID);const o=t[e];this.logger.info(`${e}: ${o}`),o&&(null===(n=this.storage)||void 0===n||n.setItem(i,o),this.dataWarehouse.track(ut.identity,{partner_name:i,partner_identity_id:o}))})}getNameMapping(t){var e;return null===(e=this.idConfigMapping.find(e=>e.id===t))||void 0===e?void 0:e.name}setupStorage(){this.storageConfig=this.instantConfigService.get("icLiveConnectCachingStrategy");const t="local"===this.storageConfig.type?()=>this.window.localStorage:()=>this.window.sessionStorage;this.storage=new un(t)}shouldLoadScript(){if(!this.storageConfig)return!0;let t=!1;for(const e of this.storageConfig.mandatoryParams){const n=this.getNameMapping(e);if(n&&!this.isAvailableInStorage(n)){t=!0;break}}return t}isAvailableInStorage(t){var e;return!!(null===(e=this.storage)||void 0===e?void 0:e.getItem(t))}logEvent(t){this.metricReporter.reportTimedAction(t)}};mn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(d.jf)),(0,t.Qj)(1,(0,e.WQ)((0,e.cb)(()=>Me))),(0,t.Qj)(2,(0,e.WQ)(Re)),(0,t.Qj)(3,(0,e.WQ)(v)),(0,t.Qj)(4,(0,e.WQ)(vn))],mn);let yn=class{constructor(t,e,n){this.logger=t,this.contextRepository=e,this.liveConnect=n,this.logger.setLoggerGroup("Partners")}createPartnersContext(){const t=this.contextRepository.get(Ze.tracking,"ppid");t&&this.contextRepository.set(Ze.partners,"anyclip",{ppid:t})}initializeTargetingPartners(){return(0,t.sH)(this,void 0,void 0,function*(){})}initializeTrackingPartners(){return(0,t.sH)(this,void 0,void 0,function*(){this.logger.info("Initializing partners"),yield Promise.all([this.liveConnect.init()])})}};yn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(v)),(0,t.Qj)(1,(0,e.WQ)(Je)),(0,t.Qj)(2,(0,e.WQ)(mn))],yn);let wn=class{constructor(t,e,n,i){this.window=t,this.contextRepository=e,this.browser=n,this.platform=i}init(){const{ready:t,coppa:e,optOut:n}=this.window.fandomCmp;!t||e||n||(this.setAdTargetingGroup(),this.setBrowser()),this.setBrand()}setBrowser(){this.contextRepository.set(Ze.targeting,"browser",this.browser.split(" ")[0])}setBrand(){let t=this.platform;t!==i.FANDOMDESKTOP&&t!==i.FANDOMMOBILE&&t!==i.F2||(t="fandom"),t===i.METACRITIC_NEUTRON&&(t=i.METACRITIC),t===i.TVGUIDE_MTC&&(t=i.TVGUIDE),this.contextRepository.set(Ze.targeting,"brand",t)}getRandomGroup(){return 5*Math.ceil(Math.random()%20*20)}setAdTargetingGroup(){const t=this.getRandomGroup(),e=Array.from({length:21},(t,e)=>100-5*e).filter(e=>e>=t&&e>0);this.contextRepository.set(Ze.targeting,"adGroup",e.toString())}};wn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(d.jf)),(0,t.Qj)(1,(0,e.WQ)(Je)),(0,t.Qj)(2,(0,e.WQ)(d.h5)),(0,t.Qj)(3,(0,e.WQ)(d.i9))],wn);let bn=class{constructor(t,e,n){this.partnersService=t,this.adTargetingGroups=e,this.logger=n,this.logger.setLoggerGroup("TargetingService")}initializeTargeting(){return(0,t.sH)(this,void 0,void 0,function*(){this.logger.info("Setting up targeting"),yield this.partnersService.initializeTargetingPartners(),this.adTargetingGroups.init()})}};bn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(yn)),(0,t.Qj)(1,(0,e.WQ)(wn)),(0,t.Qj)(2,(0,e.WQ)(v))],bn);let Cn=class{constructor(t,e,n,i,o,r,s,a,c,d,u){this.communicationService=t,this.optInService=e,this.hemTrackingService=n,this.trackingContextSetupService=i,this.instantConfigService=o,this.window=r,this.logger=s,this.ppidProvider=a,this.metricReporterService=c,this.partnersService=d,this.targetingService=u,this.logger.setLoggerGroup("IdentityEngine")}init(){return(0,t.sH)(this,void 0,void 0,function*(){yield this.instantConfigService.init(this.communicationService),this.optInService.init(this.instantConfigService),this.metricReporterService.init(this.instantConfigService),this.metricReporterService.reportIdentityEngineState("init")})}run(){this.logger.info("Starting identity engine",`version: ${function(){const t=p.get("identity_version");return t?decodeURIComponent(t):"2.102.1"}()}`),this.optInService.onReady().then(()=>{this.trackingContextSetupService.setup();const{ready:t,optOut:e}=this.window.fandomCmp,n=t&&!e;this.metricReporterService.reportConsentEvent(n),this.updateGTMConsent(n),this.initializeTargeting(),n?this.initializeTracking():(this.loadPhoenixThirdPartyDisabledMode(),this.logger.info("Tracking rejected")),this.communicationService.emit(new m(C)),this.metricReporterService.reportIdentityEngineState("ready")})}updateGTMConsent(t){void 0===this.window.dataLayer&&(this.window.dataLayer=[]),this.window.dataLayer.push({event:"user-consent",consent:t.toString()})}initializeTracking(){return(0,t.sH)(this,void 0,void 0,function*(){this.logger.info("Setting up tracking"),this.hemTrackingService.activateTracking(),yield this.ppidProvider.setPpid(),yield this.partnersService.initializeTrackingPartners(),this.partnersService.createPartnersContext()})}initializeTargeting(){return(0,t.sH)(this,void 0,void 0,function*(){yield this.targetingService.initializeTargeting()})}loadPhoenixThirdPartyDisabledMode(){var t;(null===(t=null===window||void 0===window?void 0:window.PhoenixLoader)||void 0===t?void 0:t.triggerEvent)?(this.logger.info("Load third party in disabled mode"),window.PhoenixLoader.triggerEvent("loadThirdPartyDisabled")):this.logger.info("No PhoenixLoader.triggerEvent defined")}};Cn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)($)),(0,t.Qj)(1,(0,e.WQ)(en)),(0,t.Qj)(2,(0,e.WQ)(nn)),(0,t.Qj)(3,(0,e.WQ)(an)),(0,t.Qj)(4,(0,e.WQ)(Me)),(0,t.Qj)(5,(0,e.WQ)(d.jf)),(0,t.Qj)(6,(0,e.WQ)(v)),(0,t.Qj)(7,(0,e.WQ)(fn)),(0,t.Qj)(8,(0,e.WQ)(vn)),(0,t.Qj)(9,(0,e.WQ)(yn)),(0,t.Qj)(10,(0,e.WQ)(bn))],Cn),e.kL.register(d.AZ,{useValue:r}),e.kL.register(d.kk,{useValue:function(){return"randomUUID"in crypto||(crypto.randomUUID=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))),crypto.randomUUID()}}),e.kL.register(d.kW,{useValue:navigator}),e.kL.register(d.jf,{useValue:window}),e.kL.register(d.h5,{useFactory:function(){const{appName:t,appVersion:e,userAgent:n}=window.navigator,[i,o]=function(t){const[,e,n]=t.match(/(opera|chrome|safari|firefox|msie|trident|CriOS(?=\/))\/?\s*(\d+)/i)||[];return[e,n]}(n);return/trident/i.test(i)?function(t){return`IE ${(/\brv[ :]+(\d+)/g.exec(t)||[""])[1]||""}`}(n):"Chrome"===i||"CriOS"===i?function(t,e){const n=e.match(/\b(OPR|Edg)\/(\d+)/);return null!==n?n.slice(1).join(" ").replace("OPR","Opera").replace("Edg","Edge"):"Chrome "+t}(o,n):function(t,e,n,i,o){const r=o?[i,o]:[e,n,"-?"],s=t.match(/version\/(\d+)/i);return null!==s&&r.splice(1,1,s[1]),r.join(" ")}(n,t,e,i,o)}}),e.kL.register(d.Os,{useFactory:function(){const{userAgent:t}=window.navigator;let e="unknown";return-1!==t.indexOf("Win")&&(e="Windows"),-1!==t.indexOf("Mac")&&(e="OSX"),-1!==t.indexOf("Linux")&&(e="Linux"),-1!==t.indexOf("Android")&&(e="Android"),-1!==t.indexOf("like Mac")&&(e="iOS"),e}}),e.kL.register(d.i9,{useFactory:function(){var t,e,n;const o=null!==(e=null===(t=window.ads)||void 0===t?void 0:t.context)&&void 0!==e?e:{};return(null!==(n=null==o?void 0:o.platform)&&void 0!==n?n:null==o?void 0:o.app)||function(){var t,e,n;return void 0!==window.mw&&void 0!==(null===(n=null===(e=null===(t=window.ads)||void 0===t?void 0:t.context)||void 0===e?void 0:e.opts)||void 0===n?void 0:n.platformName)?window.ads.context.opts.platformName:function(){const{hostname:t,pathname:e}=window.location;switch(!0){case t.includes("fandom"):return i.F2;case t.includes("futhead"):return i.FUTHEAD;case t.includes("muthead"):return i.MUTHEAD;case t.includes("gamespot"):return t.includes("comicvine")?i.COMICVINE:t.includes("gamefaqs")?i.GAMEFAQS:i.GAMESPOT;case t.includes("metacritic"):return e.includes("news")?i.METACRITIC_NEUTRON:i.METACRITIC;case t.includes("tvguide"):return i.TVGUIDE;case t.includes("giantbomb"):return i.GIANTBOMB;case t.includes("fanatical"):return i.FANATICAL;default:return i.FANDOMDESKTOP}}()}()}}),e.kL.register(d.db,{useFactory:t=>{return(e=t.resolve(d.i9))===i.FANDOMDESKTOP?"desktop":e===i.FANDOMMOBILE||s.test(navigator.userAgent)?"smartphone":"desktop";var e}}),e.kL.register(d.aK,{useFactory:t=>function(t,e){var n,i,o;if(null===(i=null===(n=window.fandomContext)||void 0===n?void 0:n.app)||void 0===i?void 0:i.skin)return window.fandomContext.app.skin;const r="desktop"===e?"desktop":"mobile";return(null===(o=window.ads)||void 0===o?void 0:o.context.skin)?`${window.ads.context.skin}_${r}`:a[t]?a[t]+"_"+r:"unknown"}(t.resolve(d.i9),t.resolve(d.db))}),function(){(0,t.sH)(this,void 0,void 0,function*(){void 0===window.fandomCmp&&(window.fandomCmp={ready:!1,coppa:!1,optOut:!1,allowed:{ads:!1,tracking:!1},consentApi:void 0,consentString:void 0,consents:void 0,banner:"loading"}),(()=>{var t;const e="[Consent Queue]",n=t=>!Array.isArray(t)&&"queue"in t,i=(t,e)=>{(t=>{var e;return void 0===t||!0===(null===(e=window.fandomCmp.consents)||void 0===e?void 0:e[t])})(e)&&t(window.fandomCmp.consents)},o=()=>{const t=n(window.consentCallbackQueue)?window.consentCallbackQueue.queue:window.consentCallbackQueue;for(console.debug(e,"flushing consent callback queue",t);t.length;){const{callback:e,category:n}=t.shift();i(e,n)}};if(null!==(t=window.consentCallbackQueue)&&void 0!==t||(window.consentCallbackQueue=[]),window.consentCallback=(t,o,r)=>{if(!g())return console.debug(e,"not ready, queuing callback",t,r),void(n(window.consentCallbackQueue)?window.consentCallbackQueue.push(t,o,r):window.consentCallbackQueue.push({name:t,callback:o,category:r}));i(o,r)},g())o();else{const t=()=>{g()&&(o(),window.removeEventListener("fandomConsentUpdate",t))};window.addEventListener("fandomConsentUpdate",t)}})();try{const t=yield(0,c._U)();e.kL.register(d.m$,{useValue:t});const n=e.kL.resolve(Cn);yield n.init(),(0,c.U4)(t),n.run()}catch(t){h(t)}})}()})()})();
//# sourceMappingURL=index.js.map