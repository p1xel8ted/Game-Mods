var yi=Object.defineProperty;var rt=r=>{throw TypeError(r)};var vi=(r,i,e)=>i in r?yi(r,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[i]=e;var a=(r,i,e)=>vi(r,typeof i!="symbol"?i+"":i,e),nt=(r,i,e)=>i.has(r)||rt("Cannot "+e);var f=(r,i,e)=>(nt(r,i,"read from private field"),e?e.call(r):i.get(r)),O=(r,i,e)=>i.has(r)?rt("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(r):i.set(r,e),V=(r,i,e,t)=>(nt(r,i,"write to private field"),t?t.call(r,e):i.set(r,e),e);function Lt(){return"v173"}function X(r,i){return r==null&&i==null?!0:r==null||i==null?!1:r.toLowerCase()===i.toLowerCase()}function Ii(r){r.cmd??(r.cmd=[]);const i=[...r.cmd];r.cmd.push=(...e)=>{for(const t of e)t(r);return 0};for(const e of i)e(r)}const Ri=r=>{const i=("; "+document.cookie).split("; "+r+"=");return i.length>=2?i.pop().split(";").shift():null},Dt=r=>r!=null&&r.length?` domain=${r};`:"",Ci=(r,i,e)=>{const t=new Date;t.setTime(t.getTime()+e.expires*1e3),document.cookie=`${r}=${i};${Dt(e.domain)} path=${e.path}; expires=${t.toUTCString()}`},Ni=(r,i)=>{document.cookie=`${r}=;${Dt(i.domain)} path=${i.path}; expires=Thu, 01 Jan 1970 00:00:00 GMT`},G={set:Ci,get:Ri,delete:Ni},Ft=()=>{const r=window.location.hostname,i=r.split(".");return i.length<2?r:`.${i[i.length-2]}.${i[i.length-1]}`};function Pi(){const r=window.location.hostname.toLowerCase(),i=/(^|.)(showcase|externaltest|preview|verify|stable|sandbox-[^.]+)\./.exec(r);if(i&&i.length>2)return i[2];const[e]=r.split(".");return e||null}function ke(){var r,i;return((i=(r=window.fandomContext)==null?void 0:r.odyssey)==null?void 0:i.platform)??"app"}function we(r){return new URLSearchParams(window.location.search).get(r)}function H(r){const i=we(r);return Ee(r)&&i===""||i==="1"||i==="true"}function Ee(r){return new URLSearchParams(window.location.search).has(r)}const ki="",wi=/^(?:(v\d+)-)?(\d{2})$/;function Ot(){let r=we("pf_pathfinder_force_bucket")??G.get("exp_bucket");const i=r==null?void 0:r.match(wi);return i&&i.length>=3&&(r=i[2]),r??ki}const Ae="adengadinfo",Li="adengadsizeinfo";var W=(r=>(r.SLOT_REQUESTED_INFO="requested_info",r.SLOT_CODE_SERVED_INFO="code_served_info",r.SLOT_RENDERED_INFO="success_info",r.SLOT_COLLAPSE_INFO="collapse",r.SLOT_FORCE_CLOSE_INFO="force-close",r.SLOT_CLICKED="clicked",r.SLOT_HEAVY_AD_INTERVENTION="heavy-ad-intervention",r))(W||{}),Bt=(r=>(r.SLOT_SIZE_ESTABLISHED="size_established",r))(Bt||{}),U=(r=>(r.BIDDER_RESPONSE="bid_response",r))(U||{}),Qe=(r=>(r.IDENTITY_INFO="identity_info",r))(Qe||{}),Mt=(r=>(r.LABRADOR_KEYVALUES="labrador_keyvalues",r))(Mt||{}),R=(r=>(r.AE_FIRST_LINE_EXEC="ae.firstLineExec",r.AE_AFTER_INIT_PLUGINS="ae.afterInitPlugins",r.AE_AFTER_GPT_WRAPPER_INIT="ae.afterGptWrapperInit",r.AE_AD_ENGINE_INIT="ae.adEngineInit",r.AE_ON_BIDDERS_INIT="ae.onBiddersInit",r.AE_CONFIG_CALLBACK_STARTED="ae.beforeAuction.configCallbackStarted",r.AE_CONFIG_CALLBACK_COMPLETE="ae.beforeAuction.configCallbackComplete",r.AE_AUCTION_START="ae.auctionStart",r.AE_AUCTION_START_A9_START="ae.auctionStart.a9.bidStart",r.AE_AUCTION_END="ae.auctionEnd",r.AE_BEFORE_FIRST_CALL_ADS_REQUEST="ae.beforeFirstCallAdsRequest",r.AE_FIRST_RENDER_CYCLE_COMPLETE="ae.firstRenderCycleComplete",r.AE_GPT_SLOT_REQUESTED_INITIAL="ae.gpt.slotRequested.initial",r.AE_GPT_SLOT_RESPONSE_RECEIVED_INITIAL="ae.gpt.slotResponseReceived.initial",r.AE_GPT_SLOT_RENDERED_ENDED_INITIAL="ae.gpt.slotRenderEnded.initial",r.AE_GPT_SLOT_SLOT_ONLOAD_INITIAL="ae.gpt.slotOnload.initial",r))(R||{}),xt=(r=>(r.AE_AUCTION_DURATION_A9_BID_TOTAL_TIME="ae.d.auctionDuration.a9.bidTotalTime",r.AE_AUCTION_DURATION="ae.d.auctionDuration",r.AE_DURATION_TO_BID="ae.d.firstLineExec_to_auctionStart",r.AE_CONFIG_CALLBACK_DURATION="ae.d.configCallbackDuration",r))(xt||{});const A="adengloadtimes";var _=(r=>(r.SLOT_REQUESTED="requested",r.SLOT_RENDERED="rendered",r.AE_INIT="init",r.VENDOR_TIME_UPDATE="vendor_time_update",r.CREATIVE_RENDERED="creative_rendered",r.PERFORMANCE_MARK="performance_mark",r))(_||{}),Ut=(r=>(r.TRACKING_EVENT="trackingevent",r))(Ut||{}),c=(r=>(r.P1="p1",r.P2="p2",r.P3="p3",r.P4="p4",r))(c||{}),E=(r=>(r.ERROR_NO_TIER_PROVIDED="-2",r.ERROR_DISABLED_TIERS="-1",r.NOT_SUITABLE_FOR_ADVERTISING="2",r.PARTIALLY_MONETIZED="3",r.FULLY_MONETIZED="4",r))(E||{});function Vt(r=window.fandomContext??null){var e;const i=(e=r==null?void 0:r.page)==null?void 0:e.monetizationTier;return typeof i=="number"?i.toString():E.ERROR_NO_TIER_PROVIDED}const Se=()=>{var r;return window.fandomHost??(window.fandomHost={cmd:[]}),(r=window.fandomHost).cmd??(r.cmd=[]),window.fandomHost};function h(r){Se().cmd.push(i=>{i.issueManager.handleIssue({...r,type:"error"})})}const Di="E001",Fi="E002",Oi="E003",Bi="E004",Mi="E005",xi="E006",Ui="E007",Vi="E008",Wi="E009",zi="E010",Gi="E011",hd="E012",Hi="E013",qi="E014",$i="E015",ji="E016",Ki="E017",Yi="E018",Qi="E019",Xi="E020",Zi="E021",Ji="E022",er="E023",tr="E024",ir="E025",rr="E026",nr="E027",sr="E028",ar="E029",or="E030",dr="E031",lr="E032",cr="E033",ur="E034",gr="E040",hr="E041",pr="E042",fr="D001",mr="D002",br="D003",Sr="D004",_r="D005",Er="D006",Ar="D007",Tr="D008",yr="D009",vr="D010",Ir="D011",Rr="D012",Cr="D013",Nr="D014",Pr="D015",kr="D016",wr="D017",Lr="D018",Dr="D019",Fr="D020";function Or(r,i){var e;if(typeof i=="string"){const t=document.getElementsByTagName("script")[0];(e=t==null?void 0:t.parentNode)==null||e.insertBefore(r,t)}else(i??document.body).appendChild(r)}const Br={isAsyncOrDeferOtherwise:!0,node:null,parameters:{},datasets:{}};function Mr(r){const{src:i,isAsyncOrDeferOtherwise:e,node:t,parameters:n,datasets:s}={...Br,...r},o=document.createElement("script");return o.async=!!e,o.defer=!e,o.src=i,n&&Object.keys(n).forEach(d=>{o.setAttribute(d,n[d])}),s&&Object.keys(s).forEach(d=>{o.dataset[d]=s[d]}),Or(o,t),o}async function q(r){try{return await new Promise((e,t)=>{const n=Mr(typeof r=="string"?{src:r,node:null}:r);n.onload=s=>e(s),n.onerror=s=>t(s)})}catch(i){throw Se().cmd.push(e=>e.adBlockManager.adBlockSuspected({suspected:!0,reason:"scriptBlocked"})),h({message:"Failed to load script",error:i,priority:c.P3,data:[{srcOrOptions:r}],code:gr}),i}}function xr(){var r,i,e;return window.fandomTrack??(window.fandomTrack={q:[],cmd:[],registry:{}}),(r=window.fandomTrack).q??(r.q=[]),(i=window.fandomTrack).cmd??(i.cmd=[]),(e=window.fandomTrack).registry??(e.registry={}),window.fandomTrack}function p(r,i){xr().q.push({event:r,payload:i})}async function _e(r,i){try{p(A,{type:_.VENDOR_TIME_UPDATE,eventName:`${r}_started`,time:performance.now()});const e=await q(i);return p(A,{type:_.VENDOR_TIME_UPDATE,eventName:`${r}_loaded`,time:performance.now()}),e}catch(e){throw p(A,{type:_.VENDOR_TIME_UPDATE,eventName:`${r}_error_loading`,time:performance.now()}),e}}function Xe(r,i,e=!1){const t=!r||typeof r!="object",n=!i||typeof i!="object";if(t&&n)return{};if(t)return i;if(n)return r;const s={...r};for(const o in i){const d=r[o],l=i[o];d===void 0?s[o]=l:Array.isArray(d)?s[o]=[...d,...Array.isArray(l)?l:[l]]:typeof d=="object"&&typeof l=="object"?s[o]=Xe(d,l,e):e&&(s[o]=l)}return s}function m(r){Se().cmd.push(i=>{i.issueManager.handleIssue({...r,type:"degradation"})})}class Ur{constructor(){a(this,"storage",{})}get length(){return Object.keys(this.storage).length}key(i){return Object.keys(this.storage)[i]}clear(){this.storage={}}getItem(i){var e;return((e=this.storage)==null?void 0:e[i])??null}removeItem(i){delete this.storage[i]}setItem(i,e){this.storage[i]=e}}function Wt(r){return r instanceof Object&&"expires"in r&&"data"in r&&typeof r.expires=="number"}function Vr(r){return Wt(r)&&r.expires?Date.now()>=r.expires:!1}class zt{constructor(i=()=>window.localStorage){a(this,"fallbackStorage",new Ur);a(this,"provider");try{this.provider=i(),this.isAvailable()||(this.provider=this.fallbackStorage)}catch{this.provider=this.fallbackStorage}}isAvailable(){const i=`__o${Date.now()}__`;try{this.provider.setItem(i,i);const e=this.provider.getItem(i)==i;return this.provider.removeItem(i),e}catch{return!1}}getItem(i,e=!1){try{let t=this.provider.getItem(i);return t===null||e?t:(t=this.parseValue(t),Wt(t)?this.handleTTLItem(i,t):t)}catch{return this.fallbackStorage.getItem(i)}}parseValue(i){try{return JSON.parse(i)}catch{return i}}handleTTLItem(i,e){return Vr(e)?(this.removeItem(i),null):e.data}setItemWithTTL(i,e,t){const s={expires:Date.now()+t,data:e};return this.setItem(i,s)}setItem(i,e,t){if(t)return this.setItemWithTTL(i,e,t);const n=e instanceof Object?JSON.stringify(e):e;try{this.provider.setItem(i,n)}catch{this.fallbackStorage.setItem(i,n)}return!0}removeItem(i){try{this.provider.removeItem(i)}catch{this.fallbackStorage.removeItem(i)}}clear(){try{this.provider.clear()}catch{this.fallbackStorage.clear()}}}function Te(r,i={maxTries:100,fixedTimeout:0}){return(async()=>{let t=0,n="exponentialTimeout"in i?i.exponentialTimeout:i.fixedTimeout,s=r();for(;!s&&t<i.maxTries;)await new Promise(o=>setTimeout(o,n)),s=r(),"exponentialTimeout"in i&&(n*=2),t++;return s})()}function Wr(r,i){return new Promise((e,t)=>{setTimeout(()=>{let n=`Operation timed out after ${r}ms`;i&&(n=`${i} ${n}`),t(new Error(n))},r)})}function j(r,i,e){const t=Wr(i,e);return Promise.race([r,t])}function zr(r=[],i){const e=r.flat().filter(t=>t.status==="rejected");if(e.length>0){for(const n of e)h({message:"Promise rejected",error:n.reason,priority:c.P3,code:hr});let t=`${e.length} of ${r.length} promises were rejected.`;i!=null&&i.logMessagePrefix&&(t=`${i.logMessagePrefix} ${t}`),h({message:t,priority:(i==null?void 0:i.priority)??c.P3,data:e,code:pr})}}async function st(r,i,e){const t=await j(Promise.allSettled(r),i,e==null?void 0:e.logMessagePrefix);return zr(t,e),t}const Gr=-1;function Hr(){var r;return((r=window.RLCONF)==null?void 0:r.wgCityId)??Gr}const at="fandomContextUpdate",qr=(r=window)=>{const i=()=>{var e;return((e=r.fandomContext)==null?void 0:e.tracking)!==void 0&&r.fandomContext.tracking.pvNumber&&r.fandomContext.tracking.pvNumberGlobal&&r.fandomContext.tracking.pvUID};return new Promise(e=>{if(i())return e();const t=()=>{i()&&(r.removeEventListener(at,t),e())};r.addEventListener(at,t)})},Gt=[];function $r(r,i,e=[]){Gt.push({time:performance.now(),name:r,params:i,failures:e})}function jr(){return Gt}function Y(r,i,...e){const t=[];for(const n of r){const s=n.hooks[i];if(typeof s=="function")try{s.call(n,...e)}catch(o){t.push(n.name),h({code:dr,message:`Error running hook ${i} in plugin ${n.name}`,priority:c.P2,error:o})}}$r(i,e,t)}var D;class Kr{constructor(i){O(this,D);V(this,D,i)}get activePluginList(){return f(this,D).getPlugins().map(i=>i.name).sort()}get hooksLog(){return jr()}get adNodes(){return f(this,D).adNodeManager.getAdNodes()}get adEngineState(){return f(this,D).getDebugState()}get runtimeConfig(){return f(this,D).getRuntimeConfig()}get pluginState(){const i={};return f(this,D).getPlugins().forEach(e=>{i[e.name]={...e.getDebugState(),pluginConfig:e.getDebugPluginConfig()}}),i}}D=new WeakMap;function Yr(r){if(H("odyssey_debug"))return new Kr(r)}var te;class Qr{constructor(i,e,t=[]){O(this,te);a(this,"version");a(this,"deploymentEnvironment");a(this,"debug");a(this,"reset");a(this,"disableAdRendering");a(this,"resetCount",0);var n;this.cmd=t,V(this,te,i),this.deploymentEnvironment=((n=window.fandomAds)==null?void 0:n.deploymentEnvironment)??"unknown",this.version=Lt(),this.debug=Yr(e),this.reset=()=>{this.resetCount+=1,e.reset()},this.disableAdRendering=()=>e.adRenderManager.disableAdRendering(),window.fandomAds=this,Ii(this)}getPlugin(i){if(!f(this,te)[i])throw new Error(`Plugin ${i} does not exist`);return f(this,te)[i].api}}te=new WeakMap;const Xr=(function(){const i=typeof document<"u"&&document.createElement("link").relList;return i&&i.supports&&i.supports("modulepreload")?"modulepreload":"preload"})(),Zr=function(r){return"/"+r},ot={},k=function(i,e,t){let n=Promise.resolve();if(e&&e.length>0){let o=function(u){return Promise.all(u.map(b=>Promise.resolve(b).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),l=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));n=o(e.map(u=>{if(u=Zr(u),u in ot)return;ot[u]=!0;const b=u.endsWith(".css"),v=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${v}`))return;const N=document.createElement("link");if(N.rel=b?"stylesheet":Xr,b||(N.as="script"),N.crossOrigin="",N.href=u,l&&N.setAttribute("nonce",l),document.head.appendChild(N),b)return new Promise((Ai,Ti)=>{N.addEventListener("load",Ai),N.addEventListener("error",()=>Ti(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(o){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=o,window.dispatchEvent(d),!d.defaultPrevented)throw o}return n.then(o=>{for(const d of o||[])d.status==="rejected"&&s(d.reason);return i().catch(s)})};function Jr(){var r,i,e;return((e=(i=(r=window.ads)==null?void 0:r.context)==null?void 0:i.opts)==null?void 0:e.isAdTestWiki)===!0}async function en(){const r=[];if(Ee("cid")){const{PassCIDPlugin:n}=await k(async()=>{const{PassCIDPlugin:s}=await import("./PassCIDPlugin-C9iykau-.js");return{PassCIDPlugin:s}},[]);r.push(new n({}))}if(H("gpt_debug")){const{GPTDebugPlugin:n}=await k(async()=>{const{GPTDebugPlugin:s}=await import("./GPTDebugPlugin-B2UbE4C9.js");return{GPTDebugPlugin:s}},[]);r.push(new n({}))}if(Ee("wikia_bidder")||Ee("pbjs_mock")){const{PrebidWikiaDebugPlugin:n}=await k(async()=>{const{PrebidWikiaDebugPlugin:s}=await import("./PrebidWikiaDebugPlugin-06HgfnV1.js");return{PrebidWikiaDebugPlugin:s}},[]);r.push(new n({}))}if(H("bidder_debug")){const{BidderDebugPlugin:n}=await k(async()=>{const{BidderDebugPlugin:s}=await import("./BidderDebugPlugin-3Dd0q8i8.js");return{BidderDebugPlugin:s}},[]);r.push(new n({}))}if(Jr()){const{TestWikiPlugin:n}=await k(async()=>{const{TestWikiPlugin:s}=await import("./TestWikiPlugin-CYN-SKde.js");return{TestWikiPlugin:s}},[]);r.push(new n({}))}return r}function Ht(){var r;return(r=window.icbm)!=null&&r.config?Promise.resolve(window.icbm):new Promise(i=>{const e=()=>{i(window.icbm),window.removeEventListener("instantConfigLoaded",e)};window.addEventListener("instantConfigLoaded",e)})}const le=class le{constructor(i,e){a(this,"currentTier");this.adEngine=i,this.config=e,this.readCurrentTier()}reset(){this.readCurrentTier()}readCurrentTier(){if(!this.config.icTieredMonetizationEnabled){m({code:kr,message:"MonetizationTierEngine: Tiered monetization is not enabled. Defaulting to FULLY_MONETIZED.",priority:c.P4}),this.currentTier=E.FULLY_MONETIZED;return}this.currentTier=Vt(),this.currentTier!==E.NOT_SUITABLE_FOR_ADVERTISING&&this.currentTier!==E.PARTIALLY_MONETIZED&&this.currentTier!==E.FULLY_MONETIZED&&(h({code:ar,message:`MonetizationTierEngine: Invalid monetization tier value: ${this.currentTier}. Falling back to default tier: ${le.DEFAULT_MONETIZATION_TIER}.`,priority:c.P4}),this.currentTier=le.DEFAULT_MONETIZATION_TIER),this.isDemonetized()&&this.adEngine.adRenderManager.disableAdRendering()}filterTieredParamsByCurrentTier(i){if(!i||typeof i!="object"||i===null||Array.isArray(i))return{};const e=E.PARTIALLY_MONETIZED in i?i[E.PARTIALLY_MONETIZED]:void 0,t=E.FULLY_MONETIZED in i?i[E.FULLY_MONETIZED]:void 0;if(e===void 0&&t===void 0)return;const n=this.getCurrentTier();if(n===E.PARTIALLY_MONETIZED)return e;if(n===E.FULLY_MONETIZED)return t}isEnabled(){return this.config.icTieredMonetizationEnabled}getCurrentTier(){return this.currentTier}isMonetized(){return this.isPartiallyMonetized()||this.isFullyMonetized()}isNotSuitableForAdvertising(){return this.getCurrentTier()===E.NOT_SUITABLE_FOR_ADVERTISING}isPartiallyMonetized(){return this.getCurrentTier()===E.PARTIALLY_MONETIZED}isFullyMonetized(){return this.getCurrentTier()===E.FULLY_MONETIZED}isDemonetized(){return!this.isMonetized()}};a(le,"DEFAULT_MONETIZATION_TIER",E.NOT_SUITABLE_FOR_ADVERTISING);let We=le;const ye=200,tn=1,rn="https://pubads.g.doubleclick.net/gampad/ads?";function Ze(r,i=ye){if(!r)return!1;const{top:e,bottom:t}=r.getBoundingClientRect();return t>-i&&e<window.innerHeight+i}function nn(r){return Ze(r,0)}var ae=(r=>(r.EXACT="EXACT",r.LESS_THAN="LESS_THAN",r.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",r.GREATER_THAN="GREATER_THAN",r.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",r))(ae||{});function sn(r){return Array.isArray(r)&&Array.isArray(r[0])&&Array.isArray(r[0][0])}const an={strategy:"once",match:"height",with:"GREATER_THAN"};function qt(r){switch(r){case"EXACT":return(i,e)=>i===e;case"LESS_THAN":return(i,e)=>i<e;case"LESS_THAN_OR_EQUAL":return(i,e)=>i<=e;case"GREATER_THAN":return(i,e)=>i>e;case"GREATER_THAN_OR_EQUAL":return(i,e)=>i>=e;default:throw new Error(`Invalid comparator: ${r}`)}}function $t(r){return Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"}function on(r){if(!$t(r))return!1;if(r[0]===0&&r[1]===0)throw new Error("Invalid size to compare [0,0]");return!0}function ze(r,i,e="EXACT"){if(!$t(r)||!on(i))return!1;const t=typeof e=="function"?e:qt(e),[n,s]=r,[o,d]=i;return o===0?t(s,d):d===0?t(n,o):t(n,o)&&t(s,d)}function dn(r,i,e="EXACT"){if(!Array.isArray(r))return r;const t=qt(e);return r.filter(n=>!ze(n,i,t))}function De(r,i,e="EXACT"){return r.map(t=>{const[n,s]=t;return[n,dn(s,i,e)]})}function ln(r,i){for(const e of r)e.length===2&&e[1].push(i);return r}function ve(r){return r?Array.isArray(r)?r.join("x"):r:""}function Le(r){return r.flatMap(i=>{const e=i[1];return Array.isArray(e)&&(e.length===1||typeof e[0]!="number")?e.map(ve):[ve(e)]})}const cn=/_\d+$/;function J(r){return r.replace(cn,"")}const dt={masterSlotMarker:"<!-- Odyssey Creative Template",collapseAllMarker:'data-premium-takeover="true"',customSizeWidthRange:{min:2,max:20}};var ie;class T extends HTMLElement{constructor(e){super();O(this,ie);a(this,"adNode");V(this,ie,e)}connectedCallback(){this.adNode||this.createAdNode()}disconnectedCallback(){f(this,ie).adNodeManager.removeAdNode(this.adNode),this.adNode=void 0}getBaseSlotName(){var e;return((e=this.adNode)==null?void 0:e.getBaseSlotName())??J(this.id)}getAdUnitPath(){var e;return((e=this.adNode)==null?void 0:e.getAdUnitPath())??null}getTargeting(){var e;return((e=this.adNode)==null?void 0:e.getAllTargeting())??{}}collapse(){var e;(e=this.adNode)==null||e.collapse()}uncollapse(){var e;(e=this.adNode)==null||e.uncollapse()}createAdNode(){if(this.adNode=f(this,ie).adNodeManager.createAdNode(this.id),!this.adNode)throw new Error(`AdNode for element with id[${this.id}] could not be created.`)}}ie=new WeakMap,a(T,"ELEMENT_NAME","fandom-ad"),a(T,"WRAPPER_CLASS","fandom-ad-wrapper");function un(r){customElements.get(T.ELEMENT_NAME)||customElements.define(T.ELEMENT_NAME,class extends T{constructor(){super(r)}})}function gn(r){return r?r.style.height==="0px"||r.style.display==="none":!1}function lt(r){r&&(r.style.height="0px",r.style.display="none")}function ct(r){r&&(r.style.height="",r.style.display="")}var jt=(r=>(r.NOT_RENDERED="not-rendered",r.RENDERING="rendering",r.RENDERED="rendered",r))(jt||{}),C;class hn{constructor(i,e,t){O(this,C);a(this,"renderStatus","not-rendered");a(this,"renderCount",0);a(this,"currentSlotConfig");a(this,"adServerSlot");a(this,"baseSlotName");a(this,"emptyRetryCount",0);a(this,"blocked",!1);a(this,"collapsed",!1);a(this,"takeoverState",null);a(this,"bidderSizes");this.slotName=i,this.slotConfig=e,V(this,C,t),this.currentSlotConfig=structuredClone(e),this.baseSlotName=J(i),this.bidderSizes=this.filterSizesForBidders(),this.hookAdNodeToGptEvents()}hookAdNodeToGptEvents(){this.enableLimitingSizesIfConfigured(),this.listenToSlotRenderEnded()}enableLimitingSizesIfConfigured(){const i=this.getRefreshConfigRemoveSizes();if(!(i!=null&&i.strategy))return;const e=f(this,C).gptWrapper.addSlotEventListener(this.slotName,"impressionViewable",()=>{this.removeSizesFromSlotElement(),i.strategy==="once"&&e()})}listenToSlotRenderEnded(){f(this,C).gptWrapper.addSlotEventListener(this.slotName,"slotRenderEnded",i=>{i!=null&&i.isEmpty?this.emptyRetryCount+=1:this.emptyRetryCount=0,this.renderCount===1&&this.slotConfig.companion===!0&&this.inspectCreativeForTakeover(i.size),this.handleExactSizesToRemoveAfterRender(),this.renderStatus="rendered"})}inspectCreativeForTakeover(i){var o,d;const{masterSlotMarker:e,collapseAllMarker:t,customSizeWidthRange:n}=dt,s=Array.isArray(i)?i[0]:0;if(n.min<=s&&s<=n.max){const l=((d=(o=this.getIFrameElement())==null?void 0:o.contentDocument)==null?void 0:d.body.innerHTML)??"";l.includes(e)&&(this.takeoverState={isMaster:!0,shouldCollapseAll:l.includes(t)})}}setAdServerSlot(i){this.adServerSlot=i}destroy(){this.adServerSlot=void 0,f(this,C).gptWrapper.destroySlots([this])}reset(){var i;this.currentSlotConfig=structuredClone(this.slotConfig),this.bidderSizes=this.filterSizesForBidders(),this.emptyRetryCount=0,this.renderStatus="not-rendered",this.renderCount=0,this.blocked=!1,this.takeoverState=null,this.isCollapsed()&&this.uncollapse(),((i=this.getRefreshConfigRemoveSizes())==null?void 0:i.strategy)==="once"&&this.enableLimitingSizesIfConfigured()}getSlotName(){return this.slotName}setOutOfPageSlotName(i){this.slotName=i}getBaseSlotName(){return this.baseSlotName}getSlotType(){return this.currentSlotConfig.type??"display"}getSlotConfig(){return this.currentSlotConfig}setSlotConfig(i){this.currentSlotConfig=i}getBidderConfig(i){var e;return(e=this.currentSlotConfig.bidders)==null?void 0:e[i]}setBidderConfig(i,e){var t;(t=this.currentSlotConfig).bidders??(t.bidders={}),this.currentSlotConfig.bidders[i]=e}getTakeoverState(){return this.takeoverState}getElement(){return document.getElementById(this.slotName)}getIFrameElement(){var e;const i=(e=this.getElement())==null?void 0:e.getElementsByTagName("iframe");return(i==null?void 0:i[0])??null}getAdUnitPath(){var i;return this.adServerSlot?f(this,C).gptWrapper.getAdUnitPath(this.slotName):((i=this.getElement())==null?void 0:i.dataset.adUnitPath)??null}clearTargeting(i){f(this,C).gptWrapper.clearSlotTargeting(this.slotName,i)}setTargeting(i,e){f(this,C).gptWrapper.setSlotTargeting(this.slotName,i,e)}getTargeting(i){try{return f(this,C).gptWrapper.getSlotTargeting(this.slotName,i)}catch{return[]}}getAllTargeting(){try{return f(this,C).gptWrapper.getAllSlotTargeting(this.slotName)}catch{return{}}}getRenderStatus(){return this.renderStatus}isEligibleToRender(){return!(this.isBlocked()||!this.adServerSlot||this.getRenderStatus()==="rendering"||this.hasEverBeenRequested()&&!this.isRefreshable())}isInViewport(){const i=this.getElement();return i?nn(i):!1}isNearViewport(){const i=this.getElement();return Ze(i,ye)}incrementRenderCount(){this.renderCount+=1,this.setTargeting("rv",this.renderCount.toString())}getRenderCount(){return this.renderCount}isRefreshable(){var i;return!!((i=this.currentSlotConfig.refresh)!=null&&i.enabled)&&this.emptyRetryCount<tn}isBlocked(){return this.blocked}block(){this.blocked=!0}unblock(){this.blocked=!1}isCollapsed(){return this.collapsed||gn(this.getElement())}getParentWrapper(){var e;const i=(e=this.getElement())==null?void 0:e.parentElement;return i!=null&&i.classList.contains(T.WRAPPER_CLASS)?i:null}collapse(){if(this.isCollapsed())return;this.collapsed=!0,this.blocked=!0;const i=this.getElement();i&&(lt(i),lt(this.getParentWrapper()))}uncollapse(){if(!this.isCollapsed())return;this.collapsed=!1,this.blocked=!1;const i=this.getElement();i&&(ct(i),ct(this.getParentWrapper()))}hasEverBeenRequested(){return this.renderStatus!=="not-rendered"}startRender(){this.renderStatus="rendering",this.takeoverState=null,this.incrementRenderCount()}getSizes(){return this.currentSlotConfig.sizes}setSizes(i){this.currentSlotConfig.sizes=i,this.bidderSizes=this.filterSizesForBidders();try{f(this,C).gptWrapper.updateSizeMapping(this.slotName,this.getSizes())}catch{}}getDefaultSizes(){const e=this.getSizes().flatMap(n=>n[1]);return Array.from(new Set(e.map(n=>JSON.stringify(n)))).map(n=>JSON.parse(n))}removeSizes(i,e=ae.EXACT){const t=this.getSizes();if(!Array.isArray(t))return;const n=De(t,i,e);this.setSizes(n)}getBidderSizes(){return this.bidderSizes}filterSizesForBidders(){const i=dt.customSizeWidthRange.max;let e=structuredClone(this.getSizes());e=De(e,[i,i],ae.LESS_THAN_OR_EQUAL);const{doNotEmitSizesForBidders:t}=this.getSlotConfig();return t!=null&&t.length&&t.forEach(n=>{e=De(e,n,ae.EXACT)}),e}getRefreshConfigRemoveSizes(){const{removeSizes:i}=this.currentSlotConfig.refresh??{};if(!(!this.isRefreshable()||!i))return i===!0?an:i}removeSizesFromSlotElement(){var s;const i=this.getRefreshConfigRemoveSizes();if(!i)return;const e=(s=this.getElement())==null?void 0:s.querySelector("iframe");if(!e)return;const t=e.getBoundingClientRect(),n=[i.match==="height"?0:t.width,i.match==="width"?0:t.height];this.removeSizes(n,i.with)}handleExactSizesToRemoveAfterRender(){var e;const i=(e=this.currentSlotConfig.refresh)==null?void 0:e.exactSizesToRemove;i&&i.forEach(t=>{this.removeSizes(t)})}}C=new WeakMap;var ut="Invariant failed";function S(r,i){if(!r){var e=typeof i=="function"?i():i,t=e?"".concat(ut,": ").concat(e):ut;throw new Error(t)}}function F(){return window.fandomContext??null}const pn=1e10;function fn(){return Math.floor(Math.random()*pn)+1}function mn(){return["output=xml_vast4","env=vp","gdfp_req=1","impl=s","unviewed_position_start=1",`url=${encodeURIComponent(window.location.href)}`,`description_url=${encodeURIComponent(window.location.href)}`,`correlator=${fn()}`]}function bn(){var i,e;const r=(e=(i=F())==null?void 0:i.tracking)==null?void 0:e.ppid;return r?[`ppid=${r}`]:[]}function Sn(r){const i=Le(r.getSizes());return i.length>0?i.join("|"):"640x480"}var z,be;class L extends T{constructor(e){super(e);a(this,"unblocked",Promise.withResolvers());a(this,"consentData");O(this,z);O(this,be,Promise.withResolvers());V(this,z,e)}connectedCallback(){var e,t;super.connectedCallback(),Ht().then(n=>{n.config.icUAPJWPlayer||this.unblockVideo()}).catch(()=>{h({code:lr,message:`Error retrieving instant config for video ad node: ${this.id}`,priority:c.P2})}),(t=(e=window.fandomAds)==null?void 0:e.cmd)==null||t.push(()=>{f(this,be).resolve()})}async getVastUrl(){try{return(await this.requestRender()).vastUrl}catch{h({code:cr,message:`Error retrieving VAST URL for video slot name: ${this.id}`,priority:c.P2})}}async requestRender(){return await f(this,be).promise,this.consentData=await f(this,z).privacyManager.waitForConsents(),await this.requestBids(),{vastUrl:this.buildVastUrl(),vastParams:this.buildVastParams()}}unblockVideo(){this.unblocked.resolve()}buildVastParams(){const e=this.getTargeting()??{},{...t}=f(this,z).gptWrapper.getAllTargeting({raw:!1})??{};return{vpos:"preroll",slotTargeting:e,pageTargeting:t}}buildVastUrl(){return this.adNode?`${rn}${this.getParams().join("&")}`:""}async requestBids(){this.adNode&&(this.adNode.incrementRenderCount(),await f(this,z).adRenderManager.requestBids([this.adNode]),await this.waitForResolvedState())}waitForResolvedState(){return this.unblocked.promise}getParams(){return[...mn(),...bn(),...this.getPrivacyParams(),...this.getSlotParams(this.adNode),...this.getCustomParams()].filter(Boolean)}getPrivacyParams(){const{coppa:e,consentApi:t,consentString:n=""}=this.consentData??{},s=[];return t==="usp"?s.push(`us_privacy=${n}`,"gdpr=0"):t==="tcf"&&s.push(`gdpr_consent=${n}`,"gdpr=1"),e&&s.push("tfcd=1"),s}getSlotParams(e){const t=this.getAdUnitPath(),n=Sn(e);return[`iu=${t}`,`sz=${n}`]}getCustomParams(){const e=this.buildVastParams(),t=this.flattenTargetingParams(e),n=Object.entries(t).map(([s,o])=>`${s}=${Array.isArray(o)?o.join(","):o}`).join("&");return[`cust_params=${encodeURIComponent(n)}`]}flattenTargetingParams(e){const t={};for(const[n,s]of Object.entries(e))if(this.isNestedTargetingObject(n,s))Object.assign(t,s);else{const o=s;(typeof o=="string"||Array.isArray(o))&&(t[n]=o)}return t}isNestedTargetingObject(e,t){return(e==="slotTargeting"||e==="pageTargeting")&&typeof t=="object"&&t!==null&&!Array.isArray(t)}}z=new WeakMap,be=new WeakMap,a(L,"ELEMENT_NAME","fandom-video-ad"),a(L,"WRAPPER_CLASS","fandom-video-ad-wrapper");function _n(r){customElements.get(L.ELEMENT_NAME)||customElements.define(L.ELEMENT_NAME,class extends L{constructor(){super(r)}})}class En{constructor(i,e,t){a(this,"adNodes",[]);a(this,"observer");this.adEngine=i,this.slotConfigMap=e,this.hooks=t}reset(){for(const i of this.getAdNodes())this.removeAdNode(i),i.reset(),this.registerAdNode(i)}registerAdNodes(){this.addAllStaticSlots(),this.registerAdNodeComponents()}getSlotConfigMap(){return this.slotConfigMap}getSlotConfig(i){return this.slotConfigMap.baseSlots[i]??this.slotConfigMap.baseSlots[J(i)]??this.slotConfigMap.videoSlots[i]}createAdNode(i,e){var s,o,d,l;const t=e??this.getSlotConfig(i);if(!t){h({code:or,message:`Cannot create adNode, no slot config found for slotName=[${i}]`,priority:c.P2});return}if((o=(s=this.hooks).onBeforeAdNodeCreated)==null||o.call(s,i,t),t.enabled===!1)return;const n=new hn(i,t,this.adEngine);return this.registerAdNode(n),(l=(d=this.hooks).onAdNodeCreated)==null||l.call(d,n),n}registerAdNode(i){this.adNodes.push(i),this.adEngine.gptWrapper.defineSlot(i),this.observer&&this.startObservingElement(i)}removeAdNode(i){const e=i.getElement();e&&this.stopObservingElement(e),this.adNodes=this.adNodes.filter(t=>t.getSlotName()!==i.getSlotName()),i.destroy(),this.hooks.onAdNodeRemoved(i)}getAdNodes(){return this.adNodes}getFirstCallAdNodes(i=!0){return this.adNodes.filter(e=>{const{companion:t=!1,isFirstCall:n}=e.getSlotConfig();return n===!0&&t===i})}getAdNodeByName(i){let e=this.adNodes.find(t=>t.getSlotName()===i);return e??(e=this.adNodes.find(t=>t.getBaseSlotName()===i)),e}getAdNodesByBaseName(i){return this.adNodes.filter(e=>e.getBaseSlotName()===i)}getAdNodeByNameOrFail(i){const e=this.getAdNodeByName(i);return S(e,`adNode is not defined: ${i}`),e}blockSlot(i){this.getAdNodeByNameOrFail(i).block()}unblockSlot(i){this.getAdNodeByNameOrFail(i).unblock()}startRendering(){this.adEngine.adRenderManager.requestRender(this.getFirstCallAdNodes(),!0),this.adEngine.adRenderManager.requestRender(this.getFirstCallAdNodes(!1),!0),this.startIntersectionObserver()}startIntersectionObserver(){this.startObservingSlots(i=>{const e=i.map(t=>{if(t.intersectionRatio>0){const n=this.getAdNodeByName(t.target.id);if(n&&!n.hasEverBeenRequested())return n}}).filter(t=>t!==void 0);this.adEngine.adRenderManager.requestRender([...new Set([...e])])})}startObservingSlots(i){this.observer=new IntersectionObserver(i,{root:null,rootMargin:`${ye}px 0px ${ye}px 0px`,threshold:1}),this.getAdNodes().forEach(e=>{this.startObservingElement(e)})}startObservingElement(i){var t;const e=i.getElement();e&&i.getSlotType()==="display"&&((t=this.observer)==null||t.observe(e))}stopObservingElement(i){var e;(e=this.observer)==null||e.unobserve(i)}registerAdNodeComponents(){un(this.adEngine),_n(this.adEngine)}addAllStaticSlots(){const i=this.getSlotConfigMap().baseSlots,e=T.ELEMENT_NAME.toUpperCase();Object.values(i).forEach(t=>{if(t&&!t.dynamic){const n=document.getElementById(t.name);n&&n.tagName!==e&&this.createAdNode(t.name,t)}})}}const An="-1",Tn="0",yn="1",vn="2",ge="0",x="1",In="registeredUser",Ie="notRegistered",Rn="activeEditor";function Cn(r){var i;return(i=r==null?void 0:r.site)!=null&&i.top1000?"_top1k_wiki":"_not_a_top1k_wiki"}class Nn{constructor(i){a(this,"SERVER_PREFIX","wka1b");this.gptWrapper=i}buildAdUnitPathForNode(i){const e=F(),t=this.gptWrapper.getGamId(),{group:n}=i.getSlotConfig(),s=i.getSlotName(),o=Cn(e),[d="fandom"]=this.gptWrapper.getTargeting("product"),[l="article"]=this.gptWrapper.getTargeting("s2"),[u="all"]=this.gptWrapper.getTargeting("s0"),[b="ucp_desktop"]=this.gptWrapper.getTargeting("skin"),[v="desktop"]=this.gptWrapper.getTargeting("device");return`/${t}/${this.SERVER_PREFIX}.${n}/${s}/${v}/${b}-${d}-${l}/${o}-${u}`}setupPerformanceMarks(i){i.addToCommandQueue(()=>{this.registerEventPerformanceMarkCallback(i,"slotRequested","top_leaderboard"),this.registerEventPerformanceMarkCallback(i,"slotResponseReceived","top_leaderboard"),this.registerEventPerformanceMarkCallback(i,"slotRenderEnded","top_leaderboard"),this.registerEventPerformanceMarkCallback(i,"slotOnload","top_leaderboard")})}registerEventPerformanceMarkCallback(i,e,t){i.addEventListener(e,({slot:n})=>{const s=n.getTargeting("rv");if(s.length>0&&s[0]==="1"&&n.getSlotElementId()===t){const d=this.getInitialSlotPerformanceMarkName(e);d&&performance.mark(d.toString(),{detail:{slotId:t}})}})}getInitialSlotPerformanceMarkName(i){switch(i){case"slotRequested":return R.AE_GPT_SLOT_REQUESTED_INITIAL;case"slotResponseReceived":return R.AE_GPT_SLOT_RESPONSE_RECEIVED_INITIAL;case"slotRenderEnded":return R.AE_GPT_SLOT_RENDERED_ENDED_INITIAL;case"slotOnload":return R.AE_GPT_SLOT_SLOT_ONLOAD_INITIAL}}}function Pn({consentApi:r,optOut:i,coppa:e}){const t=r==="tcf"&&i?x:ge,n=r==="usp"&&i?x:ge,s=kn(e);return{npa:t,rdp:n,monetization:s}}function kn(r){var i,e;if((e=(i=window.fandomContext)==null?void 0:i.site)!=null&&e.directedAtChildren)return r?"restricted":"regular"}const gt="fs";class wn{constructor(i,e,t){a(this,"GAM_ID","5441");a(this,"gptPlatformPlugin");this.adEngine=i,this.initialPageTargeting=e,this.hooks=t,this.gptPlatformPlugin=new Nn(this),window.googletag=window.googletag??{cmd:[]},this.gptPlatformPlugin.setupPerformanceMarks(this)}async enableServices(){return new Promise(i=>{this.addToCommandQueue(()=>{googletag.pubads().disableInitialLoad(),googletag.pubads().enableSingleRequest(),googletag.pubads().enableVideoAds();for(const[e,t]of Object.entries(this.initialPageTargeting))this.setTargeting(e,t);googletag.enableServices(),i()})})}reset(){this.clearAllTargeting()}getGamId(){return this.GAM_ID}setConfig(i){this.addToCommandQueue(()=>{googletag.setConfig(i)})}setTargeting(i,e){if(typeof i=="string"){if(typeof e=="string"||Array.isArray(e)){googletag.pubads().setTargeting(i,e);return}m({code:Dr,message:`Targeting value for key "${i}" must be a string or an array of strings, passed ${e}`,priority:c.P3})}else i?googletag.setConfig({targeting:{...i}}):m({code:Fr,message:`GPT setTargeting was called with invalid parameters: ${i}, ${e}`,priority:c.P3})}getTargeting(i){return googletag.pubads().getTargeting(i)}getAdUnitPath(i){const e=this.getGPTSlotsBySlotNames([i]);return e.length>=1?e[0].getAdUnitPath():null}getAllTargeting(i={}){const{raw:e=!1}=i,t={},n=googletag.pubads().getTargetingKeys();for(const s of n){const o=this.getTargeting(s);e||o.length>1?t[s]=o:o.length===1&&(t[s]=o[0])}return t}clearTargeting(i){googletag.setConfig({targeting:{[i]:null}})}clearAllTargeting(){googletag.setConfig({targeting:null})}updatePublisherProvidedId(i){i&&this.addToCommandQueue(()=>{this.setTargeting("ppid",i),googletag.pubads().setPublisherProvidedId(i)})}updatePrivacySettings(i){const{npa:e,rdp:t,monetization:n}=Pn(i);this.addToCommandQueue(()=>{n&&this.setTargeting("monetization",n),this.setTargeting("npa",e),this.setTargeting("rdp",t),googletag.pubads().setPrivacySettings({nonPersonalizedAds:e===x,restrictDataProcessing:t===x,childDirectedTreatment:i.coppa===!0})})}defineOutOfPageSlot(i,e,t){const{format:n="INTERSTITIAL"}=t??{},s=googletag.defineOutOfPageSlot(e,googletag.enums.OutOfPageFormat[n]??i.getSlotConfig().name);return s!==null&&i.setOutOfPageSlotName(s==null?void 0:s.getSlotElementId()),s}defineSlot(i){this.addToCommandQueue(()=>{var d;const e=i.getSlotConfig(),t=i.getAdUnitPath()??this.gptPlatformPlugin.buildAdUnitPathForNode(i);let n=null;const s=(d=e.dynamic)==null?void 0:d.outOfPage;if(s?n=this.defineOutOfPageSlot(i,t,s):n=googletag.defineSlot(t,i.getDefaultSizes(),i.getSlotName()),n===null){h({code:ur,message:`GptWrapper: Slot ${i.getSlotName()} could not be defined.`,priority:c.P2,data:i});return}i.setAdServerSlot(n),Object.entries(e.targeting).forEach(([l,u])=>{n.setTargeting(l,u)});const o=i.getSizes();o&&!s&&n.defineSizeMapping(o),n.addService(googletag.pubads()),e.companion&&n.addService(googletag.companionAds())})}getGPTSlotsByAdNodes(i){return this.getGPTSlotsBySlotNames(i.map(e=>e.getSlotName()))}getSlotById(i){return googletag.pubads().getSlots().find(e=>e.getSlotElementId()===i)??null}getGPTSlotsBySlotNames(i){const e=new Set(i),t=googletag.pubads().getSlots().filter(o=>e.has(o.getSlotElementId())),n=t.map(o=>o.getSlotElementId()),s=[...e].filter(o=>!n.includes(o));return s.length>0&&(console.error("Slots missing from googletag:",s),Se().cmd.push(o=>o.adBlockManager.adBlockSuspected({suspected:!0,reason:"nodeMissing"}))),t}addKeyValForTruncationCheck(){this.clearTargeting(gt),this.setTargeting(gt,"t")}requestSlots(i){this.hooks.onBeforeAdsRequest(i),this.addKeyValForTruncationCheck(),googletag.pubads().refresh(this.getGPTSlotsByAdNodes(i))}destroySlots(i){i&&googletag.destroySlots(this.getGPTSlotsByAdNodes(i))}clearSlotTargeting(i,e){const[t]=this.getGPTSlotsBySlotNames([i]);S(t,`Slot ${i} not found`),t.clearTargeting(e)}setSlotTargeting(i,e,t){const[n]=this.getGPTSlotsBySlotNames([i]);S(n,`Slot ${i} not found`),n.setTargeting(e,t)}getSlotTargeting(i,e){const[t]=this.getGPTSlotsBySlotNames([i]);return S(t,`Slot ${i} not found`),t.getTargeting(e)}getAllSlotTargeting(i,e={}){const{raw:t=!0}=e,[n]=this.getGPTSlotsBySlotNames([i]);S(n,`Slot ${i} not found`);const s=n.getTargetingKeys();return Object.fromEntries(s.map(o=>{let d=n.getTargeting(o);return!t&&Array.isArray(d)&&d.length===1&&(d=d[0]),[o,d]}))}updateSizeMapping(i,e){const[t]=this.getGPTSlotsBySlotNames([i]);return S(t,`Slot ${i} not found`),t.defineSizeMapping(e)}addToCommandQueue(i){googletag.cmd.push(i)}addEventListener(i,e){googletag.pubads().addEventListener(i,e)}removeEventListener(i,e){googletag.pubads().removeEventListener(i,e)}addSlotEventListener(i,e,t){const n=s=>{s.slot.getSlotElementId()===i&&t(s)};return this.addEventListener(e,n),()=>this.removeEventListener(e,n)}}class Ln{constructor(i,e){a(this,"consentData");a(this,"pendingWaitForConsentResolver");a(this,"pendingWaitForBlockingResolver");this.adEngine=i,this.hooks=e,this.consentData=window.fandomCmp,this.startConsentUpdateListener()}startConsentUpdateListener(){const i=()=>{this.fandomCmpReady(window.fandomCmp)&&this.fandomConsentUpdateHandler()};window.addEventListener("fandomConsentUpdate",i),i()}async fandomConsentUpdateHandler(){var i,e;this.consentData=window.fandomCmp,this.updateGptPrivacySettings(),(i=this.pendingWaitForConsentResolver)==null||i.call(this,this.consentData),this.pendingWaitForConsentResolver=void 0,this.consentData.allowed.ads&&((e=this.pendingWaitForBlockingResolver)==null||e.call(this,this.consentData),this.pendingWaitForBlockingResolver=void 0),this.notifyPluginsOfConsentChange()}updateGptPrivacySettings(){this.consentData&&this.adEngine.gptWrapper.updatePrivacySettings(this.consentData)}notifyPluginsOfConsentChange(){S(this.consentData,"Expected window.fandomCmp to have consent data before calling onConsentUpdated"),this.hooks.onConsentUpdated(this.consentData)}fandomCmpReady(i){return(i==null?void 0:i.ready)===!0}async waitForConsents(){return new Promise(i=>{this.consentData!==void 0&&this.fandomCmpReady(this.consentData)&&i(this.consentData),this.pendingWaitForConsentResolver=i})}async waitForAdsAllowed(){return new Promise(i=>{var e,t;((e=this.consentData)==null?void 0:e.ready)===!0&&((t=this.consentData)==null?void 0:t.allowed.ads)===!0&&i(this.consentData),this.pendingWaitForBlockingResolver=i})}}class Dn{constructor(i,e,t){a(this,"enableBidding",!0);a(this,"enableAdRendering",!0);a(this,"renderCycleCount",0);a(this,"isFirstRenderCycleComplete",!1);this.adEngine=i,this.config=e,this.hooks=t}async waitForFirstRenderCycleComplete(){return this.isFirstRenderCycleComplete?!0:await Te(()=>this.isFirstRenderCycleComplete,{maxTries:50,fixedTimeout:50})}async finishFirstRenderCycle(i=[]){await Te(()=>i.every(t=>t.getRenderStatus()===jt.RENDERED),{maxTries:50,fixedTimeout:50});let e=Tn;for(const t of i){const n=t.getTakeoverState();if(n!=null&&n.isMaster){e=n.shouldCollapseAll?yn:vn;break}}this.adEngine.gptWrapper.setTargeting("odyssey_takeover",e),this.hooks.onFirstRenderCycleComplete(this.adEngine,i,e),this.isFirstRenderCycleComplete=!0,performance.mark(R.AE_FIRST_RENDER_CYCLE_COMPLETE)}disableBidding(){this.enableBidding=!1}isBiddingEnabled(){return this.enableBidding}disableAdRendering(){this.disableBidding(),this.enableAdRendering=!1}isAdRenderingEnabled(){return this.enableAdRendering}getDebugState(){return{enableBidding:this.enableBidding,enableAdRendering:this.enableAdRendering,renderCycleCount:this.renderCycleCount,isFirstRenderCycleComplete:this.isFirstRenderCycleComplete}}async start(){if(this.enableBidding){const i=[];this.hooks.onBiddersInit(this.adEngine,i);try{await st(i,this.config.icAdEngineBidderInitTimeoutMS,{logMessagePrefix:"onBiddersInit",priority:c.P3})}catch(e){m({code:wr,message:"onBiddersInit timed out",priority:c.P3,error:e})}performance.mark(R.AE_ON_BIDDERS_INIT)}if(this.enableAdRendering){this.adEngine.adNodeManager.startRendering();return}}async reset(){this.isFirstRenderCycleComplete=!1,this.renderCycleCount=0,this.enableAdRendering=!0,this.enableBidding=!0}async requestBids(i,e){if(!this.enableBidding)return;const t={auctionId:crypto.randomUUID(),adNodes:i,pageTargeting:this.adEngine.gptWrapper.getAllTargeting(),renderCycleCount:e},n=(...s)=>{this.hooks.onCreateBidderAdUnit(...s)};try{const s=[];this.hooks.onCreateBiddersRequests(s,t,this.adEngine,n),performance.mark(R.AE_AUCTION_START,{detail:{renderCycleCount:e,auctionId:t.auctionId}}),await st([...s],this.config.icAdEngineOnCreateBiddersRequestsTimeoutMS,{logMessagePrefix:`onCreateBiddersRequests [cycle ${e}]`,priority:c.P3}),performance.mark(R.AE_AUCTION_END,{detail:{renderCycleCount:e,auctionId:t.auctionId}})}catch(s){m({code:Lr,message:"Bidders requests timed out",priority:c.P3,error:s})}}async requestRender(i=[],e=!1){if(!this.enableAdRendering)return;const t=[];for(const n of i)(e||n.isEligibleToRender())&&(n.startRender(),t.push(n));t.length&&await this.render(t)}async render(i=[]){this.renderCycleCount++;const e=this.renderCycleCount;await this.requestBids(i,e),e===1&&(this.config.icAdEngineWaitBeforeFirstAdsRequestMS>0&&await new Promise(t=>setTimeout(t,this.config.icAdEngineWaitBeforeFirstAdsRequestMS)),this.hooks.onBeforeFirstCallAdsRequest(this.adEngine.gptWrapper,this.adEngine.adNodeManager),performance.mark(R.AE_BEFORE_FIRST_CALL_ADS_REQUEST)),e>1&&!this.isFirstRenderCycleComplete&&await this.waitForFirstRenderCycleComplete(),this.enableAdRendering&&this.adEngine.gptWrapper.requestSlots(i),e===1&&await this.finishFirstRenderCycle(i)}}class Fn{constructor(i,e,t){a(this,"monetizationTierEngine");a(this,"gptWrapper");a(this,"privacyManager");a(this,"adNodeManager");a(this,"adRenderManager");this.runtimeConfig=i,this.plugins=e,this.initialPageTargeting=t,this.adRenderManager=new Dn(this,this.runtimeConfig.instantConfig,{onBiddersInit:this.generateHookCallback("onBiddersInit"),onCreateBiddersRequests:this.generateHookCallback("onCreateBiddersRequests"),onCreateBidderAdUnit:this.generateHookCallback("onCreateBidderAdUnit"),onBeforeFirstCallAdsRequest:this.generateHookCallback("onBeforeFirstCallAdsRequest"),onFirstRenderCycleComplete:this.generateHookCallback("onFirstRenderCycleComplete")}),this.monetizationTierEngine=new We(this,this.runtimeConfig.instantConfig),this.gptWrapper=new wn(this,t,{onBeforeAdsRequest:this.generateHookCallback("onBeforeAdsRequest")}),this.privacyManager=new Ln(this,{onConsentUpdated:this.generateHookCallback("onConsentUpdated")}),this.adNodeManager=new En(this,i.slots,{onAdNodeCreated:this.generateHookCallback("onAdNodeCreated"),onBeforeAdNodeCreated:this.generateHookCallback("onBeforeAdNodeCreated"),onAdNodeRemoved:this.generateHookCallback("onAdNodeRemoved")})}generateHookCallback(i){return(...e)=>this.runHook(i,...e)}runHook(i,...e){Y(this.plugins,i,...e)}async start(){await this.adRenderManager.start()}reset(){this.adRenderManager.reset(),this.monetizationTierEngine.reset(),this.gptWrapper.reset(),this.adNodeManager.reset(),this.runHook("onAdEngineReset",this),this.start()}getDebugState(){return{...this.adRenderManager.getDebugState()}}getRuntimeConfig(){return this.runtimeConfig}getPlugins(){return this.plugins}}async function On(){return new Promise(r=>{window.fandomHost=window.fandomHost??{},window.fandomHost.cmd=window.fandomHost.cmd??[],window.fandomHost.cmd.push(r)})}async function Bn(r,i){const e={};Y(i,"onInitPageTargeting",e),Y(i,"onInitSlotConfigMap",r.slots);const t=new Fn(r,i,e);return await Promise.all([t.privacyManager.waitForConsents(),On()]),await t.gptWrapper.enableServices(),Y(i,"onAfterGptWrapperInit",t.gptWrapper),performance.mark(R.AE_AFTER_GPT_WRAPPER_INIT),t.adNodeManager.registerAdNodes(),Y(i,"onAfterAdNodeManagerInit",t.adNodeManager,r.slots.baseSlots),await t.privacyManager.waitForAdsAllowed(),Y(i,"onAdEngineInit",t),performance.mark(R.AE_AD_ENGINE_INIT),t}function Mn(r){return!!(r!=null&&r.baseSlots)}function xn(r){return Mn(r)?{app:r.app,version:r.version,slots:r}:r}async function Un(r){const i=window.fandomAdsSlotsConfig;if(i){const e=xn(i);return window.fandomAdsSlotsConfig=e,e}else{const{loadConfig:e}=await k(async()=>{const{loadConfig:n}=await import("./handleDynamicConfig-ip7pmO8r.js");return{loadConfig:n}},[]),t=await e(r);return window.fandomAdsSlotsConfig=t,t}}async function Vn(r,i,e){return{...await Un(e),instantConfig:r,activeLabradorKeyValues:i}}var re;class g{constructor(i){O(this,re);a(this,"api");a(this,"hooks",{});this.pluginConfig=i}static isEnabled(i,e){return!!e&&(i==null?void 0:i.enabled)!==!1}getDebugState(){return{}}getDebugPluginConfig(){return this.pluginConfig}setPlugins(i){V(this,re,i)}usePlugin(i){var e,t;return(t=(e=f(this,re))==null?void 0:e.get(i))==null?void 0:t.api}useExperiment(i){var e,t;return(t=(e=f(this,re))==null?void 0:e.get(i))==null?void 0:t.api}}re=new WeakMap;function Kt(){var r;return((r=window.ads)==null?void 0:r.context)??null}class Wn{constructor(i,e){a(this,"AMZN_TOKEN_NAME","AMZN-Token");a(this,"APSTAG_RECORD_KEY","apstagRecord");a(this,"APSTAG_HEM_SENT_KEY","apstagHEMsent");a(this,"APSTAG_HEM_OPTOUT_KEY","apstagHEMoptOut");a(this,"AMAZON_TOKEN_TTL",336*60*60*1e3);a(this,"storage",new zt);this.config=i,this.consentData=e}updateConsentData(i,e){this.consentData=i,this.updateApstagPublisherAudienceConfig(e)}updateApstagPublisherAudienceConfig({gdprParam:i}){var s,o;if(this.cleanUpA9TokensIfApplicable(),!this.isHemSyncingEnabled())return;const e=this.resolveHashedEmailSource(),{optOut:t}=this.consentData;if(!e){m({code:br,message:"Can't update HEM without an email record.",priority:c.P4}),t&&window.apstag&&((o=(s=window.apstag).dpa)==null||o.call(s));return}const n={...i,optOut:t,hashedRecords:[{type:"email",record:e}]};this.syncHemIfApplicable(n)}getApstagRecordFromStorage(){return this.storage.getItem(this.APSTAG_RECORD_KEY)}getHashedEmailFromAdsContext(){var e;const i=(e=Kt())==null?void 0:e.opts.userEmailHashes;return!Array.isArray(i)||(i==null?void 0:i.length)!==3?null:i[2]}resolveHashedEmailSource(){return this.getApstagRecordFromStorage()??this.getHashedEmailFromAdsContext()??null}syncHemIfApplicable(i){var s,o,d,l;const e=(o=(s=i==null?void 0:i.hashedRecords)==null?void 0:s[0])==null?void 0:o.record,{optOut:t}=i;if(!e)return;const n=this.deriveApstagTokenizationFunction(t);n&&window.apstag&&((l=(d=window.apstag)[n])==null||l.call(d,i,()=>{this.updateApstagConsentInLocalStorage(e,t)}))}deriveApstagTokenizationFunction(i){return this.checkIfUserConsentChanged(i)?"upa":this.checkIfA9TokenShouldBeRenewed()?"rpa":null}checkIfA9TokenShouldBeRenewed(){const i=this.storage.getItem(this.APSTAG_HEM_SENT_KEY,!0);if(!i)return!0;const e=parseInt(i,10);return isNaN(e)?!0:e<Date.now()}checkIfUserConsentChanged(i){const e=this.storage.getItem(this.APSTAG_HEM_OPTOUT_KEY,!1);return e!==null&&i!==e}isHemSyncingEnabled(){return this.config.icA9HEM&&!this.config.icA9CleanHEM}updateApstagConsentInLocalStorage(i,e){this.storage.setItem(this.APSTAG_RECORD_KEY,i),this.storage.setItem(this.APSTAG_HEM_OPTOUT_KEY,e.toString()),G.get(this.AMZN_TOKEN_NAME)?this.storage.setItem(this.APSTAG_HEM_SENT_KEY,(Date.now()+this.AMAZON_TOKEN_TTL).toString()):this.storage.removeItem(this.APSTAG_HEM_SENT_KEY)}cleanUpA9TokensIfApplicable(){this.config.icA9CleanHEM&&this.cleanUpA9Tokens()}cleanUpA9Tokens(){var i,e;(G.get(this.AMZN_TOKEN_NAME)||this.storage.getItem(this.APSTAG_RECORD_KEY))&&((e=(i=window.apstag)==null?void 0:i.dpa)==null||e.call(i),this.storage.removeItem(this.APSTAG_RECORD_KEY),this.storage.removeItem(this.APSTAG_HEM_SENT_KEY),this.storage.removeItem(this.APSTAG_HEM_OPTOUT_KEY),G.delete(this.AMZN_TOKEN_NAME,{path:"/"}))}}function zn(r,i,e){var n,s;return(s=(n=r.filter(([o])=>o[0]<=i&&o[1]<=e).sort(([o],[d])=>d[0]-o[0]||d[1]-o[1]))==null?void 0:n[0])==null?void 0:s[1]}const Yt=10,Gn={currency:"USD",value:Yt};class Hn{constructor(i,e,t,n,s){a(this,"apstagConfigParams");a(this,"a9HemSyncer");this.consentData=i,this.timeout=e,this.config=t,this.apstagConfigParams={pubID:n,adServer:"googletag",videoAdServer:"DFP",simplerGPT:!0,deals:!0,bidTimeout:this.timeout,signals:s?{ortb2:s}:{}},this.a9HemSyncer=new Wn(this.config,this.consentData),this.init(!0)}configureCommand(i,e){window.apstag._Q.push([i,e])}updateApstagOrtb2Signals(i){i&&(this.apstagConfigParams.signals.ortb2=i,this.updateApstagConfig())}updateApstagConfig(){if(window.apstag){const{gdprParam:i,uspParam:e}=this.getConsentsParams();window.apstag.init({...this.apstagConfigParams,...i,...e})}}init(i){window.apstag=window.apstag??{_Q:[],init:(...t)=>{this.configureCommand("i",t)},fetchBids:(...t)=>{this.configureCommand("f",t)}};const e=this.getConsentsParams();this.updateApstagConfig(),i&&this.a9HemSyncer.updateApstagPublisherAudienceConfig(e)}getConsentsParams(){return{gdprParam:this.consentData.consentApi==="tcf"?{gdpr:{cmpTimeout:this.timeout}}:{gdpr:{enabled:!1}},uspParam:this.getUspParam()}}handleConsentChange(i){this.consentData=i;const e=this.getConsentsParams();this.updateApstagConfig(),this.a9HemSyncer.updateConsentData(i,e)}getUspParam(){return this.consentData.consentApi==="usp"&&this.consentData.consentString?{params:{us_privacy:this.consentData.consentString}}:{}}async requestBids(i,e){if(!this.consentData.allowed.ads||this.consentData.coppa)return[];S(window.apstag,"window.apstag has not been initialized yet");const t={slots:this.buildBidsConfig(i.adNodes),timeout:this.timeout};if(!t.slots.length)return[];e("a9",i,t);const n=new Promise(s=>{var o;(o=window.apstag)==null||o.fetchBids(t,d=>{var l,u;(u=(l=window.apstag)==null?void 0:l.setDisplayBids)==null||u.call(l),s(d)})});try{return await j(n,this.timeout)}catch{return this.buildTimedOutResponse(t.slots)}}buildTimedOutResponse(i){return i.map(e=>({slotID:e.slotID,timedOut:!0}))}transformA9Config(i,e){if(!i.sizeConfig)return i;const t={...i,sizes:zn(e,window.innerWidth,window.innerHeight)};return delete t.sizeConfig,t}buildBidsConfig(i){const e=[];return i.forEach(t=>{const n=t.getBidderConfig("a9");if(!n)return;const s=t.getSlotName(),o=t.getBidderSizes(),d=this.transformA9Config(n,o),l={slotName:t.getAdUnitPath()??s,slotID:s,floor:Gn,...d};e.push(l)}),e}}function qn(r){const i=parseFloat(r);return isNaN(i)?"-1":`us_tier${$n(i)}`}function $n(r){return r>=.7?1:r>=.5?2:3}const Qt=6,jn="1217",Kn="bsr004",Yn="1014",Qn=40,Xn=50,ht={main_vertical:{from:"main_vertical",limit:"one-of-each"},main_entity_type:{from:"main_entity_type",limit:"one-of-each"},genre:{from:"genres",addConfidence:"site"},subgenre:{from:"subgenres",addConfidence:"site"},vertical:{from:"verticals",addConfidence:"all"},themes:{from:"themes",addConfidence:"site"},fran:{from:"franchises"},trending:{from:"trending_score",transformValue:qn}};function Xt(r){const i=(window==null?void 0:window.fandomTaxonomy)??{};return(i==null?void 0:i[r])??[]}function B(r){const i=[jn,Kn],e=Xt(r),t=(e==null?void 0:e.iab_categories)??[];return t.length>0?i.push(...t):i.push(Yn),Array.from(new Set(i.filter(Boolean)))}function Zn(r){return typeof r!="number"||isNaN(r)?"":`_c${0+Math.floor(r*10)}`}function Jn(r){return typeof r!="object"||r===null?r:Object.keys(r).reduce((i,e)=>(r[e]&&r[e].length>0&&(i[e]=r[e]),i),{})}function es(r){return typeof r=="object"&&r&&typeof r.value=="string"&&r.value.length>0&&typeof r.confidence=="number"}const ts={site:"s_",page:"p_"};function pt(r,i,e){const t=Xt(r);let n=(t==null?void 0:t[i])??[];return Array.isArray(n)||(n=[n]),n.filter(es).map(o=>{const d=typeof e=="function"?e(o.value):o.value;return{...o,value:`${ts[r]}${d}`}})}function is(r){const{from:i,addConfidence:e=!1,limit:t,transformValue:n}=r,s=ft(pt("site",i,n),e==="site"||e==="all"),o=ft(pt("page",i,n),e==="page"||e==="all"),d=t==="one-of-each"?1:void 0;return rs([...s.slice(0,d),...o.slice(0,d)]).filter(Boolean).map(ss).slice(0,Xn)}function rs(r){return r.sort((i,e)=>e.confidence-i.confidence)}function ft(r,i){return i?r.map(ns):r}function ns(r){return{...r,value:`${r.value}${Zn(r.confidence)}`}}function ss(r){return r.value.substring(0,Qn)}function Fe(){const r=Object.keys(ht).reduce((i,e)=>(i[e]=is(ht[e]),i),{});return Jn(r)}const as=500;class Zt extends g{constructor(){super(...arguments);a(this,"name","FandomTaxonomyPlugin");a(this,"targetingApplied",!1);a(this,"hooks",{onAfterGptWrapperInit:e=>{this.waitForFandomTaxonomyPresent().then(()=>this.updateGpt(e))}});a(this,"api",{getIABPageCategories:()=>B("page"),getIABSiteCategories:()=>B("site"),getTargetingKeyValues:()=>Fe()})}getDebugState(){return{isTargetingApplied:this.targetingApplied,iabSiteCategories:B("site"),iabPageCategories:B("page"),taxonomyKeyValues:Fe()}}async waitForEvent(){return new Promise(e=>{const t=()=>e();window.addEventListener("FandomTaxonomyUpdated",()=>{window.removeEventListener("FandomTaxonomyUpdated",t),e()})})}async waitForFandomTaxonomyPresent(){if(!window.fandomTaxonomy)try{await j(Promise.any([Te(()=>!!window.fandomTaxonomy),this.waitForEvent()]),as)}catch{h({code:zi,message:"waitForFandomTaxonomyPresent timed out",priority:c.P2})}}updateGptConfig(e){e.setConfig({pps:{taxonomies:{IAB_CONTENT_2_2:{values:[...new Set([...B("site"),...B("page")])]}}}})}getIABKeyValues(){return{cattax:[Qt.toString()],cat:B("site"),pagecat:B("page")}}updateGptKVs(e){Object.entries({...this.getIABKeyValues(),...Fe()}).forEach(([t,n])=>{const s=e.getTargeting(t);s&&s.length>0&&(n=[...new Set([...s,...n])]),e.setTargeting(t,n)})}updateGpt(e){this.targetingApplied||(this.targetingApplied=!0,this.updateGptKVs(e),this.updateGptConfig(e))}}const Jt=.1,os={buckets:[{max:3,increment:.01},{max:8,increment:.05},{max:20,increment:.5},{max:46,increment:1}]},ds={buckets:[{max:3,increment:.01},{max:8,increment:.05},{max:20,increment:.5}]},Je={data:{currency:"USD",default:Jt}},ls={cache:{url:"https://prebid.adnxs.com/pbc/v1/cache"},debug:!1,enableTIDs:!0,enableSendAllBids:!0,sendBidsControl:{bidLimit:2,dealPrioritization:!0},priceGranularity:"dense",mediaTypePriceGranularity:{banner:os,video:ds},targetingControls:{alwaysIncludeDeals:!0,allowTargetingKeys:["AD_ID","BIDDER","PRICE_BUCKET","UUID","SIZE","DEAL","CACHE_HOST","SOURCE"],allowSendAllBidsTargetingKeys:["AD_ID","BIDDER","PRICE_BUCKET","UUID","SIZE","DEAL"]},timeoutBuffer:400,useBidCache:!0,bidCacheFilterFunction:r=>r.mediaType!=="video",userSync:{filterSettings:{iframe:{bidders:"*",filter:"include"},image:{bidders:"*",filter:"include"}},userIds:[],auctionDelay:50,syncsPerBidder:3,syncDelay:6e3},floors:Je,ozone:{enhancedAdserverTargeting:!1,oz_whitelist_adserver_keys:[]},rubicon:{singleRequest:!0}},cs={standard:{storageAllowed:!0,suppressEmptyKeys:!0,allowZeroCpmBids:!0}},us={standard:{adserverTargeting:[{key:"hb_bidder",val:function(r){return r.bidderCode}},{key:"hb_adid",val:function(r){return r.adId}},{key:"hb_pb",val:function(r){return r.pbCg}},{key:"hb_size",val:function(r){return r.size}},{key:"hb_source",val:function(r){return r.source}},{key:"hb_format",val:function(r){return r.mediaType}},{key:"hb_deal",val:function(r){return r.dealId}}]}},gs={bidfloor:Jt,bidfloorcur:"USD"};class hs{constructor(i){a(this,"prebidReady",!1);a(this,"pbjs");this.prebidConfig=i,window.pbjs=window.pbjs??{},window.pbjs.que=window.pbjs.que??[],this.pbjs=window.pbjs,this.pbjs.que.push(()=>{this.pbjs.bidderSettings=Xe(this.pbjs.bidderSettings,cs),this.pbjs.setConfig({...this.prebidConfig}),this.prebidReady=!0})}isPrebidReady(){return this.prebidReady}requestBids(i){this.pbjs.que.push(()=>{this.pbjs.requestBids(i)})}setTargetingForGPTAsync(i,e){this.pbjs.que.push(()=>{var t,n;(n=(t=this.pbjs).setTargetingForGPTAsync)==null||n.call(t,i,e)})}pushToQueue(i){this.pbjs.que.push(()=>i(this.pbjs))}setConfig(i){this.pbjs.que.push(()=>{try{this.pbjs.setConfig(i)}catch(e){m({code:_r,message:`Failed to set Prebid config: ${e}`,priority:c.P2})}})}reset(){this.pbjs.que.push(()=>{this.pbjs.clearAllAuctions()})}}class I{constructor(...i){a(this,"configFlags");this.configFlags=i}isEnabled(i){return this.configFlags.length===0?!0:this.configFlags.every(e=>!!i[e])}transformAdUnitBidConfigs(i){return i}}class ps extends I{transformAdUnitBidConfigs(i,e){for(const t of i)t.params.keywords={...e.pageTargeting};return i}}class fs extends I{transformAdUnitBidConfigs(i,e){for(const t of i)t.params.customData=[{settings:{},targeting:{...e.pageTargeting}}];return i}}const ms={appnexus:new ps("icPrebidAppNexus"),gumgum:new I("icPrebidGumGum"),ix:new I("icPrebidIX"),kargo:new I("icPrebidKargo"),mgnipbs:new I("icPrebidMagniteS2s"),medianet:new I("icPrebidMedianet"),nobid:new I("icPrebidNobid"),openx:new I("icPrebidOpenX"),ozone:new fs("icPrebidOzone"),pubmatic:new I("icPrebidPubmatic"),rubicon:new I("icPrebidRubicon"),seedtag:new I("icPrebidSeedtag"),triplelift:new I("icPrebidTriplelift"),ttd:new I("icPrebidTtd"),wikia:new I};function mt(){return H("pbjs_debug")}const bs=r=>{if(r.icPrebidSharedId)return{name:"pubCommonId",storage:{type:"cookie",name:"_pubcid",expires:365}}},Ss=r=>{if(!r.icPrebidId5)return;const i={name:"id5Id",params:{partner:1139},storage:{type:"html5",name:"id5id",expires:90,refreshInSeconds:8*3600}};return r.icPrebidId5ExternalModule&&Object.assign(i.params,{externalModuleUrl:"https://cdn.id5-sync.com/api/1.0/id5PrebidModule.js"}),i},_s=r=>r.icLiveIntentConnectedId?{name:"liveIntentId",params:{publisherId:"79968",requestedAttributesOverrides:{uid2:!0,bidswitch:!0,medianet:!0,magnite:!0,pubmatic:!0,index:!0,openx:!0,thetradedesk:!0,sovrn:!0},ajaxTimeout:1e3,liCollectConfig:{fpiStorageStrategy:"ls",fpiExpirationDays:730}},storage:{name:"__tamLIResolveResult",type:"html5",expires:1}}:void 0,Es={ignoreOptOut:!1,ignoreAllowedAds:!1,ignoreCoppa:!1},w=(r,i={})=>{var o;const{ignoreAllowedAds:e,ignoreCoppa:t,ignoreOptOut:n}={...Es,...i},s=(d,l)=>l?!0:!d;return!!(r&&r.ready&&s(r.optOut,n)&&s(!((o=r.allowed)!=null&&o.ads),e)&&s(r.coppa,t))},As="https://b-code.liadm.com/a-07ev.min.js",Ts="0.3",ys={unifiedId:"liveConnect-unifiedId",sha2:"liveConnect",md5:"liveConnect-md5",sha1:"liveConnect-sha1"},bt="LiveConnectConsentInitialized",Oe="LiveConnectPluginReady",Be=r=>ys[r];class $ extends g{constructor(e,t){super(e);a(this,"name","LiveConnectPlugin");a(this,"storage",null);a(this,"libraryLoaded",!1);a(this,"consent");a(this,"hooks",{onConsentUpdated:e=>{w(e)?(this.consent=!0,this.setupStorage()):this.consent=!1,window.dispatchEvent(new Event(bt))},onAdEngineReset:()=>{!this.libraryLoaded||!this.consent||this.resolveAndTrackIds()}});a(this,"api",{waitForHems:async()=>(this.consent===void 0&&await this.waitFor(bt),this.consent?(this.libraryLoaded||await this.waitFor(Oe),{sha2:this.getFromStorage("sha2"),sha1:this.getFromStorage("sha1"),md5:this.getFromStorage("md5")}):null),checkIfSha2HemAvailable:()=>$.isEnabled(this.pluginConfig,this.instantConfig)?this.isAvailableInStorage("sha2"):!1});this.instantConfig=t}getDebugState(){return{isScriptLoaded:this.libraryLoaded,isStorageInitialized:!!this.storage,isSha2HemAvailable:this.api.checkIfSha2HemAvailable()}}static isEnabled(e,t){return e.enabled!==!1&&t.icLiveConnect&&t.icLiveConnectCachingStrategy&&!t.icIdentityPartners&&super.isEnabled(e,t)}setupStorage(){!this.consent||this.storage||(this.storage=new zt(this.instantConfig.icLiveConnectCachingStrategy.type==="local"?()=>window.localStorage:()=>window.sessionStorage),this.shouldLoadScript()?(p(A,{type:_.VENDOR_TIME_UPDATE,eventName:"live_connect_started",time:performance.now()}),q({src:As,isAsyncOrDeferOtherwise:!0,node:"first"}).then(()=>{this.resolveAndTrackIds(),p(A,{type:_.VENDOR_TIME_UPDATE,eventName:"live_connect_loaded",time:performance.now()})})):(p(A,{type:_.VENDOR_TIME_UPDATE,eventName:"live_connect_cached",time:performance.now()}),this.libraryLoaded=!0,window.dispatchEvent(new Event(Oe))))}getHEMTypes(){return this.instantConfig.icLiveConnectCachingStrategy.mandatoryParams}shouldLoadScript(){return this.getHEMTypes().some(t=>!this.isAvailableInStorage(t))}resolveAndTrackIds(){var e,t,n;(n=window.liQ)==null||n.resolve(s=>{for(const[o,d]of Object.entries(s))o==="unifiedId"&&p(A,{type:_.VENDOR_TIME_UPDATE,eventName:"live_connect_responded_uuid",time:performance.now()}),this.storeId(o,d);this.libraryLoaded=!0,window.dispatchEvent(new Event(Oe))},s=>{h({code:Ui,message:"Failed to resolve and track ids",priority:c.P4,error:s})},{qf:((t=(e=this.instantConfig)==null?void 0:e.icLiveConnectQf)==null?void 0:t.toString())??Ts,resolve:["sha2","md5","sha1","unifiedId"]})}storeId(e,t){var s;if(this.isAvailableInStorage(e))return;const n=Be(e);(s=this.storage)==null||s.setItem(n,t,this.instantConfig.icLiveConnectCachingStrategy.ttl),p(Qe.IDENTITY_INFO,{partnerName:n,partnerIdentityId:t})}isAvailableInStorage(e){var t;return!!((t=this.storage)!=null&&t.getItem(Be(e)))}getFromStorage(e){var t;return((t=this.storage)==null?void 0:t.getItem(Be(e)))??null}async waitFor(e){return new Promise(t=>{const n=()=>t();window.addEventListener(e,()=>{window.removeEventListener(e,n),t()})})}}function vs(r){const i=r.match(/.{2}/g);if(!i)throw new Error("Invalid input string");return btoa(String.fromCharCode(...i.map(e=>parseInt(e,16))))}const Is="VCaqxS6v2X",Rs="UID2-X-P-MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEOE+DsIa2aJWHIYpG+JrLpe0uxwrGe9aC4NaP7lQMN9+9/pk/7vydOrzQvxeDSlThIiMwGRMpyjAa593RYoGtFA==",Cs=async(r,i)=>{if(r.icPrebidUID2)try{const e=i.usePlugin($);if(!e)return;const t=await e.waitForHems();if(t!=null&&t.sha2)return{name:"uid2",params:{serverPublicKey:Rs,subscriptionId:Is,emailHash:vs(t.sha2)}}}catch{return}},Ns=r=>{var i,e;if(r.icPrebidYahooConnectId)return{name:"connectId",params:{pixelId:"58833",puid:((e=(i=window.fandomContext)==null?void 0:i.tracking)==null?void 0:e.ppid)??"0"},storage:{type:"html5",name:"connectId",expires:15}}},ei="identityLink",Ps=r=>{if(r.icPrebidLiveRampATS)return{name:ei,params:{pid:"2161",notUse3P:!1},storage:{type:"cookie",name:"idl_env",expires:15,refreshInSeconds:1800}}},ks="924dbye",ws=r=>{if(r.icPrebidUnifiedId)return{name:"unifiedId",params:{partner:ks},storage:{type:"cookie",name:"pbjs_unifiedid",expires:30}}},Ls=[ws,bs,Ss,_s,Ns,Ps],Ds=(r,i)=>{var t;const e=Ls.map(n=>n(i)).filter(n=>n!==void 0);return r.userSync??(r.userSync={}),(t=r.userSync).userIds??(t.userIds=[]),r.userSync.userIds.push(...e),r},Fs=[Cs],Os=(r,i,e)=>{Fs.forEach(t=>{t(r,i).then(n=>{if(!n)return;const s=e.getConfig("userSync");s.userIds??(s.userIds=[]),s.userIds.push(n),e.mergeConfig({userSync:s}),e.refreshUserIds({submoduleNames:[n.name]})})})},Bs=r=>{if(r.icPrebidLiveRampATSAnalytics)return{provider:"atsAnalytics",options:{pid:"2161"}}},Ms=[Bs],xs=(r,i)=>{const e=Ms.map(t=>t(r)).filter(t=>t!==void 0);e.length&&i.enableAnalytics(e)};function Us(r){return r.banner!==void 0}function Vs(r){return r.video!==void 0}function Ws(){var r,i;return(i=(r=window.fandomContext)==null?void 0:r.odyssey)==null?void 0:i.responsiveDeviceType}class y extends g{constructor(e,t){super(e);a(this,"name","PrebidPlugin");a(this,"adEngine");a(this,"prebidWrapper");a(this,"activeBidders",new Map);a(this,"hooks",{onBiddersInit:(e,t)=>{e.adRenderManager.isBiddingEnabled()&&(this.adEngine=e,t.push(this.waitForPrebidReady()))},onCreateBiddersRequests:(e,t,n,s)=>{n.adRenderManager.isBiddingEnabled()&&e.push(this.requestBids(t,s))},onInitPageTargeting:()=>{this.prebidWrapper.pushToQueue(e=>Os(this.instantConfig,this,e)),this.prebidWrapper.pushToQueue(e=>xs(this.instantConfig,e))},onAdEngineReset:()=>{this.prebidWrapper.reset()}});a(this,"api",{addPrebidReadyCallback:e=>{this.prebidWrapper.pushToQueue(e)},setConfig:e=>{this.prebidWrapper.setConfig(e)}});this.instantConfig=t,this.prebidWrapper=this.initPrebidWrapper(),this.initBidderAdapters()}getDebugState(){return{activeBidders:Array.from(this.activeBidders.keys()),isWrapperInitialized:!!this.prebidWrapper,isDebugEnabled:mt()}}async waitForPrebidReady(){const e=new Promise(t=>{this.api.addPrebidReadyCallback(()=>t())});await j(e,this.instantConfig.icPrebidInitTimeoutMS,"PrebidPlugin.waitForPrebidReady")}initPrebidWrapper(){const e=Ds({...ls,bidderTimeout:this.instantConfig.icAdEngineAuctionTimeoutMS,debug:mt()},this.instantConfig);return new hs(e)}initBidderAdapters(){for(const[e,t]of Object.entries(ms))t.isEnabled(this.instantConfig)&&this.activeBidders.set(e,t)}generateAdUnitBids(e,t){const n=[];for(const[s,o]of Object.entries(e.bids)){const d=this.applyMonetizationTiersToBids(o);if(this.activeBidders.has(s)){const l=this.activeBidders.get(s),u=(l==null?void 0:l.transformAdUnitBidConfigs(d,t,this.instantConfig))??[];n.push(...u)}}return n}applyMonetizationTiersToBids(e){var s;const t=(s=this.adEngine)==null?void 0:s.monetizationTierEngine;if(!t)return h({code:Yi,message:"PrebidPlugin.applyMonetizationTiersToBids: MonetizationTierEngine is not available.",priority:c.P2}),e;const n=[];for(const o of e){if(!o.params)continue;const d=t.filterTieredParamsByCurrentTier(o.params);typeof d>"u"||n.push({...o,params:d})}return n}generateAdUnits(e){const t=[];for(const n of e.adNodes){const s=n.getBidderConfig("prebid");if(!s)continue;let o=[];s.bids&&(o=this.generateAdUnitBids(s,e));const d={...s,code:n.getSlotName(),bids:o,ortb2Imp:{...gs,...s.ortb2Imp??{}}};d.mediaTypes=this.transformAdUnitMediaTypes(n,d.mediaTypes??{}),t.push(d)}return t}transformAdUnitMediaTypes(e,t){const n=e.getBidderSizes();if(Us(t))sn(n)&&(t.banner={sizeConfig:this.transformBannerSizeConfig(n),...t.banner});else if(Vs(t)){const s=this.transformVideoSizeConfig(n,e.getSlotName());t.video={playerSize:s,w:s?s[0]:void 0,h:s?s[1]:void 0,...t.video}}return t}transformBannerSizeConfig(e){return e.map(([t,n])=>({minViewPort:t,sizes:n}))}transformVideoSizeConfig(e,t){var s,o;const n=(o=(s=e[0])==null?void 0:s[1])==null?void 0:o[0];if(Array.isArray(n)&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number")return n;m({code:Ar,message:`PrebidPlugin.transformVideoSizeConfig: Invalid video size configuration for ad node ${t}. Using default size.`,priority:c.P3})}async requestBids(e,t){return S(this.prebidWrapper.isPrebidReady(),"PrebidPlugin.requestBids: Prebid.js is not ready"),new Promise(n=>{var u;const s=this.generateAdUnits(e);t("prebid",e,s);const o=((u=this.usePlugin(et))==null?void 0:u.getOrtb2(e.pageTargeting))??{},d={auctionId:e.auctionId,adUnits:s,ortb2:o,bidsBackHandler:()=>{this.prebidWrapper.setTargetingForGPTAsync(),n()}},l=Ws();l&&(d.labels=[l]),this.prebidWrapper.requestBids(d)})}}class et extends g{constructor(){super(...arguments);a(this,"name","OpenRtbPlugin");a(this,"pageTargeting",{});a(this,"adEngine");a(this,"dsaSettings",{dsa:{dsarequired:1,pubrender:2,datatopub:2}});a(this,"orbt2SiteCategories",[]);a(this,"ortb2PageCategories",[]);a(this,"hooks",{onBiddersInit:e=>{this.adEngine=e;const t=this.usePlugin(y);t==null||t.addPrebidReadyCallback(n=>{this.pageTargeting={...e.gptWrapper.getAllTargeting()},this.extendPrebidConfig(n)})}});a(this,"api",{getOrtb2:(e={})=>{var n;const t=((n=this.adEngine)==null?void 0:n.gptWrapper.getAllTargeting())??{};return this.pageTargeting={...t,...e},this.getOrtb2()}})}getDebugState(){return{pageTargeting:{...this.pageTargeting},orbt2SiteCategories:[...this.orbt2SiteCategories],ortb2PageCategories:[...this.ortb2PageCategories]}}getKeywordsSet(e){return new Set([...e.gnre??[],...e.media??[],...e.theme??[],...e.tv??[]])}buildKeywords(){var t;const e=(t=window==null?void 0:window.fandomContext)==null?void 0:t.site;return e!=null&&e.tags?Array.from(this.getKeywordsSet(e.tags).values()).filter(Boolean).join(","):""}setOrtb2Categories(){const e=this.usePlugin(Zt);this.orbt2SiteCategories=(e==null?void 0:e.getIABSiteCategories())??[],this.ortb2PageCategories=(e==null?void 0:e.getIABPageCategories())??[]}getOrtb2(){this.setOrtb2Categories();const{pageName:e,pageId:t,lang:n,...s}=this.pageTargeting;return{site:{...s,cattax:Qt,cat:[...this.orbt2SiteCategories],pagecat:[...this.ortb2PageCategories],id:t==null?void 0:t.toString(),name:e,content:{language:n,context:5},keywords:this.buildKeywords(),domain:window.location.hostname},regs:{ext:{...this.dsaSettings}}}}extendPrebidConfig(e){e.mergeConfig({ortb2:this.getOrtb2()})}}function ti(r,i,e){var n;const t=(n=r.getResponseInformation)==null?void 0:n.call(r);if(t)return{advertiserId:t.advertiserId,creativeId:t.creativeId,lineItemId:t.lineItemId,orderId:t.campaignId,selectedSize:e,configuredSizes:Le(i.getSizes())}}function Me(r,i,e,t){const n=i.getSlotElementId(),s=e.getAdNodeByName(n);if(!s)return;const o={type:r,slotName:n,slotInfo:ti(i,s,t),rv:s.getRenderCount()};p(Ae,o)}function St(r,i){p(A,{type:r,time:performance.now(),slotName:i})}const zs=/[?&]prev_iu_szs=([^&#]*)/;function Gs(r){if(!r)return"";const i=r.match(zs);return i?decodeURIComponent(i[1]):""}function Hs(r){var t;if(!r)return[];const i=((t=r.getContentUrl)==null?void 0:t.call(r))??"",e=Gs(i);return e?e.split("|").filter(Boolean):[]}function qs(r,i,e,t){const n=i.getSlotElementId(),s=e.getAdNodeByName(n);if(!s)return;const o={type:r,slotName:n,slotInfo:{...js(i),selectedSize:$s(t),configuredSizes:Le(s.getSizes()),parsedSizes:Hs(i)}};p(Li,o)}function $s(r){if(r!==void 0)return r===null?null:ve(r)}function js(r){var e;const i=(e=r.getResponseInformation)==null?void 0:e.call(r);return i?{advertiserId:i.advertiserId,creativeId:i.creativeId,lineItemId:i.lineItemId,orderId:i.campaignId}:{advertiserId:void 0,creativeId:void 0,lineItemId:void 0,orderId:void 0}}class ii extends g{constructor(e,t){super(e);a(this,"name","HeavyAdsDetectionPlugin");a(this,"detectedHeavyAds",[]);a(this,"onHeavyAdDetectedCallbacks",[]);a(this,"api",{getDetectedHeavyAds:()=>this.detectedHeavyAds.slice(),onHeavyAdDetected:e=>{this.onHeavyAdDetectedCallbacks.push(e)}});t.icInterventionTracking&&this.initializeHeavyAdDetection()}getDebugState(){return{detectedHeavyAds:this.detectedHeavyAds.slice()}}initializeHeavyAdDetection(){if(typeof ReportingObserver>"u"){m({code:Cr,message:"ReportingObserver not supported, heavy ads detection unavailable",priority:c.P4});return}window.addEventListener("message",this.handleMessageEvent.bind(this),{capture:!0,passive:!0})}handleMessageEvent(e){if(e.origin!==window.origin)return;const t=e.data;if(t&&t.libId==="@wikia/post-quecast"&&t.action&&t.action.id==="HeavyAdIntervention"){const n={slotName:t.action.slotName,reason:this.parseReasonFromMessage(t.action.message),timestamp:t.action.timestamp};this.detectedHeavyAds.push(n),this.onHeavyAdDetectedCallbacks.forEach(s=>s(n)),m({code:Nr,message:`HeavyAdsDetectionPlugin detected heavy ad for slot ${n.slotName} (${n.reason})`,priority:c.P3})}}parseReasonFromMessage(e){return e.includes("CPU usage")?"cpu":e.includes("network")?"network":"unknown"}}class Ks{constructor(i,e){a(this,"listener",this.detectClickOnIframe.bind(this));this.slotName=i,this.callbackOnDetection=e}init(){window.addEventListener("blur",this.listener)}detectClickOnIframe(){const i=document.activeElement;(i==null?void 0:i.closest(`div#${CSS.escape(this.slotName)}`))!==null&&(this.callbackOnDetection(),this.clearDetection())}clearDetection(){setTimeout(()=>{document.activeElement.blur()},100)}detach(){window.removeEventListener("blur",this.listener)}}function ri(r,i,e,t){return{slotName:r.adUnitCode,baseSlotName:(e==null?void 0:e.getBaseSlotName())??r.adUnitCode,rv:(e==null?void 0:e.getRenderCount())??void 0,bidInfo:{status:i,bidderName:r.bidderCode,size:`${r.width}x${r.height}`,price:`${r.cpm}`,timeToRespond:r.timeToRespond,auctionId:r.auctionId,rejectionReason:r.rejectionReason,fullAuction:t}}}function tt(r,i,e,t){return{slotName:r.adUnitCode,baseSlotName:(e==null?void 0:e.getBaseSlotName())??r.adUnitCode,rv:(e==null?void 0:e.getRenderCount())??void 0,bidInfo:{status:i,bidderName:r.bidder,auctionId:r.auctionId,size:void 0,price:void 0,timeToRespond:void 0,rejectionReason:void 0,fullAuction:t}}}function Ys(r,i,e,t){if(!t)return;const n=ri(r,"on_time",i,e);p(U.BIDDER_RESPONSE,n)}function Qs(r,i,e,t){if(!t)return;const n=ri(r,"rejected",i,e);p(U.BIDDER_RESPONSE,n)}function Xs(r,i,e,t){if(!t)return;const n=tt(r,"unknown",i,e);p(U.BIDDER_RESPONSE,n)}function Zs(r,i,e,t){if(!t)return;const n=tt(r,"timedout",i,e);p(U.BIDDER_RESPONSE,n)}function Js(r,i,e,t){if(!t)return;const n=tt(r,"declined",i,e);p(U.BIDDER_RESPONSE,n)}function se(r,i){if(!i)return;const e={slotName:"error",baseSlotName:"error",rv:void 0,bidInfo:{status:"error",bidderName:"error",auctionId:void 0,size:void 0,price:void 0,timeToRespond:void 0,rejectionReason:void 0,fullAuction:r}};p(U.BIDDER_RESPONSE,e)}const ea={auctionEndWait:100,percentFullAuctions:.01,percentSampleTarget:.1};class ta{constructor(i,e,t=ea){a(this,"fullAuction");a(this,"sampleRate");a(this,"pendingAuctions",{});this.pbjs=i,this.adNodeManager=e,this.config=t,this.validateSampling(t.percentFullAuctions,t.percentSampleTarget),this.fullAuction=Math.random()<t.percentFullAuctions,H("force_tracking")&&(this.fullAuction=!0),this.fullAuction?this.sampleRate=1:this.sampleRate=(t.percentSampleTarget-t.percentFullAuctions)/(1-t.percentFullAuctions),this.monitorAuctionInit(),this.monitorTimedOutRequests(),this.monitorAuctionEnd()}validateSampling(i,e){if(i>e)throw Error("percentFullAuctions must be less than the percentSampleTarget");if(e>1||e<0)throw Error("percentSampleTarget must be between 0 and 1");if(i>1||i<0)throw Error("percentFullAuctions must be between 0 and 1")}bidIsSampled(){return Math.random()<this.sampleRate}monitorAuctionInit(){this.pbjs.onEvent("auctionInit",i=>{const e={bidState:{}};i.bidderRequests.forEach(t=>{try{t.bids.forEach(n=>{e.bidState[K(n)]="requested"})}catch{h({code:Qi,message:`Error tracking initial auctionInit state for bidRequest: ${JSON.stringify(t)}`,priority:c.P4})}}),this.pendingAuctions[i.auctionId]=e})}monitorAuctionEnd(){this.pbjs.onEvent("auctionEnd",i=>{this.recordBidsReceived(i),this.recordBidsRejected(i),setTimeout(()=>{this.recordNoBids(i),this.recordUnknownBids(i),delete this.pendingAuctions[i.auctionId]},this.config.auctionEndWait)})}monitorTimedOutRequests(){this.pbjs.onEvent("bidTimeout",i=>{i.forEach(e=>{try{const t=this.pendingAuctions[e.auctionId],n=this.adNodeManager.getAdNodeByName(e.adUnitCode);t.bidState[K(e)]="timedout",Zs(e,n,this.fullAuction,this.bidIsSampled())}catch{h({code:Xi,message:"Error recording bidTimeout",priority:c.P4,data:e}),se(this.fullAuction,this.bidIsSampled())}})})}recordBidsReceived(i){const e=this.pendingAuctions[i.auctionId];i.bidsReceived.forEach(t=>{try{const n=this.adNodeManager.getAdNodeByName(t.adUnitCode);e.bidState[K(t)]="on_time",Ys(t,n,this.fullAuction,this.bidIsSampled())}catch(n){h({code:Zi,message:"Error recording bidReceived",priority:c.P4,error:n,data:t}),se(this.fullAuction,this.bidIsSampled())}})}recordBidsRejected(i){const e=this.pendingAuctions[i.auctionId];i.bidsRejected.forEach(t=>{try{e.bidState[K(t)]="rejected";const n=this.adNodeManager.getAdNodeByName(t.adUnitCode);Qs(t,n,this.fullAuction,this.bidIsSampled())}catch{h({code:Ji,message:"Error recording bidRejected",priority:c.P4,data:t}),se(this.fullAuction,this.bidIsSampled())}})}recordNoBids(i){const e=this.pendingAuctions[i.auctionId];i.noBids.forEach(t=>{try{const n=K(t);if(e.bidState[n]!="timedout"){e.bidState[n]="declined";const s=this.adNodeManager.getAdNodeByName(t.adUnitCode);Js(t,s,this.fullAuction,this.bidIsSampled())}}catch{h({code:er,message:"Error recording no_bid",priority:c.P4,data:t}),se(this.fullAuction,this.bidIsSampled())}})}recordUnknownBids(i){try{const e=i.bidderRequests.flatMap(n=>n.bids),t=this.pendingAuctions[i.auctionId];for(const[n,s]of Object.entries(t.bidState))if(s==="requested"){const o=e.find(d=>K(d)===n);if(o){const d=this.adNodeManager.getAdNodeByName(o.adUnitCode);Xs(o,d,this.fullAuction,this.bidIsSampled())}else h({code:tr,message:"Could not find bid data to report",priority:c.P4}),se(this.fullAuction,this.bidIsSampled())}}catch{h({code:ir,message:"Error recording unknown bids",priority:c.P4})}}}function K(r){return`${r.bidder}-${r.transactionId}`}function ia(r){return"timedOut"in r&&r.timedOut}class ra{constructor(){a(this,"A9_BIDDER_NAME","a9")}trackBidResponse(i,e,t,n){e.forEach(s=>{if(ia(s)){const d=this.buildTimedOutBidInfo(i,n,t);this.sendBidInfo(d,s,i);return}if(s.size=="0x0"){const d=this.buildDeclinedBidInfo(i,n,t);this.sendBidInfo(d,s,i);return}const o=this.buildOnTimeBidInfo(i,n,s,t);this.sendBidInfo(o,s,i)})}buildTimedOutBidInfo(i,e,t){return{status:"timedout",bidderName:this.A9_BIDDER_NAME,size:void 0,price:void 0,timeToRespond:Math.round(t),timedOut:!0,auctionId:i.auctionId,fullAuction:e}}buildDeclinedBidInfo(i,e,t){return{status:"declined",bidderName:this.A9_BIDDER_NAME,size:void 0,price:void 0,timeToRespond:Math.round(t),timedOut:!1,auctionId:i.auctionId,fullAuction:e}}buildOnTimeBidInfo(i,e,t,n){return{status:"on_time",bidderName:this.A9_BIDDER_NAME,size:t.size,price:t.targeting.amznbid,timeToRespond:Math.round(n),timedOut:!1,auctionId:i.auctionId,fullAuction:e}}sendBidInfo(i,e,t){const n=e.slotID;let s=0,o=n;const d=t.adNodes.find(u=>u.getSlotName()===n);d&&(s=d.getRenderCount(),o=d.getBaseSlotName());const l={slotName:n,baseSlotName:o,rv:s,bidInfo:i};p(U.BIDDER_RESPONSE,l)}}class ni extends g{constructor(){super(...arguments);a(this,"name","TrackingPlugin");a(this,"auctionTracker");a(this,"a9AuctionTracker");a(this,"SLOTS_ELIGIBLE_TO_LOADING_TIME_TRACK",["top_leaderboard","top_boxad","floor_adhesion","interstitial"]);a(this,"clickTrackingSlotMap",new Map);a(this,"slotsAlreadyTrackedForLoadTime",{requested:new Map,rendered:new Map});a(this,"hooks",{onInitPageTargeting:()=>{p(A,{type:_.AE_INIT,time:performance.now()})},onAdEngineInit:e=>{document.addEventListener("visibilitychange",this.onPageVisibilityChange.bind(this,e)),this.onPageVisibilityChange(e)},onBiddersInit:e=>{var t;(t=this.usePlugin(y))==null||t.addPrebidReadyCallback(n=>{this.auctionTracker=new ta(n,e.adNodeManager),this.a9AuctionTracker=new ra})},onBeforeFirstCallAdsRequest:(e,t)=>{var n;return this.onGptSlotRequested(e,t),this.onGptSlotRendered(e,t),this.onGptResponseReceived(e,t),(n=this.usePlugin(ii))==null||n.onHeavyAdDetected(s=>{this.onHeavyAdDetected(e,t,s)}),e},onFirstRenderCycleComplete(){Se().cmd.push(e=>e.issueManager.triggerPageStatus({trigger:"first_render_cycle"}))},onBeforeAdsRequest:()=>{if(H("temp_force_error"))throw Error("Fake Error onBeforeAdsRequest")},onAdEngineReset:()=>{this.slotsAlreadyTrackedForLoadTime.requested.clear(),this.slotsAlreadyTrackedForLoadTime.rendered.clear();for(const e of this.clickTrackingSlotMap.values())e.detach();this.clickTrackingSlotMap.clear()}});a(this,"api",{trackA9BidResponse:(e,t,n)=>{var o;const s=t.filter(()=>this.auctionTracker.bidIsSampled());(o=this.a9AuctionTracker)==null||o.trackBidResponse(e,s,n,this.auctionTracker.fullAuction)}})}getDebugState(){return{isAuctionTrackerInitialized:!!this.auctionTracker,isA9AuctionTrackerInitialized:!!this.a9AuctionTracker,clickTrackingSlotNames:Array.from(this.clickTrackingSlotMap.keys()),slotsTrackedForLoadTimeRequested:Array.from(this.slotsAlreadyTrackedForLoadTime.requested.keys()),slotsTrackedForLoadTimeRendered:Array.from(this.slotsAlreadyTrackedForLoadTime.rendered.keys())}}isSlotEligibleToLoadingTimeTrack(e){return this.SLOTS_ELIGIBLE_TO_LOADING_TIME_TRACK.includes(e)}onGptSlotRequested(e,t){e.addEventListener("slotRequested",n=>{const s=n.slot,o=s.getSlotElementId();Me(W.SLOT_REQUESTED_INFO,s,t),this.isSlotEligibleToLoadingTimeTrack(o)&&(this.slotsAlreadyTrackedForLoadTime.requested.has(o)||(St(_.SLOT_REQUESTED,o),this.slotsAlreadyTrackedForLoadTime.requested.set(o,!0)))})}onGptSlotRendered(e,t){e.addEventListener("slotRenderEnded",n=>{if(n.isEmpty)return;const s=n.slot,o=s.getSlotElementId(),d=t.getAdNodeByName(o);d&&(Me(W.SLOT_RENDERED_INFO,s,t,ve(n.size??"")),qs(Bt.SLOT_SIZE_ESTABLISHED,s,t,n.size),this.attachClickTracking(o,d),this.isSlotEligibleToLoadingTimeTrack(o)&&(this.slotsAlreadyTrackedForLoadTime.rendered.has(o)||(St(_.SLOT_RENDERED,o),this.slotsAlreadyTrackedForLoadTime.rendered.set(o,!0))))})}onGptResponseReceived(e,t){e.addEventListener("slotResponseReceived",n=>{const s=n.slot;Me(W.SLOT_CODE_SERVED_INFO,s,t)})}onPageVisibilityChange(e){e.gptWrapper.setTargeting("is_bg",document.hidden?x:ge)}attachClickTracking(e,t){if(this.clickTrackingSlotMap.has(e))return;const n=()=>{const o=t.getRenderCount(),d={type:W.SLOT_CLICKED,slotName:e,rv:o};p(Ae,d)},s=new Ks(e,n);s.init(),this.clickTrackingSlotMap.set(e,s)}onHeavyAdDetected(e,t,n){const s=n.slotName,o=t.getAdNodeByName(s);if(!o){m({code:Ir,message:`HeavyAdsDetectionPlugin detected heavy ad for unknown slot ${s}`,priority:c.P2});return}const d=e.getSlotById(s);if(!d){m({code:Rr,message:`HeavyAdsDetectionPlugin detected heavy ad for slot ${s}, but GPT has no record of that slot`,priority:c.P2});return}p(Ae,{type:W.SLOT_HEAVY_AD_INTERVENTION,slotName:s,rv:o.getRenderCount(),reason:n.reason,slotInfo:ti(d,o)})}}const na="b8f84ec5-52e5-45d5-a863-6181aea3a67b",sa="3115";class aa extends g{constructor(e,t){super(e);a(this,"name","A9Plugin");a(this,"wrapper");a(this,"errorOnInit");a(this,"consentData");a(this,"adEngine");a(this,"hooks",{onConsentUpdated:e=>{this.consentData=e,this.wrapper?this.wrapper.handleConsentChange(e):this.initWrapper()},onAdEngineInit:e=>{e.adRenderManager.isBiddingEnabled()&&(this.adEngine=e,this.initWrapper())},onCreateBiddersRequests:(e,t,n,s)=>{n.adRenderManager.isBiddingEnabled()&&e.push(j(this.executeBidRequest(t,s),this.instantConfig.icAdEngineAuctionTimeoutMS,`A9 bid request timed out for auction ${t.auctionId}`).catch(o=>{if(o.message.includes("request timed out")){m({code:Sr,message:o.message,priority:c.P3,error:o,data:t});return}throw o}))}});this.instantConfig=t}static isEnabled(e,t){return!!t.icA9Bidder&&super.isEnabled(e,t)}getDebugState(){return{isWrapperInitialized:!!this.wrapper,initErrorMessage:this.errorOnInit??null,resolvedPubId:this.adEngine?this.resolvePubID(this.adEngine):null}}trackBidResponse(e,t,n){var s;try{(s=this.usePlugin(ni))==null||s.trackA9BidResponse(e,t,n)}catch(o){h({code:Hi,message:"Error tracking A9 bids",priority:c.P3,error:o})}}resolvePubID(e){const{monetizationTierEngine:t}=e;return t.isPartiallyMonetized()?na:t.isFullyMonetized()?sa:null}async executeBidRequest(e,t){S(this.wrapper,"A9Wrapper has not been initialized");const n=`${R.AE_AUCTION_START_A9_START}_${e.auctionId}`;performance.mark(n),this.wrapper.updateApstagOrtb2Signals(this.getOrtb2Object());const s=await this.wrapper.requestBids(e,t),{duration:o}=performance.measure(xt.AE_AUCTION_DURATION_A9_BID_TOTAL_TIME,n);this.trackBidResponse(e,s,o)}initWrapper(){if(!this.consentData||!this.adEngine||!this.isConsentGranted(this.consentData)||this.wrapper||this.errorOnInit||this.isKidWiki())return;const e=this.resolvePubID(this.adEngine);if(!e){const t="A9Wrapper initialization failed: pubID could not be resolved";h({code:qi,message:t,priority:c.P2}),this.errorOnInit=t;return}this.wrapper??(this.wrapper=new Hn(this.consentData,this.instantConfig.icAdEngineAuctionTimeoutMS,this.instantConfig,e,this.getOrtb2Object())),this.errorOnInit=void 0}getOrtb2Object(e){var t;return(t=this.usePlugin(et))==null?void 0:t.getOrtb2(e)}isConsentGranted(e){return w(e,{ignoreOptOut:!0})}isKidWiki(){var t;const[e]=((t=this.adEngine)==null?void 0:t.gptWrapper.getTargeting("kid_wiki"))??[];return e===x}}class oa extends g{constructor(e,t){super(e);a(this,"name","ConsentManagementPrebidPlugin");a(this,"isTcfAvailable",!1);a(this,"isUspAvailable",!1);a(this,"hooks",{onConsentUpdated:({coppa:e,consentApi:t})=>{var n;this.isTcfAvailable=t==="tcf",this.isUspAvailable=t==="usp",(n=this.usePlugin(y))==null||n.addPrebidReadyCallback(s=>{s.mergeConfig({coppa:e})})},onBiddersInit:()=>{var e;(e=this.usePlugin(y))==null||e.addPrebidReadyCallback(t=>{this.isTcfAvailable&&t.mergeConfig({consentManagement:{gdpr:{cmpApi:"iab",timeout:this.instantConfig.icPrebidConsentManagementTimeoutMS,defaultGdprScope:!0}}}),this.isUspAvailable&&t.mergeConfig({consentManagement:{usp:{cmpApi:"iab",timeout:this.instantConfig.icPrebidConsentManagementTimeoutMS}}})})}});this.instantConfig=t}getDebugState(){return{isTcfAvailable:this.isTcfAvailable,isUspAvailable:this.isUspAvailable}}}class si{constructor(i){a(this,"iconSvg",'<svg width="9" height="9" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22C6.48605 22 2.00005 17.514 2.00005 12C2.00005 6.486 6.48605 2 12 2C17.514 2 22 6.486 22 12C22 17.514 17.514 22 12 22M12 0C5.383 0 0 5.383 0 12C0 18.617 5.383 24 12 24C18.617 24 24 18.617 24 12C24 5.383 18.617 0 12 0" clip-rule="evenodd"/><path d="M10.9998 18.0171V10.0096C10.9998 9.4556 11.4467 9.00777 11.9997 9.00777 12.5527 9.00777 12.9997 9.4556 12.9997 10.0096V18.0171C12.9997 18.5711 12.5527 19.0189 11.9997 19.0189 11.4467 19.0189 10.9998 18.5711 10.9998 18.0171zM12.0057 7.01379C11.4527 7.01379 10.9998 6.55995 10.9998 6.00693 10.9998 5.4539 11.4527 5.00006 12.0057 5.00006 12.5587 5.00006 13.0107 5.4539 13.0107 6.00693 13.0107 6.55995 12.5587 7.01379 12.0057 7.01379" clip-rule="evenodd"/></svg>');this.props=i}render(){const e=new DOMParser().parseFromString(this.iconSvg,"image/svg+xml").documentElement,t=()=>{document.querySelectorAll(".dsa-dialog").forEach(o=>{document.body.removeChild(o)})},n=async()=>{const{AdvertisementInfoDialog:s}=await k(async()=>{const{AdvertisementInfoDialog:d}=await import("./AdvertisementInfoDialog-ftkjtV7l.js");return{AdvertisementInfoDialog:d}},[]);t();const o=new s(this.props).render();document.body.appendChild(o),o.showModal()};return jsxRenderer("span",{className:"dsa-advertisement-label-icon",onClick:n},e)}}class _t{constructor(i){a(this,"translatedAdLabel",document.querySelector(".ae-translatable-label"));this.props=i}render(){const{behalf:i,paid:e}=this.props,t=new si({behalf:i,paid:e}).render();return jsxRenderer("div",{className:"ae-translatable-label advertisement-label",id:"label-"+this.props.slot},jsxRenderer("span",{className:"dsa-advertisement-label-clickable"},this.translatedAdLabel?this.translatedAdLabel.innerText:"Advertisement ",t))}}class da extends g{constructor(){super(...arguments);a(this,"name","DigitalServicesActPlugin");a(this,"adUnitsWithoutDynamicLabel",["interstitial","floor_adhesion"]);a(this,"defaultDSAPrebidSettings",{dsarequired:1,pubrender:2,datatopub:2});a(this,"hooks",{onBiddersInit:()=>{const e=this.usePlugin(y);S(e,"PrebidPlugin not found"),e.addPrebidReadyCallback(t=>{this.extendPrebidConfig(t),this.attachPrebidEventsHandlers(t)})}})}extendPrebidConfig(e){e.mergeConfig({ortb2:{regs:{ext:{dsa:{...this.defaultDSAPrebidSettings}}}}})}getBidMeta(e){return e.meta??{}}getDSAMeta(e){return this.getBidMeta(e).dsa??null}isDSADataAvailable(e){var t,n;return typeof((t=this.getDSAMeta(e))==null?void 0:t.behalf)=="string"&&typeof((n=this.getDSAMeta(e))==null?void 0:n.adrender)=="number"}handleRegularAdUnit(e){var o;const{behalf:t,paid:n}=this.getDSAMeta(e),s=new _t({slot:e.adUnitCode,behalf:t,paid:n}).render();(o=document.getElementById(e.adUnitCode))==null||o.appendChild(s)}handleTopLeaderboard(e){var d;const t=document.querySelector(".top-ads-container .ae-translatable-label"),{behalf:n,paid:s}=this.getDSAMeta(e),o=new si({behalf:n,paid:s}).render();t.classList.add("advertisement-label","dsa-advertisement-label-clickable"),(d=t.querySelector(".dsa-advertisement-label-icon"))==null||d.remove(),t.appendChild(o)}handleIncontentSlots(e,t){const n=this.getRealSlotName(t);if(!n)return;const s=document.getElementById(n);if(!s)return;const{behalf:o,paid:d}=this.getDSAMeta(e),l=new _t({slot:e.adUnitCode,behalf:o,paid:d}).render();s.appendChild(l)}attachPrebidEventsHandlers(e){const t=({bid:n,doc:s})=>{if(!(!this.isDSADataAvailable(n)||this.adUnitsWithoutDynamicLabel.includes(n.adUnitCode)))switch(n.adUnitCode){case"top_leaderboard":this.handleTopLeaderboard(n);break;case"incontent_leaderboard":case"incontent_boxad":this.handleIncontentSlots(n,s);break;default:this.handleRegularAdUnit(n)}};e.onEvent("adRenderSucceeded",t)}getRealSlotName(e){var t,n,s,o;return(o=(s=(n=(t=e==null?void 0:e.defaultView)==null?void 0:t.frameElement)==null?void 0:n.parentElement)==null?void 0:s.parentElement)==null?void 0:o.id}}const la=(r,...i)=>r.reduce((t,n,s)=>{const o=i[s]||"";return t+n+o},"").replace(/\s+/g," ").trim(),ai=document.createElement("style");document.head.appendChild(ai);const Et=ai.sheet,ca=r=>typeof(r==null?void 0:r.dynamic)=="object"&&!!r.dynamic.single,ua=r=>typeof(r==null?void 0:r.dynamic)=="object"&&!!r.dynamic.outOfPage;class ga extends g{constructor(){super(...arguments);a(this,"name","DynamicSlotPlugin");a(this,"requestedSlots",[]);a(this,"missingAnchors",[]);a(this,"hooks",{onAfterAdNodeManagerInit:(e,t)=>{for(const n of Object.values(t))try{ca(n)&&this.handleDynamicSingleSlot(n),ua(n)&&this.handleDynamicOutOfPageSlot(n)}catch(s){h({code:Wi,priority:c.P3,error:s,message:`Dynamic slot "${n.name}" failed to render`})}}})}getDebugState(){return{requestedSlots:[...this.requestedSlots],missingAnchors:this.missingAnchors.map(e=>({...e}))}}renderWrapper(e,t){const n=document.createElement("div");return n.id=e,n.classList.add(T.WRAPPER_CLASS),t&&Et&&Et.insertRule(la`
        #${e} {
          ${t}
        }
      `),n}handleDynamicSingleSlot(e){const t=e.dynamic.single,n=document.querySelector(t.selector);if(!n){h({code:Vi,message:`Dynamic slot anchor element with selector "${t.selector}" not found`,priority:c.P2}),this.missingAnchors.push({slotName:e.name,selector:t.selector});return}this.renderDynamicSlot(n,e.name,t),this.requestedSlots.push(e.name)}handleDynamicOutOfPageSlot(e){const t=document.createElement(T.ELEMENT_NAME);t.id=e.name,document.body.append(t)}renderDynamicSlot(e,t,n){var o;const s=document.createElement(T.ELEMENT_NAME);if(s.id=t,(o=n.wrapper)!=null&&o.id){const d=this.renderWrapper(n.wrapper.id,n.wrapper.css);d.appendChild(s),e[n.insertMethod](d);return}e[n.insertMethod](s)}}const ha='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.707 4.293a.999.999 0 0 0-1.414 0L12 10.586 5.707 4.293a.999.999 0 1 0-1.414 1.414L10.586 12l-6.293 6.293a.999.999 0 1 0 1.414 1.414L12 13.414l6.293 6.293a.997.997 0 0 0 1.414 0 .999.999 0 0 0 0-1.414L13.414 12l6.293-6.293a.999.999 0 0 0 0-1.414" fill-rule="evenodd"/></svg>';function pa(r){const i=new DOMParser,e=document.createElement("button"),t=["button-control","button-close","floor-adhesion-close-button"],n=i.parseFromString(ha,"image/svg+xml").documentElement;return e.appendChild(n),e.classList.add(...t),e.addEventListener("click",r),e}class Ge{constructor(i=0){a(this,"observers",new Map);a(this,"history",[]);this.historySize=i}subscribe(i){const e=Symbol();return this.observers.set(e,i),this.historySize>0&&this.history.forEach(t=>i(t)),()=>{this.observers.delete(e)}}notify(i){this.historySize>0&&(this.history.push(i),this.history.length>this.historySize&&this.history.shift()),this.observers.forEach(e=>e(i))}}function he(){var r;return((r=window.fandomHost)==null?void 0:r.device)==="smartphone"}const Z={DESKTOP_COLLAPSE:[9,9],DESKTOP_SUCCESS:[11,11],MOBILE_COLLAPSE:[6,6],MOBILE_SUCCESS:[8,8]};function At(r,i,e){const t=ln(r.getSizes(),i);r.setSizes(t),r.removeSizes(e)}function fa(r){he()?At(r,Z.MOBILE_SUCCESS,Z.MOBILE_COLLAPSE):At(r,Z.DESKTOP_SUCCESS,Z.DESKTOP_COLLAPSE)}function Tt(r){return r===Z.MOBILE_SUCCESS[1]||r===Z.DESKTOP_SUCCESS[1]}const xe=50;class oi extends g{constructor(){super(...arguments);a(this,"name","FloorAdhesionPlugin");a(this,"floorAdhesionSlotName","floor_adhesion");a(this,"containerRendered",!1);a(this,"adEngine");a(this,"adNodeManager");a(this,"closeButtonElement");a(this,"collapseEventSubscriber",new Ge(1));a(this,"closeButtonOnClickEventSubscriber",new Ge(1));a(this,"observer");a(this,"isTentpole",!1);a(this,"hooks",{onAfterAdNodeManagerInit:e=>{this.adNodeManager=e},onAdEngineInit:e=>{this.adEngine=e,this.addSlotRenderEndedFloorAdhesionListener(e)},onAdEngineReset:()=>{var n,s;this.containerRendered=!1,this.isTentpole=!1,this.removeCloseButton(),this.observer&&(this.observer.disconnect(),this.observer=void 0);let e=(n=this.adNodeManager)==null?void 0:n.getAdNodeByName(this.floorAdhesionSlotName);const t=!e;if(e??(e=(s=this.adNodeManager)==null?void 0:s.createAdNode(this.floorAdhesionSlotName)),e){const o=this.getFloorAdhesionWrapper(e);t&&o.style.display==="none"&&(o.style.display="")}}});a(this,"api",{activateTentpole:()=>{this.isTentpole=!0},block:()=>{try{S(this.adNodeManager,"adNodeManager is not defined"),this.adNodeManager.blockSlot(this.floorAdhesionSlotName)}catch(e){h({code:xi,message:"Could not block the slot",priority:c.P3,error:e})}},unblock:async()=>{var s;const{adNodeManager:e,gptWrapper:t}=this.adEngine??{};this.isTentpole&&t&&(t.setTargeting("uap","none"),t.setTargeting("uap_c","none"));const n=e==null?void 0:e.getAdNodeByName(this.floorAdhesionSlotName);n?(n.unblock(),this.expand(n),fa(n),await((s=this.adEngine)==null?void 0:s.adRenderManager.requestRender([n]))):m({code:mr,message:`[FloorAdhesionPlugin] Could not find AdNode for ${this.floorAdhesionSlotName} to unblock.`,priority:c.P4})},onCollapse:e=>this.collapseEventSubscriber.subscribe(e),onClose:e=>this.closeButtonOnClickEventSubscriber.subscribe(e)})}getDebugState(){return{isContainerRendered:this.containerRendered,isTentpole:this.isTentpole,hasCloseButton:!!this.closeButtonElement,hasActiveObserver:!!this.observer}}startObservingSizeChanges(e,t){const n=t.getElement();n&&(this.observer=new ResizeObserver(s=>{s.forEach(o=>{if(o.target!==n)return;const d=o.contentRect.height;this.render(e,t,d)})}),this.observer.observe(n))}getWrapperId(e){var t,n,s;return(s=(n=(t=e==null?void 0:e.getSlotConfig().dynamic)==null?void 0:t.single)==null?void 0:n.wrapper)==null?void 0:s.id}getFloorAdhesionWrapper(e){const t=this.getWrapperId(e);S(t,"floorAdhesionWrapperId is not defined");const n=document.getElementById(t);return S(n,"floorAdhesionWrapper is not defined"),n}createAndAppendCloseButton(e,t){this.closeButtonElement=pa(()=>{e.style.display="none";const n=t.getRenderCount();this.adNodeManager.removeAdNode(t),p(Ae,{type:W.SLOT_FORCE_CLOSE_INFO,slotName:this.floorAdhesionSlotName,rv:n||void 0}),this.closeButtonOnClickEventSubscriber.notify()}),e.appendChild(this.closeButtonElement)}removeCloseButton(){this.closeButtonElement&&(this.closeButtonElement.remove(),this.closeButtonElement=void 0)}isFirstRenderOfBigAd(e){return!this.containerRendered&&e>xe}isRefreshToSmallerAd(e){return this.containerRendered&&e<=xe&&!Tt(e)}isRefreshToBiggerAd(e){return this.containerRendered&&(e>xe||Tt(e))&&!this.closeButtonElement}render(e,t,n){this.containerRendered||e.classList.add("add-background"),this.isFirstRenderOfBigAd(n)?this.createAndAppendCloseButton(e,t):this.isRefreshToSmallerAd(n)?this.removeCloseButton():this.isRefreshToBiggerAd(n)&&this.createAndAppendCloseButton(e,t),this.containerRendered=!0}collapse(e){const t=e.getElement(),n=this.getFloorAdhesionWrapper(e);n.style.display="none",t&&(t.style.height="0px"),this.containerRendered=!1,this.collapseEventSubscriber.notify(),this.observer&&(this.observer.disconnect(),this.observer=void 0)}expand(e){const t=this.getFloorAdhesionWrapper(e);t.style.display="",t.style.height="",e.getElement().style.height=""}addSlotRenderEndedFloorAdhesionListener(e){e.gptWrapper.addSlotEventListener(this.floorAdhesionSlotName,"slotRenderEnded",t=>{var s;const n=(s=this.adNodeManager)==null?void 0:s.getAdNodeByName(this.floorAdhesionSlotName);if(n){if(t.isEmpty){this.collapse(n);return}this.observer||this.startObservingSizeChanges(this.getFloorAdhesionWrapper(n),n)}})}}const ma=".mw-parser-output > h2";function ne(r){var e;return!!((Sa(r)??{}).hasFeaturedVideo&&((e=window.canPlayVideo)!=null&&e.call(window)))}function He(r){return!ne(r)&&!!document.querySelector(ma)}function ba(){var r,i,e;return((i=(r=window.mw)==null?void 0:r.config)==null?void 0:i.get("wgArticleFeaturedVideo"))??((e=window.RLCONF)==null?void 0:e.wgArticleFeaturedVideo)??null}function Sa(r){var i;return r??((i=window.ads)==null?void 0:i.context.targeting)}const _a=/^(?<prefix>sse-)(?<experimentString>.+)$/;function di(){const r=document.documentElement.classList;for(const i of r){const e=i.toLowerCase().match(_a);if(e&&e.groups)return e.groups.experimentString}}function Ea(){const r=di();if(r){const i=li(r);if(i)return i}}const Aa=/^(?<team>[a-zA-Z]+)-(?<ticketId>[0-9]+)-(?<mode>variant|control)-?(?<variant>[1-6])?$/;function li(r){const i=r.toLowerCase().match(Aa);if(i&&i.groups){let e=`${i.groups.mode}`;return i.groups.variant&&(e=`${e}${i.groups.variant}`),{name:`${i.groups.team}-${i.groups.ticketId}`,group:e}}}function Ta(){var r,i;return((i=(r=window.fandomHost)==null?void 0:r.browser)==null?void 0:i.split(" ")[0])??""}function oe(r=window.fandomContext??null){var i;return((i=r==null?void 0:r.user)==null?void 0:i.userState)??Ie}class ya extends g{constructor(){super(...arguments);a(this,"name","PageLevelTargetingPlugin");a(this,"adEngine");a(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e,this.api.setTargeting({labrador:this.adEngine.runtimeConfig.activeLabradorKeyValues})},onInitPageTargeting:e=>{const t=this.buildInitialPageTargeting();Object.assign(e,t)},onBiddersInit:e=>{this.setTargeting(e.gptWrapper),qr().then(()=>this.setTargeting(e.gptWrapper))},onBeforeFirstCallAdsRequest:e=>{const{ppid:t}=this.getTargetingFromFandomContextTracking();t&&e.updatePublisherProvidedId(t)},onAdEngineReset:()=>{const e=this.buildInitialPageTargeting();this.adEngine.gptWrapper.setTargeting(e)}});a(this,"api",{getAllTargeting:()=>{var e;return(e=this.adEngine)==null?void 0:e.gptWrapper.getAllTargeting()},setTargeting:e=>{var t;(t=this.adEngine)==null||t.gptWrapper.setTargeting(e)}})}getDebugState(){return structuredClone({targetingFromLegacy:this.getTargetingFromLegacyAdsContext(),targetingFromFandomContextSite:this.getTargetingFromFandomContextSite(),targetingFromFandomContextPage:this.getTargetingFromFandomContextPage()})}getRating({esrb:e=[],mpa:t=[]}){const n=[];for(const s of e)n.push(`esrb:${s}`);for(const s of t)n.push(`mpa:${s}`);return n}getS2PageType(e){const t=(e==null?void 0:e.pageType)??"article";if(t==="article"){if(ne(e))return`wv-${t}`;if(He())return`${t}-ic`}return t}getTargetingFromLegacyAdsContext(){var n;const{targeting:e={},opts:t={}}=((n=window.ads)==null?void 0:n.context)??{};return{s2:this.getS2PageType(e),original_host:t.isGamepedia===!0?"gamepedia":"fandom"}}getTargetingFromFandomContextSite(){const e=F();if(!(e!=null&&e.site))return{};const{site:t}=e;if(Object.keys(t).length===0)return{};const n={},{categories:s,siteId:o,siteName:d="wikia",tags:l,directedAtChildren:u,taxonomy:b=[]}=t;return t.top1000&&(n.top="1k"),{...n,s0:b[0],s0c:s,s0v:b[1],s1:`_${d}`,siteId:o.toString(),kid_wiki:u?x:ge,rating:this.getRating(l??{}),...l}}getTargetingFromFandomContextPage(){const e=F();if(!(e!=null&&e.page))return{};const{page:t}=e;if(Object.keys(t).length===0)return{};const{articleId:n,pageName:s,pageType:o,pageId:d,lang:l,wordCount:u}=t;return{artid:String(n),lang:l,pageId:d.toString(),pageName:s,pageType:o,tier:Vt(e).toString(),word_count:String(u),wpage:s==null?void 0:s.toLowerCase()}}getTargetingFromFandomContextTracking(){const e=F();if(!(e!=null&&e.tracking))return{};const{tracking:t}=e,n={};return t.pvNumber!==void 0&&(n.pv=t.pvNumber.toString()),t.pvNumberGlobal!==void 0&&(n.pvg=t.pvNumberGlobal.toString()),t.pvUID!==void 0&&(n.pvuid=t.pvUID),t.ppid!==void 0&&(n.ppid=t.ppid),n}getTargetingFromFandomContextTargeting(){const e=F();if(!(e!=null&&e.targeting))return{};const{adGroup:t,...n}=e.targeting,s={...n};return t!==void 0&&(s.adGroup=t.split(",")),s}getTargetingFromFandomContextUser(){return{userState:oe()}}getTargetingFromFandomContext(){return{...this.getTargetingFromFandomContextPage(),...this.getTargetingFromFandomContextSite(),...this.getTargetingFromFandomContextTracking(),...this.getTargetingFromFandomContextTargeting(),...this.getTargetingFromFandomContextUser()}}getTargetingFromFandomAds(){var e;return{reset_count:`${((e=window.fandomAds)==null?void 0:e.resetCount)??0}`}}getExperimentGroups(){const e=di();return e?[e]:[]}getTargetingFromFandomHost(){var t,n,s;const e=he();return{device:((t=window.fandomHost)==null?void 0:t.device)??"desktop",geo:((s=(n=window.fandomHost)==null?void 0:n.geo)==null?void 0:s.country)??"none",is_mobile:e?x:ge,skin:`ucp_${e?"mobile":"desktop"}`,browser:Ta()}}setTargeting(e){const t={...this.getTargetingFromFandomContextTracking(),...this.getTargetingFromFandomContextTargeting()};e.setTargeting(t)}buildInitialPageTargeting(){return{...{odyssey:["1",`1_${Hr()}`],odyssey_version:Lt(),odyssey_takeover:An,product:"fandom",uap:"none",uap_c:"none",dmn:Ft().replace(/\./g,""),hostpre:Pi()??void 0,exp_bucket:Ot(),experiment_groups:this.getExperimentGroups()},...this.getTargetingFromFandomContext(),...this.getTargetingFromFandomHost(),...this.getTargetingFromLegacyAdsContext(),...this.getTargetingFromFandomAds()}}}class va extends g{constructor(){super(...arguments);a(this,"name","PerformanceTestPlugin");a(this,"hooks",{onBeforeFirstCallAdsRequest(e){e.addEventListener("slotRenderEnded",t=>{t.slot.getSlotElementId()==="top_leaderboard"&&performance.mark("top_leaderboard_rendered")})}})}}function Ia(r){return r.offsetTop>=window.innerHeight}const Ue={fandomdesktop:".mw-parser-output",fandommobile:".mw-parser-output",default:"#content"};function Ra(r){return r?Ue[r]??Ue.default:Ue.default}const yt=970;class Ca extends g{constructor(e){super(e);a(this,"name","RepeatableSlotsPlugin");a(this,"contentWidth");a(this,"hooks",{onAfterAdNodeManagerInit:e=>{var n;const{baseSlots:t}=e.getSlotConfigMap();for(const s of Object.values(t))(n=s==null?void 0:s.dynamic)!=null&&n.repeat&&this.createAdNodesForBaseSlot(s,s.dynamic.repeat)}});this.contentWidth=this.calculateContentWidth()}getDebugState(){return{contentWidth:this.contentWidth,maxIncontentAdWidth:yt}}calculateContentWidth(){const e=document.querySelector(Ra(ke()));return e?e.clientWidth:yt}shouldPlaceSlotOnAnchor(e,t,n){const{minDistanceBetweenAds:s=1}=n;if(!Ia(e)||e.offsetWidth<this.contentWidth)return!1;const o=window.innerHeight;if(t!==null&&s>0){const d=o*s,l=t.offsetTop+d;if(e.offsetTop<l)return!1}return!0}getAnchors(e){const t=[...document.querySelectorAll(e.selector)],n=(e==null?void 0:e.startAtSelectorIndex)??0;let s=null;return t.filter((d,l)=>{if(this.shouldPlaceSlotOnAnchor(d,s,e)&&l>=n)return s=d,!0})}createAdNodesForBaseSlot(e,t){const n=document.createElement("div");n.classList.add(e.name,T.WRAPPER_CLASS);const s=this.getAnchors(t),o=Math.min(t.max??Number.MAX_SAFE_INTEGER,s.length);for(let d=0;d<o;d++){const l=`${e.name}_${d+1}`,u=s[d],b=n.cloneNode(),v=document.createElement(T.ELEMENT_NAME);v.id=l,b.appendChild(v),u[t.insertMethod](b)}}}class Na{constructor(i,e){a(this,"refreshStatus");a(this,"nextRefreshTime");a(this,"refreshTimerRef");a(this,"slotVisibilityChangedEventListenerUnsubscribe");this.adNode=i,this.refreshTimeoutMS=e,this.refreshStatus="disabled",this.init()}init(){var i;this.clearTimer(),this.unsubscribeFromSlotVisibilityChangedEventListener(),this.refreshStatus=(i=this.refreshConfig)!=null&&i.enabled?"enabled":"disabled"}onRefreshScheduled(i){this.clearTimer(),this.refreshTimerRef=i,this.nextRefreshTime=new Date(Date.now()+this.refreshTimeoutMS),this.refreshStatus="scheduled"}onSlotVisibilityChangedEventListenerSubscribed(i){this.refreshStatus="out-of-view",this.clearTimer(),this.unsubscribeFromSlotVisibilityChangedEventListener(),this.slotVisibilityChangedEventListenerUnsubscribe=i}onSlotVisible(){this.unsubscribeFromSlotVisibilityChangedEventListener()}onRequestRender(){this.refreshStatus="refreshing",this.clearTimer()}onAdNodeRemoved(){this.clearTimer(),this.unsubscribeFromSlotVisibilityChangedEventListener(),this.refreshStatus="disabled"}onSlotRenderEnded(){var i;this.refreshStatus=(i=this.refreshConfig)!=null&&i.enabled?"enabled":"disabled"}getDebugState(){const i={status:this.refreshStatus};return this.nextRefreshTime&&(i.nextRefreshTime=this.nextRefreshTime,i.secondsUntilNextRefresh=this.nextRefreshTime.getTime()-Date.now()),i.config=this.refreshConfig,i}get refreshConfig(){return this.adNode.getSlotConfig().refresh}clearTimer(){this.refreshTimerRef&&clearTimeout(this.refreshTimerRef),this.refreshTimerRef=void 0,this.nextRefreshTime=void 0}unsubscribeFromSlotVisibilityChangedEventListener(){var i;(i=this.slotVisibilityChangedEventListenerUnsubscribe)==null||i.call(this),this.slotVisibilityChangedEventListenerUnsubscribe=()=>{}}}const ce=class ce extends g{constructor(e,t){super(e);a(this,"name","SlotRefresherPlugin");a(this,"active",!0);a(this,"refreshTimeoutMS",ce.DEFAULT_REFRESH_TIMEOUT_MS);a(this,"adEngine");a(this,"adNodeRefreshers");a(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e,e.gptWrapper.addEventListener("impressionViewable",t=>{this.scheduleRefresh(t.slot,e)}),e.gptWrapper.addEventListener("slotRenderEnded",t=>{var n;(n=this.adNodeRefreshers.get(t.slot.getSlotElementId()))==null||n.onSlotRenderEnded()})},onAdNodeCreated:e=>{this.adNodeRefreshers.set(e.getSlotName(),new Na(e,this.refreshTimeoutMS))},onAdNodeRemoved:e=>{const t=this.adNodeRefreshers.get(e.getSlotName());t==null||t.onAdNodeRemoved(),this.adNodeRefreshers.delete(e.getSlotName())},onAdEngineReset:()=>{this.active=!0;for(const e of this.adNodeRefreshers.values())e.init()}});a(this,"api",{stop:()=>{this.active=!1},stopSlot:e=>{var n;const t=(n=this.adEngine)==null?void 0:n.adNodeManager.getAdNodeByName(e);S(t,`AdNode for slot ${e} not found`),t.block()}});this.instantConfig=t,this.adNodeRefreshers=new Map,this.refreshTimeoutMS=this.instantConfig.icRefreshTimeoutMS??ce.DEFAULT_REFRESH_TIMEOUT_MS}refreshWhenBackInViewport(e,t){var o;const n=e.getSlotName(),s=t.gptWrapper.addSlotEventListener(n,"slotVisibilityChanged",d=>{var l,u;d.inViewPercentage>=50&&((l=this.adNodeRefreshers.get(n))==null||l.onSlotVisible(),this.active&&(t.adRenderManager.requestRender([e]),(u=this.adNodeRefreshers.get(n))==null||u.onRequestRender()))});(o=this.adNodeRefreshers.get(n))==null||o.onSlotVisibilityChangedEventListenerSubscribed(s)}refreshOrAddListener(e,t){var n;this.active&&(e.isInViewport()?(t.adRenderManager.requestRender([e]),(n=this.adNodeRefreshers.get(e.getSlotName()))==null||n.onRequestRender()):this.refreshWhenBackInViewport(e,t))}scheduleRefresh(e,t){var d;const n=e.getSlotElementId(),s=t.adNodeManager.getAdNodeByName(n);S(s,`Cannot schedule refresh. AdNode for slot ${n} not found`);const o=window.setTimeout(()=>{s.isRefreshable()&&this.refreshOrAddListener(s,t)},this.refreshTimeoutMS);(d=this.adNodeRefreshers.get(n))==null||d.onRefreshScheduled(o)}getDebugState(){const e={refreshActive:this.active,refreshTimeoutMS:this.refreshTimeoutMS,adNodes:{}};for(const[t,n]of this.adNodeRefreshers.entries())e.adNodes[t]=n.getDebugState();return e}};a(ce,"DEFAULT_REFRESH_TIMEOUT_MS",3e4);let pe=ce;const Pa={cache:{url:"https://prebid-server.rubiconproject.com/cache",ignoreBidderCacheKey:!0},s2sConfig:[]},ka={enabled:!0,accountId:"7450",bidders:["mgnipbs"],defaultVendor:"rubicon",coopSync:!0,userSyncLimit:8,defaultTTL:300,timeout:500,allowUnknownBidderCodes:!0,extPrebid:{cache:{vastxml:{returnCreative:!1}},bidders:{mgnipbs:{wrappername:"7450_Web_Server"}}}};class wa extends g{constructor(e,t){super(e);a(this,"name","ServerToServerPlugin");a(this,"hooks",{onBiddersInit:()=>{if(this.instantConfig.icPrebidMagniteS2s){const e=this.usePlugin(y);e==null||e.addPrebidReadyCallback(t=>{t.setConfig(Pa)}),e==null||e.addPrebidReadyCallback(t=>{t.mergeConfig({s2sConfig:[ka]})})}}});this.instantConfig=t}static isEnabled(e,t){return!!t.icPrebidMagniteS2s&&super.isEnabled(e,t)}}const M="top_leaderboard",qe={DESKTOP:[3,3],MAX:[3,3],MOBILE:[2,2]},La=250;function ci(r){if(r.size===null||typeof r.size=="string")return!1;if(Array.isArray(r.size)&&r.size.length>=2){const[i,e]=r.size;return ze([i,e],qe.DESKTOP)||ze([i,e],qe.MOBILE)}return!1}function Da(r,i){if(r==="fandomdesktop")return k(async()=>{const{TopBoxadHandler:e}=await import("./TopBoxadHandler-D3AHPWmH.js");return{TopBoxadHandler:e}},[]).then(({TopBoxadHandler:e})=>{new e().applySticky(i)}).catch(e=>{h({code:Gi,message:"Failed to load TopBoxadHandler",error:e,priority:c.P4})})}const Ne=class Ne extends g{constructor(){super(...arguments);a(this,"name","InContentLeaderboardPlugin");a(this,"adEngine");a(this,"adNodes",[]);a(this,"blockedSlots",new Set);a(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e,this.adNodes=this.adEngine.adNodeManager.getAdNodesByBaseName(Ne.IN_CONTENT_LEADERBOARD_BASE_SLOT_NAME),this.api.block(0)}});a(this,"api",{block:e=>{var n;const t=this.getAdNodes(e);try{S((n=this.adEngine)==null?void 0:n.adNodeManager,"adNodeManager is not defined");for(const s of t)this.blockSlot(s)}catch(s){h({code:$i,message:"Could not block slots",error:s,priority:c.P3})}},unblock:e=>{var n;const t=this.getAdNodes(e);try{S((n=this.adEngine)==null?void 0:n.adNodeManager,"adNodeManager is not defined");for(const s of t)this.unblockSlot(s)}catch(s){h({code:ji,message:"Could not unblock slots",error:s,priority:c.P3})}}})}getDebugState(){return{incontentLeaderboardSlots:this.adNodes.map(e=>e.getSlotName()),blockedSlots:Array.from(this.blockedSlots)}}getAdNodes(e){return e===void 0?this.adNodes:e<0||e>=this.adNodes.length?[]:[this.adNodes[e]]}blockSlot(e){var n;(n=this.adEngine)==null||n.adNodeManager.blockSlot(e.getSlotName()),this.blockedSlots.add(e.getSlotName());const t=e.getElement();t&&(t.style.display="none")}unblockSlot(e){var n;(n=this.adEngine)==null||n.adNodeManager.unblockSlot(e.getSlotName()),this.blockedSlots.delete(e.getSlotName());const t=e.getElement();t&&(t.style.display="")}};a(Ne,"IN_CONTENT_LEADERBOARD_BASE_SLOT_NAME","incontent_leaderboard");let Re=Ne;class ui extends g{constructor(){super(...arguments);a(this,"name","InContentPlayerPlugin");a(this,"hasFiredInContentVideoInitCallback",!1);a(this,"initOnceEventSubscriber",new Ge(1));a(this,"api",{initOnce:()=>{this.hasFiredInContentVideoInitCallback||(this.hasFiredInContentVideoInitCallback=!0,this.initOnceEventSubscriber.notify())},reject:()=>{const e=this.usePlugin(Re);e==null||e.unblock(0)},registerInContentPlayerInitCallback:e=>{this.initOnceEventSubscriber.subscribe(e)}})}getDebugState(){return{hasInContentVideoInitCallbackFired:this.hasFiredInContentVideoInitCallback}}}const Fa=1e10;function Oa(){return Math.floor(Math.random()*Fa)+1}function Ba(){return["output=xml_vast4","env=vp","gdfp_req=1","impl=s","unviewed_position_start=1",`url=${encodeURIComponent(window.location.href)}`,`description_url=${encodeURIComponent(window.location.href)}`,`correlator=${Oa()}`]}function Ma(){var i,e;const r=(e=(i=F())==null?void 0:i.tracking)==null?void 0:e.ppid;return r?[`ppid=${r}`]:[]}function xa(r){const i=Le(r.getSizes());return i.length>0?i.join("|"):"640x480"}function Ua(r){window.ads&&r&&(window.ads.runtime=window.ads.runtime??{},window.ads.runtime.video={adUnit:r})}const Va="https://pubads.g.doubleclick.net/gampad/ads?";class $e extends g{constructor(e,t){super(e);a(this,"name","VastUrlPlugin");a(this,"consentData");a(this,"resolvedState",Promise.withResolvers());a(this,"isIcvAlreadyCreated",!1);a(this,"adEngine");a(this,"api",{get:async(e="featured",t)=>{const n=this.getAdNode(e)??this.createFeaturedAdNode();return n?(await this.requestBids(n),`${Va}${this.getParams(t,n).join("&")}`):""},getAdUnitPath:(e="incontent_player")=>{const t=this.getAdNode(e)??this.createIncontentAdNode();return(t==null?void 0:t.getAdUnitPath())??""},getTargetingParams:async(e="featured",t)=>{const n=this.getAdNode(e);return n?(await this.requestBids(n),this.buildCustomParams(t,n)):""},getPageTargeting:()=>{var e;return this.createIncontentAdNode(),((e=this.adEngine)==null?void 0:e.gptWrapper.getAllTargeting({raw:!1}))??{}},getSlotTargeting:e=>{var t;return this.createIncontentAdNode(),((t=this.adEngine)==null?void 0:t.gptWrapper.getAllSlotTargeting(e,{raw:!1}))??{}},setAdUnitRuntimeVariable:(e="incontent_player")=>{const t=this.api.getAdUnitPath(e)??"";Ua(t)},unblockVideo:()=>{this.resolvedState.resolve()}});a(this,"hooks",{onConsentUpdated:e=>{this.consentData=e},onAfterAdNodeManagerInit:()=>{this.instantConfig.icUAPJWPlayer||this.api.unblockVideo()},onAdEngineInit:e=>{this.adEngine=e}});this.instantConfig=t}getDebugState(){return{hasFeaturedVideo:ne(),hasIncontentPlayer:He()}}createFeaturedAdNode(){var e,t;if(ne()&&((e=document.getElementById("featured"))==null?void 0:e.tagName)!==L.ELEMENT_NAME.toUpperCase())return(t=this.adEngine)==null?void 0:t.adNodeManager.createAdNode("featured")}createIncontentAdNode(){var e,t;if(He()&&!this.isIcvAlreadyCreated&&((e=document.getElementById("incontent_player"))==null?void 0:e.tagName)!==L.ELEMENT_NAME.toUpperCase())return this.isIcvAlreadyCreated=!0,(t=this.adEngine)==null?void 0:t.adNodeManager.createAdNode("incontent_player")}getParams(e,t){return[...Ba(),...Ma(),...this.getPrivacyParams(),...this.getSlotParams(t),...this.getCustomParams(e,t),...this.getVideoParams()].filter(Boolean)}getSlotParams(e){const t=e.getAdUnitPath(),n=xa(e);return[`iu=${t}`,`sz=${n}`]}getPrivacyParams(){const{coppa:e,consentApi:t,consentString:n=""}=this.consentData??{},s=[];return t==="usp"?s.push(`us_privacy=${n}`,"gdpr=0"):t==="tcf"&&s.push(`gdpr_consent=${n}`,"gdpr=1"),e===!0&&s.push("tfcd=1"),s}buildCustomParams(e,t){const n=(t==null?void 0:t.getAllTargeting())??{},s=Object.entries(n).map(([l,u])=>`${l}=${u.join(",")}`).join("&"),o=this.getPageTargetingParams();return[`player=${this.getVideoPlayer(e)}`,"rv=1",s,...o,...this.getUAPParams()].filter(Boolean).join("&")}getCustomParams(e,t){const n=this.buildCustomParams(e,t);return[`cust_params=${encodeURIComponent(n)}`]}getPageTargetingParams(){var t;const e=((t=this.adEngine)==null?void 0:t.gptWrapper.getAllTargeting({raw:!1}))??{};return Object.entries(e).map(([n,s])=>`${n}=${s}`)}getVideoPlayer(e){return e??(this.instantConfig.icFeaturedVideoPlayer==="Connatix"?"cnx":"jwp")}getVideoParams(){return[`vpos=${this.getPosition()}`]}getUAPParams(){var n,s,o,d;const e=(s=(n=this.adEngine)==null?void 0:n.gptWrapper)==null?void 0:s.getTargeting("uap"),t=(d=(o=this.adEngine)==null?void 0:o.gptWrapper)==null?void 0:d.getTargeting("uap_c");return e&&t?[`uap=${e[0]}`,`uap_c=${t[0]}`]:[]}getPosition(){return"preroll"}waitForResolvedState(){return this.resolvedState.promise}getAdNode(e){var t;return(t=this.adEngine)==null?void 0:t.adNodeManager.getAdNodeByName(e)}async requestBids(e){var t;e.incrementRenderCount(),await((t=this.adEngine)==null?void 0:t.adRenderManager.requestBids([e])),await this.waitForResolvedState()}}class Wa{constructor(){a(this,"activating",!1);a(this,"feature");a(this,"killDeactivation",!1);a(this,"onRemoveStickinessCallback")}activate(i){this.activating||this.feature||(this.activating=!0,k(async()=>{const{StickyFeature:e}=await import("./StickyFeature-DxSbHdth.js");return{StickyFeature:e}},[]).then(({StickyFeature:e})=>{this.feature=new e,this.feature.activate(i),this.activating=!1,this.onRemoveStickinessCallback&&this.feature.onRemoveStickiness(this.onRemoveStickinessCallback)}).catch(()=>{throw this.activating=!1,new Error("Failed to load StickyFeature")}))}addOnRemoveStickiness(i){if(!this.feature){this.onRemoveStickinessCallback=i;return}this.feature.onRemoveStickiness(i)}deactivate(){if(this.killDeactivation){this.killDeactivation=!1;return}if(!this.feature){setTimeout(()=>{this.deactivate()},100);return}this.feature.removeStickiness({forcedByDeactivation:!0})}reactivate(i,e){if(this.killDeactivation=!0,!this.feature){this.activate({...i,disableAutoUnstick:e});return}this.feature.activate({...i,disableAutoUnstick:e})}reset(){this.feature&&this.feature.removeStickiness({forcedByDeactivation:!0})}}class za{constructor(i){a(this,"activating",!1);a(this,"feature");this.topStrategyTunerPlugin=i}activate(i,e){this.activating||this.feature||(this.activating=!0,k(async()=>{const{SkyboxFeature:t}=await import("./SkyboxFeature-BSuA9K_c.js");return{SkyboxFeature:t}},[]).then(({SkyboxFeature:t})=>{this.feature=new t,this.feature.activate(this.topStrategyTunerPlugin,i,e),this.activating=!1}).catch(()=>{throw this.activating=!1,new Error("Failed to load SkyboxFeature")}))}moveToResolvedState(i){this.feature&&(this.feature.isStateResolved()||this.feature.makeStateResolved(i))}onSkyboxStateResolved(i){this.feature&&this.feature.onSkyboxStateResolved(i)}onSkyboxRender(i){const e=(i==null?void 0:i.getRenderCount())??-1;i&&e>1&&this.feature&&this.feature.reset(i)}reset(){var i;this.feature&&((i=this.feature)==null||i.reset())}}class Ga{constructor(i){a(this,"activating",!1);a(this,"feature");this.adNodeManager=i}activate(i){this.activating||this.feature||(this.activating=!0,k(async()=>{const{SlotManagerFeature:e}=await import("./SlotManagerFeature-SVdkR6ey.js");return{SlotManagerFeature:e}},[]).then(({SlotManagerFeature:e})=>{this.feature=new e(this.adNodeManager),this.feature.activate(i.enabledSlots??[]),this.activating=!1}).catch(()=>{throw this.activating=!1,new Error("Failed to load SlotManagerFeature")}))}}class Ha{constructor(){a(this,"activating",!1);a(this,"feature")}activate(i,e){this.activating||this.feature||(this.activating=!0,k(async()=>{const{VideoBannerFeature:t}=await import("./VideoBannerFeature-QWmVrdbz.js");return{VideoBannerFeature:t}},[]).then(({VideoBannerFeature:t})=>{this.feature=new t,this.feature.activate(i,e),this.activating=!1}).catch(()=>{throw this.activating=!1,new Error("Failed to load VideoBannerFeature")}))}stopVideoOnOutOfViewport(){this.feature&&this.feature.stopVideoOnOutOfViewport()}reset(){this.feature&&this.feature.reset()}}function vt(r){return r?r.toString():"none"}const gi=/(opera|chrome|safari|firefox|msie|trident(?=\/))/i;function hi(){const r=navigator.userAgent.match(gi);return r!==null&&r[1]==="Chrome"}function qa(){const r=navigator.userAgent.match(gi);return r!==null&&r[1].toLowerCase()==="safari"&&!hi()}function $a(){qa()&&requestAnimationFrame(()=>{const r=document.body.style.display;document.body.style.display="inline-block",document.body.offsetHeight,document.body.style.display=r})}class ja extends g{constructor(e,t,n){super(e);a(this,"name","TopStrategyTunerPlugin");a(this,"adNodeManager");a(this,"gpt");a(this,"defaultStickyTlbPromiseResolver",()=>{});a(this,"defaultStickyTlbPromiseRejecter",()=>{});a(this,"featuresFlags",{skyboxResolved:!1});a(this,"defaultStickyTlbApplied",!1);a(this,"stickyActivator");a(this,"skyboxActivator");a(this,"slotManagerActivator");a(this,"videoFeatureActivator");a(this,"tentpoleActivator",Promise.withResolvers());a(this,"onTlbLoadedCallbacks",[]);a(this,"hasFanTakeoverLoaded",null);a(this,"api",{activate:async e=>{var t;e.slotName??(e.slotName=M),this.defaultStickyTlbPromiseRejecter(),e.skybox&&e.takeover&&((t=this.usePlugin(pe))==null||t.stop()),this.activateTentpoleFeature(e),this.activateStickyFeature(e),this.activateSlotManagerFeature(e),this.activateSkyboxFeature(e),this.activateVideoFeature(e)},onRemoveStickiness:e=>{var t;(t=this.stickyActivator)==null||t.addOnRemoveStickiness(e)},onSkyboxStateResolved:e=>{var t;(t=this.skyboxActivator)==null||t.onSkyboxStateResolved(e)},onTlbLoaded:e=>{this.onTlbLoadedCallbacks.push(e)}});a(this,"hooks",{onAfterAdNodeManagerInit:e=>{var t;this.adNodeManager=e,ne()&&((t=this.adNodeManager.getAdNodeByName(M))==null||t.removeSizes(qe.MAX,ae.LESS_THAN_OR_EQUAL))},onAfterGptWrapperInit:e=>{this.gpt=e,this.activateOrUnblockProperPluginOnDefaultTopSlotRender(e),this.handleDefaultTopLeaderboardFirstImpression(e)},onAdEngineReset:()=>{this.resetActivators(),this.resetState()}});this.instantConfig=t,this.defaultStickyTlbPromise=n,this.defaultStickyTlbPromise??(this.defaultStickyTlbPromise=new Promise((s,o)=>{this.defaultStickyTlbPromiseResolver=s,this.defaultStickyTlbPromiseRejecter=o})),document.body.classList.add("odyssey","odyssey-top-strategy")}getDebugState(){return{isSkyboxResolved:this.featuresFlags.skyboxResolved,hasFanTakeoverLoaded:this.hasFanTakeoverLoaded,isDefaultStickyTlbApplied:this.defaultStickyTlbApplied,hasStickyActivator:!!this.stickyActivator,hasSkyboxActivator:!!this.skyboxActivator,hasSlotManagerActivator:!!this.slotManagerActivator,hasVideoBannerActivator:!!this.videoFeatureActivator,onTlbLoadedCallbacksCount:this.onTlbLoadedCallbacks.length}}activateStickyFeature(e){!e.sticky&&this.defaultStickyTlbApplied||(this.stickyActivator??(this.stickyActivator=new Wa),this.stickyActivator.activate(e))}activateSkyboxFeature(e){var t;e.skybox&&(this.skyboxActivator??(this.skyboxActivator=new za(this)),(t=this.stickyActivator)==null||t.deactivate(),this.skyboxActivator.activate(e,()=>{var n;this.featuresFlags.skyboxResolved=!0,(n=this.stickyActivator)==null||n.reactivate(e,!he()),$a()}),this.onTlbLoadedCallbacks.forEach(n=>n(!0)))}activateSlotManagerFeature(e){var t;!e.takeover||!((t=e.enabledSlots)!=null&&t.length)||(this.slotManagerActivator=new Ga(this.adNodeManager),this.slotManagerActivator.activate({enabledSlots:e.enabledSlots}))}activateTentpoleFeature(e){var n,s,o;if(typeof e.tentpole!="object"){this.tentpoleActivator.resolve();return}const{tentpole:t}=e;this.gpt&&(this.gpt.setTargeting("uap",vt(t==null?void 0:t.lineItemId)),this.gpt.setTargeting("uap_c",vt(t==null?void 0:t.creativeId))),(n=this.usePlugin(pe))==null||n.stop(),(s=this.usePlugin($e))==null||s.unblockVideo(),this.unblockVideoAds(),(o=this.usePlugin(oi))==null||o.activateTentpole(),Da(ke(),this)}activateOrUnblockProperPluginOnDefaultTopSlotRender(e){e.addSlotEventListener(M,"slotRenderEnded",async t=>{var n,s;if(this.handleUnblockVideoOnDefaultSlotRender(),this.skyboxActivator){const o=(n=this.adNodeManager)==null?void 0:n.getAdNodeByName(M);this.skyboxActivator.onSkyboxRender(o);return}if(!he()){if(!this.instantConfig.icForceStickyTlb&&t.isEmpty)return;(s=this.defaultStickyTlbPromise)==null||s.then(()=>{this.defaultStickyTlbApplied=!0,this.activateStickyFeature({id:"unknown",slotName:M,sticky:!0})}),setTimeout(()=>{this.defaultStickyTlbPromiseResolver()},100)}this.handleInContentVideo(t)})}handleDefaultTopLeaderboardFirstImpression(e){e.addSlotEventListener(M,"impressionViewable",()=>{var n,s;if(this.skyboxActivator)return;((s=(n=this.adNodeManager)==null?void 0:n.getAdNodeByName(M))==null?void 0:s.getRenderCount())===1&&this.onTlbLoadedCallbacks.forEach(o=>o(!1))})}handleUnblockVideoOnDefaultSlotRender(){const e=()=>{var t;(t=this.usePlugin($e))==null||t.unblockVideo(),this.unblockVideoAds()};j(this.tentpoleActivator.promise,La).then(e,e)}handleInContentVideo(e){this.hasFanTakeoverLoaded=ci(e);const t=this.usePlugin(ui);!this.hasFanTakeoverLoaded&&!ne()?t==null||t.initOnce():t==null||t.reject()}activateVideoFeature(e){var t;e.videoUrl&&(this.videoFeatureActivator??(this.videoFeatureActivator=new Ha),this.videoFeatureActivator.activate(e,()=>{var n;(n=this.skyboxActivator)==null||n.moveToResolvedState(e)}),(t=this.stickyActivator)==null||t.addOnRemoveStickiness(()=>{var n;(n=this.videoFeatureActivator)==null||n.stopVideoOnOutOfViewport()}))}resetActivators(){var e,t,n;(e=this.stickyActivator)==null||e.reset(),(t=this.skyboxActivator)==null||t.reset(),(n=this.videoFeatureActivator)==null||n.reset()}resetState(){this.featuresFlags.skyboxResolved=!1,this.defaultStickyTlbApplied=!1,this.hasFanTakeoverLoaded=null,this.onTlbLoadedCallbacks.length=0}unblockVideoAds(){const e=document.getElementsByTagName(L.ELEMENT_NAME);for(const t of e)t instanceof L&&t.unblockVideo()}}class Ka extends g{constructor(e,t){super(e);a(this,"name","LightboxLeaderboardPlugin");a(this,"adEngine");a(this,"refreshLock",!1);a(this,"slotExpanded",!1);a(this,"galleryLeaderboard",null);a(this,"lightboxLeaderboardAdNode");a(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e},onAdNodeCreated:e=>{this.lightboxLeaderboardAdNode=e}});a(this,"api",{onLightboxOpen:e=>{this.galleryLeaderboard=document.querySelector(".gallery-leaderboard"),this.galleryLeaderboard&&this.renderOrRefreshAd(e)},onLightboxClose:()=>{this.galleryLeaderboard=null,this.toggleFloorAdhesion(!1)},onLightboxChange:e=>{this.renderOrRefreshAd(e)}});this.instantConfig=t}getDebugState(){return{isRefreshLocked:this.refreshLock,isSlotExpanded:this.slotExpanded,hasGalleryLeaderboard:!!this.galleryLeaderboard,hasLightboxLeaderboardAdNode:!!this.lightboxLeaderboardAdNode}}setRefreshLock(e=2e3){this.refreshLock=!0,setTimeout(()=>{this.refreshLock=!1},e)}waitForFloorWrapper(e){const t=document.getElementById("floor_adhesion_wrapper");if(t){e(t);return}const n=new MutationObserver(()=>{const s=document.getElementById("floor_adhesion_wrapper");s&&(n.disconnect(),e(s))});n.observe(document.body,{childList:!0,subtree:!0})}toggleFloorAdhesion(e){this.waitForFloorWrapper(t=>{t.classList.toggle("hide-under-lightbox",e)})}getOrCreateLightboxLeaderboard(){var t;if(!this.galleryLeaderboard)return null;let e=document.getElementById("lightbox_leaderboard");return e||(e=document.createElement(T.ELEMENT_NAME),e.id="lightbox_leaderboard",this.galleryLeaderboard.classList.add(T.WRAPPER_CLASS),this.galleryLeaderboard.prepend(e),this.lightboxLeaderboardAdNode=(t=this.adEngine)==null?void 0:t.adNodeManager.getAdNodeByName("lightbox_leaderboard")),e}handleShowingAdSlot(){var n;const e=this.getOrCreateLightboxLeaderboard();if(!e)return;this.toggleFloorAdhesion(!0),(n=e.parentElement)==null||n.classList.remove("is-loading");const t=document==null?void 0:document.getElementsByClassName("lightbox-wrapper-inner")[0];t&&!t.classList.contains("with-ad")&&t.classList.add("with-ad"),this.expandSlot(),this.bidAndRefreshLightboxLeaderboardAdNode()}handleHidingAdSlot(){var n;if(!this.getOrCreateLightboxLeaderboard())return;const t=document==null?void 0:document.getElementsByClassName("lightbox-wrapper-inner")[0];(n=t==null?void 0:t.classList)==null||n.remove("with-ad"),this.collapseSlot()}collapseSlot(){var t;if(!this.slotExpanded)return;const e=(t=this.lightboxLeaderboardAdNode)==null?void 0:t.getElement();e&&(e.style.height="0px",e.parentElement&&(e.parentElement.style.display="none")),this.slotExpanded=!1}expandSlot(){var t;if(this.slotExpanded)return;const e=(t=this.lightboxLeaderboardAdNode)==null?void 0:t.getElement();e&&(e.style.height="",e.parentElement&&(e.parentElement.style.display="")),this.slotExpanded=!0}renderOrRefreshAd(e){var t;if(this.instantConfig.icLightboxLeaderboardEnabled&&((t=this.adEngine)==null?void 0:t.monetizationTierEngine.getCurrentTier())===E.PARTIALLY_MONETIZED)if(e){if(this.refreshLock)return;this.handleShowingAdSlot()}else this.handleHidingAdSlot()}async bidAndRefreshLightboxLeaderboardAdNode(){var e;this.setRefreshLock(),this.lightboxLeaderboardAdNode&&((e=this.adEngine)==null||e.adRenderManager.requestRender([this.lightboxLeaderboardAdNode],!0))}}class Ya extends g{constructor(){super(...arguments);a(this,"name","LotamePlugin");a(this,"CLIENT_ID",17364);a(this,"PIXEL_URL",`https://tags.crwdcntrl.net/lt/c/${this.CLIENT_ID}/lt.min.js`);a(this,"isLoaded",!1);a(this,"TAXONOMY_TAGS_TO_KEEP",["gnre","media","pform","pub","theme","tv"]);a(this,"hooks",{onConsentUpdated:e=>{w(e)&&this.init()},onAdEngineReset:()=>{var s;if(!this.isLoaded)return;const e=`lotame_${this.CLIENT_ID}`,t=window[e];if(!(t!=null&&t.page))return;const n=this.setupLotameTagInput();(s=t.cmd)==null||s.push(()=>{var o;(o=t.page)==null||o.call(t,n.data)})}})}getDebugState(){var e,t;return{isScriptLoaded:this.isLoaded,clientId:this.CLIENT_ID,hasFandomContext:!!((t=(e=F())==null?void 0:e.site)!=null&&t.tags)}}mapTaxonomyToLotameBehaviorTags(e={}){const t=[];for(const[n,s]of Object.entries(e))if(this.TAXONOMY_TAGS_TO_KEEP.includes(n))for(const o of s)t.push(`${n}: ${o}`);return t}setupLotameTagInput(){var n,s;const e=(s=(n=F())==null?void 0:n.site)==null?void 0:s.tags;return{data:{behaviors:{med:e?this.mapTaxonomyToLotameBehaviorTags(e):[]}},config:{clientId:this.CLIENT_ID}}}setupLotameNamespaceConfig(){const e=this.setupLotameTagInput(),t=`lotame_${this.CLIENT_ID}`,n=e.config??{},s=window[t]={};s.config=n,s.data=e.data??{},s.cmd=s.cmd??[],s.cmd.push(()=>{var o;(o=s.setUserConsent)==null||o.call(s,{lotameConsent:!0})})}async loadLotameScript(){this.setupLotameNamespaceConfig();try{await _e("lotame",this.PIXEL_URL),this.isLoaded=!0}catch{}}static isEnabled(e,t){return!!t.icLotame&&super.isEnabled(e,t)}init(){this.isLoaded||this.loadLotameScript()}}class Qa extends g{constructor(e){super(e);a(this,"name","ConfiantPlugin");a(this,"scriptDomain","cdn.confiant-integrations.net");a(this,"fallbackPropertyId","d-aIf3ibf0cYxCLB1HTWfBQOFEA");a(this,"propertyId");a(this,"isLoaded",!1);a(this,"trackBlock",(e,t,n,s,o,d)=>{if(d&&d.dfp){const l=d.dfp.s;console.debug(`Blocked ad on ${l}`)}});a(this,"hooks",{onConsentUpdated:e=>{w(e)&&this.init()}});this.propertyId=e.propertyId??this.fallbackPropertyId}getDebugState(){return{isScriptLoaded:this.isLoaded,propertyId:this.propertyId,scriptDomain:this.scriptDomain}}static isEnabled(e,t){return!!t.icConfiant&&super.isEnabled(e,t)}async loadConfiantScript(){const e=`//${this.scriptDomain}/${this.propertyId}/gpt_and_prebid/config.js`;try{await _e("confiant",e),this.isLoaded=!0}catch{}}setupConfiantWindowObject(){window.confiant=window.confiant??{},window.confiant.callback=this.trackBlock}init(){this.isLoaded||(this.setupConfiantWindowObject(),this.loadConfiantScript())}}const Xa=1,It={default:1187275693,v6_1:339079598},Za={default:"IntentIqObject",v6_1:"IntentIqObject61"};function Ja(r){return{biddingPlatformId:Xa,partnerAuctionId:r.auctionId,bidderCode:r.bidderCode,prebidAuctionId:r.auctionId,cpm:r.cpm,currency:r.currency}}function eo(r){return`//script.wikia.nocookie.net/fandom-ae-assets/intentiq/${r}/IIQUniversalID.js`}function it(r){return r==="v6.1"}function to(r){return Za[it(r)?"v6_1":"default"]}function pi(r){return window[to(r)]}async function io(r){await Te(()=>pi(r)!==void 0,{maxTries:10,exponentialTimeout:10})}function ro(r,i,e){const t=window.location.hostname.includes(".fandom.com")?"fandom.com":window.location.hostname;return it(r)?{partner:It.v6_1,pbjs:e,timeoutInMillis:i,ABTestingConfigurationSource:"IIQServer",manualWinReportEnabled:!0,domainName:t,vrBrowserBlackList:["chrome"]}:{partner:It.default,pbjs:e,timeoutInMillis:i,ABTestingConfigurationSource:"percentage",abPercentage:97,manualWinReportEnabled:!0,domainName:t,vrBrowserBlackList:["chrome"]}}async function no(r,i,e){return new Promise(t=>{const n=new i({...r,callback:(s,o)=>{o??(o="U"),e(n,o),t()}})})}async function so(r,i,e){return new Promise(t=>{var o,d;const n=new i({...r,callback:()=>{t()}}),s=((d=(o=n==null?void 0:n.intentIqConfig)==null?void 0:o.abTesting)==null?void 0:d.currentTestGroup)??"U";e(n,s)})}async function ao(r,i,e,t){const n=ro(r,i,e),s=pi(r);if(s)return it(r)?no(n,s,t):so(n,s,t)}const oo=1e3;class lo extends g{constructor(e,t){super(e);a(this,"name","IntentIqPlugin");a(this,"consent",!1);a(this,"enabled",!1);a(this,"intentIqObject");a(this,"gptWrapper");a(this,"pbjs");a(this,"hooks",{onBiddersInit:()=>{var e;(e=this.usePlugin(y))==null||e.addPrebidReadyCallback(t=>{this.pbjs=t,this.initialize(this.pbjs)})},onConsentUpdated:e=>{this.consent=w(e),this.pbjs&&this.initialize(this.pbjs)},onAfterGptWrapperInit:e=>{this.gptWrapper=e}});this.instantConfig=t}static isEnabled(e,t){return!hi()&&!!t.icPrebidIntentIQ&&!!t.icPrebidIntentIQVersion&&!!t.icPrebidIntentIQTimeout&&super.isEnabled(e,t)}async initialize(e){if(this.enabled||!this.consent)return;await this.loadIntentIqLibrary(e);const t=({bid:n})=>{this.reportPrebidWin(n)};e.onEvent("adRenderSucceeded",t)}async loadIntentIqLibrary(e){try{p(A,{type:_.VENDOR_TIME_UPDATE,eventName:"intentiq_started",time:performance.now()}),await j(q(eo(this.instantConfig.icPrebidIntentIQVersion)),oo)}catch{p(A,{type:_.VENDOR_TIME_UPDATE,eventName:"intentiq_error_loading",time:performance.now()})}try{await io(this.instantConfig.icPrebidIntentIQVersion),await ao(this.instantConfig.icPrebidIntentIQVersion,this.instantConfig.icPrebidIntentIQTimeout,e,(t,n)=>{this.enabled=!0,this.intentIqObject=t,this.setTargeting(n),p(A,{type:_.VENDOR_TIME_UPDATE,eventName:"intentiq_loaded",time:performance.now()})})}catch(t){p(A,{type:_.VENDOR_TIME_UPDATE,eventName:"intentiq_error_loading",time:performance.now()}),h({code:Mi,message:"Failed to get intent Iq object instance",priority:c.P3,error:t})}}setTargeting(e){S(this.gptWrapper,"GPT wrapper is not available"),e&&this.gptWrapper&&this.gptWrapper.setTargeting("intent_iq_group",e)}reportPrebidWin(e){if(!this.enabled||!this.intentIqObject)return;const t=Ja(e);this.intentIqObject.reportExternalWin(t)}}const co={propertyId:12974,gamIntegration:!1};class uo extends g{constructor(e,t){super(e);a(this,"name","CaptifyPlugin");a(this,"gptWrapper");a(this,"PROPERTY_ID");a(this,"CAPTIFY_PIXEL_URL");a(this,"gamIntegration",!1);a(this,"isLoaded",!1);a(this,"hooks",{onAdEngineInit:e=>{this.gptWrapper=e.gptWrapper},onConsentUpdated:e=>{w(e)&&this.init()}});this.instantConfig=t;const{propertyId:n=12974,gamIntegration:s=!1}=typeof this.instantConfig.icCaptify=="boolean"?co:this.instantConfig.icCaptify;this.PROPERTY_ID=n,this.CAPTIFY_PIXEL_URL=`https://p.cpx.to/p/${this.PROPERTY_ID}/px.js`,this.gamIntegration=s}static isEnabled(e,t){return!!(t!=null&&t.icCaptify)&&super.isEnabled(e,t)}createCaptifyWindowObject(){const e=`captify_kw_query_${this.PROPERTY_ID}`;window[e]=""}async createAndInsertScript(){try{await _e("captify",{src:this.CAPTIFY_PIXEL_URL,isAsyncOrDeferOtherwise:!1,node:"first"}),this.isLoaded=!0}catch{}}installGAMIntegration(){var n;const e="_cptt",t="_cptte";(n=this.gptWrapper)==null||n.addToCommandQueue(()=>{var d;const s=window.localStorage&&window.localStorage.getItem(e);if(!s){window.localStorage.removeItem(e),window.localStorage.removeItem(t);return}const o=parseInt(window.localStorage.getItem(t));if(!isNaN(o)&&o>Date.now()){const l=JSON.parse(s);for(let u=0,b=Object.keys(l);u<b.length;u++){const v=b[u];(d=this.gptWrapper)==null||d.setTargeting(v,l[v].map(N=>N.toString()))}}})}init(){this.isLoaded||(this.createCaptifyWindowObject(),this.createAndInsertScript(),this.gamIntegration&&this.installGAMIntegration())}}class go extends g{constructor(){super(...arguments);a(this,"name","BrandMetricsPlugin");a(this,"BRAND_METRICS_LIB_URL","//cdn.brandmetrics.com/tag/9097a5369e204e6eac53b45c7dde13c5/fandom.com_au.js");a(this,"firstAdRendered",!1);a(this,"hooks",{onAfterGptWrapperInit:e=>{this.init(e)}})}async loadBrandMetricsScript(){try{await _e("brand-metrics",this.BRAND_METRICS_LIB_URL)}catch{}}static isEnabled(e,t){return!!(t!=null&&t.icBrandMetrics)&&super.isEnabled(e,t)}init(e){const t=()=>{this.firstAdRendered||(this.firstAdRendered=!0,e.removeEventListener("slotRenderEnded",t),this.loadBrandMetricsScript())};e.addEventListener("slotRenderEnded",t)}}const ho="AU_SEG",po="auSegReady";var Q=(r=>(r.MATCHES_SCRIPT_LOADED="audigent_matches_library_loaded",r.MATCHES_SCRIPT_ERROR_LOADING="audigent_matches_library_error_loading",r.SEGMENTS_SCRIPT_LOADED="audigent_segment_library_loaded",r.SEGMENTS_SCRIPT_ERROR_LOADING="audigent_segment_library_error_loading",r.SEGMENTS_READY="audigent_segments_ready",r))(Q||{});const fo="-1",mo="https://a.ad.gt/api/v1/u/matches/158",bo="https://seg.ad.gt/api/v1/s/158";class So extends g{constructor(e,t){super(e);a(this,"name","AudigentPlugin");a(this,"isInitialized",!1);a(this,"segmentsScriptAdded",!1);a(this,"matchesScriptAdded",!1);a(this,"gptWrapper");a(this,"consent",!1);a(this,"hooks",{onConsentUpdated:e=>{this.consent=w(e),this.consent&&this.initialize()},onInitPageTargeting:e=>{this.consent&&(e.AU_SEG=this.getSegments())},onAfterGptWrapperInit:e=>{this.gptWrapper=e,this.updateTargeting()},onAdEngineReset:()=>{this.updateTargeting()}});this.instantConfig=t,this.listenForSegmentUpdates(),this.addSegmentsScript()}static isEnabled(e,t){return!!(t!=null&&t.icAudigent)&&super.isEnabled(e,t)}getDebugState(){var e;return{isInitialized:this.isInitialized,isSegmentsScriptAdded:this.segmentsScriptAdded,isMatchesScriptAdded:this.matchesScriptAdded,segments:((e=window.au_seg)==null?void 0:e.segments)??[]}}sendTracking(e){const t={type:_.VENDOR_TIME_UPDATE,eventName:e,time:performance.now()};p(A,t)}getSegments(){var t;let e=fo;return window.au_seg&&(e=(t=window.au_seg)==null?void 0:t.segments.slice(0,this.instantConfig.icAudigentSegmentLimit)),e}updateTargeting(){if(!this.gptWrapper||!this.consent)return;const e=this.getSegments();this.gptWrapper.setTargeting(ho,e)}listenForSegmentUpdates(){document.addEventListener(po,()=>{this.updateTargeting(),this.sendTracking(Q.SEGMENTS_READY)})}async addSegmentsScript(){if(!this.segmentsScriptAdded)try{await q(bo),this.segmentsScriptAdded=!0,this.sendTracking(Q.SEGMENTS_SCRIPT_LOADED)}catch{this.sendTracking(Q.SEGMENTS_SCRIPT_ERROR_LOADING)}}async addMatchesScript(){if(!(this.matchesScriptAdded||!this.consent))try{await q(mo),this.matchesScriptAdded=!0,this.sendTracking(Q.MATCHES_SCRIPT_LOADED)}catch{this.sendTracking(Q.MATCHES_SCRIPT_ERROR_LOADING)}}async initialize(){this.isInitialized||(this.updateTargeting(),await this.addMatchesScript(),this.isInitialized=!0)}}const de="-1",_o="https://pub.doubleverify.com/signals/pub.json",Eo="28150781",Ao="DV1001654",Rt=window.location.href,To={abs:de,bsc:de,ids:de},Ct=["top_leaderboard","top_boxad","incontent_boxad","bottom_leaderboard","incontent_leaderboard","gallery_leaderboard","featured","incontent_player","mpu_top","mpu-plus-top","cdm-zone-01","cdm-zone-02","cdm-zone-03","cdm-zone-04","cdm-zone-06"];class yo extends g{constructor(){super(...arguments);a(this,"name","DoubleVerifyPlugin");a(this,"adNodeManager");a(this,"gptWrapper");a(this,"consent",!1);a(this,"initialized",!1);a(this,"trackedSlots",{});a(this,"hooks",{onConsentUpdated:e=>{w(e)&&(this.consent=!0,this.initialize())},onAdEngineInit:e=>{this.gptWrapper=e.gptWrapper,this.adNodeManager=e.adNodeManager,this.initialize()},onAdEngineReset:()=>{this.initialized=!1,this.trackedSlots={},this.initialize()}})}getDebugState(){return{isInitialized:this.initialized,trackedSlotNames:Object.keys(this.trackedSlots)}}static isEnabled(e,t){return!!t.icDoubleVerify&&super.isEnabled(e,t)}buildRequestUrl(){const e=new URL(_o),t=e.searchParams;t.set("ctx",Eo),t.set("cmp",Ao),t.set("url",Rt);for(const n of Object.keys(this.trackedSlots))t.append(`adunits[${n}][]`,"");return e}async fetchData(){if(!this.gptWrapper||!this.adNodeManager||!this.consent)return;const e=this.buildRequestUrl();try{const t=await fetch(e,{headers:{referer:Rt}});if(t.status>=400)return;const n=await t.json();this.handleResponse(n)}catch(t){h({message:"Failed to request data from DoubleVerify",error:t,priority:c.P3,code:Di})}}handleResponse(e){const{ABS:t,BSC:n,IDS:s,TVP:o,VLP:d}=e;this.gptWrapper&&(this.gptWrapper.setTargeting("abs",t),this.gptWrapper.setTargeting("bsc",n),this.gptWrapper.setTargeting("ids",s.toString())),this.setTargetingForSlots("tvp",o),this.setTargetingForSlots("vlp",d)}setTargetingForSlots(e,t={}){for(const[n,s]of Object.entries(t)){const o=this.trackedSlots[n];o==null||o.setTargeting(e,s[""])}}initialize(){if(!this.consent||!this.gptWrapper||!this.adNodeManager||this.initialized)return;for(const[t,n]of Object.entries(To))this.gptWrapper.setTargeting(t,n);const e=this.adNodeManager.getAdNodes();for(const t of e){if(!Ct.includes(t.getBaseSlotName())&&!Ct.includes(t.getSlotName()))continue;t.setTargeting("vlp",de),t.setTargeting("tvp",de);const n=t.getAdUnitPath();n?this.trackedSlots[n]=t:m({message:`[DoubleVerifyPlugin] AdUnitPath for ${t.getSlotName()} not defined. Skipping slot`,priority:c.P4,code:fr})}this.initialized=!0,this.fetchData()}}class vo extends g{constructor(){super(...arguments);a(this,"name","InterstitialPlugin");a(this,"gpt");a(this,"hooks",{onAdEngineInit:e=>{if(this.gpt=e.gptWrapper,!this.shouldLoadInterstitial())return;const t=e.adNodeManager.getAdNodeByName("interstitial");t&&this.listenForNonFanTakeoverTopSlotRenderAndRequestInterstitial(e,t,()=>{this.listenForImpressionViewableOnInterstitialAndSetInterstitialImpression(e,t)})}});a(this,"api",{onCeltraInterstitialImpression:()=>{this.setCappingCookieAndInterstitialDisabledTargeting()}})}getDebugState(){var t,n;return{isCappingCookieSet:!!G.get("_ae_intrsttl_imp"),isPageReloaded:this.isPageReloaded(),hasInterstitialDisabledTargeting:((n=(t=this.gpt)==null?void 0:t.getTargeting("bundles"))==null?void 0:n.includes("interstitial_disabled"))??!1}}isPageReloaded(){if(!window.performance)return;const e=performance.getEntriesByType("navigation")[0];return(e==null?void 0:e.type)==="reload"}setCappingCookieAndInterstitialDisabledTargeting(){G.set("_ae_intrsttl_imp","1",{expires:864e5,domain:Ft(),path:"/"}),this.setInterstitialDisabledTargeting()}setInterstitialDisabledTargeting(){if(this.gpt){const e=this.gpt.getTargeting("bundles")||[];e.push("interstitial_disabled"),this.gpt.setTargeting("bundles",e)}}markAnchorTagsWithImgTagsAsInterstitialIneligible(){for(const e of document.querySelectorAll("a"))e.querySelector("img")&&e.setAttribute("data-google-interstitial","false")}shouldLoadInterstitial(){return G.get("_ae_intrsttl_imp")||this.isPageReloaded()?(this.setInterstitialDisabledTargeting(),!1):he()}listenForNonFanTakeoverTopSlotRenderAndRequestInterstitial(e,t,n){const s=e.gptWrapper.addSlotEventListener(M,"slotRenderEnded",o=>{ci(o)||(this.markAnchorTagsWithImgTagsAsInterstitialIneligible(),e.adRenderManager.requestRender([t]),n()),s()})}listenForImpressionViewableOnInterstitialAndSetInterstitialImpression(e,t){const n=e.gptWrapper.addSlotEventListener(t.getSlotName(),"impressionViewable",()=>{this.setCappingCookieAndInterstitialDisabledTargeting(),n()})}}function je(r,i,e){return r===i&&e!==void 0&&e!==null}class Io extends g{constructor(){super(...arguments);a(this,"name","JWPlayerRTDPrebidPlugin");a(this,"JWP_RTD_AUCTION_DELAY",100);a(this,"hooks",{onBiddersInit:()=>{const e=this.usePlugin(y);e==null||e.addPrebidReadyCallback(t=>{t.mergeConfig(this.configureJwpRtd())})},onCreateBidderAdUnit:(e,t,n)=>{je("prebid",e,n)&&n.forEach(s=>{var o;(o=s.mediaTypes)!=null&&o.video&&(s.ortb2Imp=this.extendOrtbWithJwpRtdData(s.ortb2Imp))})}})}static isEnabled(e,t){var n;return!!((n=window.canPlayVideo)!=null&&n.call(window))&&t.icFeaturedVideoPlayer==="jwp-video-player"&&super.isEnabled(e,t)}configureJwpRtd(){const e=this.getMediaId();return{realTimeData:{auctionDelay:this.JWP_RTD_AUCTION_DELAY,dataProviders:[{name:"jwplayer",waitForIt:!0,params:{mediaIDs:e?[e]:[]}}]}}}extendOrtbWithJwpRtdData(e={}){var n;const t=this.getMediaId();return t?{...e,ext:{...e.ext,data:{...((n=e.ext)==null?void 0:n.data)??{},jwTargeting:{mediaID:t}}}}:e}getMediaId(){var n,s,o;if(typeof jwplayer<"u"){const d=(n=jwplayer().getPlaylistItem())==null?void 0:n.mediaid;if(d)return d}const e=ba(),t=(o=(s=e==null?void 0:e.playlist)==null?void 0:s[0])==null?void 0:o.mediaid;return t||m({code:Er,message:"JWPlayerRTDPrebidPlugin: No mediaId found in the featured video config.",priority:c.P3}),t}}const Ro="//cdn.adsafeprotected.com/iasPET.1.js",Co="930616",P="-1",No=["adt","alc","dlm","drg","hat","off","vio"],Nt={fr:P,b_ias:P,"ias-kw":P,adt:P,alc:P,dlm:P,drg:P,hat:P,off:P,vio:P},Pt={veryLow:1,low:2,medium:3,high:4},kt={default:[],fandomdesktop:["top_leaderboard","top_boxad","incontent_boxad","incontent_leaderboard","bottom_leaderboard","gallery_leaderboard","featured","incontent_player"],fandommobile:["top_leaderboard","top_boxad","incontent_boxad","bottom_leaderboard","featured","incontent_player","drawer"],f2:["top_leaderboard","top_boxad","incontent_boxad","bottom_leaderboard","featured"],comicvine:["mpu_top"],gamefaqs:["mpu_top"],gamespot:["mpu_top"],giantbomb:["mpu_top"],metacritic:["mpu_plus_top"],"metacritic-neutron":["mpu-plus-top"],tvguide:["mpu-plus-top"],sports:["cdm-zone-01","cdm-zone-02","cdm-zone-03","cdm-zone-04","cdm-zone-06"]};function fi(r){return Array.isArray(r)?r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"?r:r.length===1&&r[0]==="fluid"?"fluid":Array.isArray(r[0])?fi(r[0]):[1,1]:r==="fluid"?"fluid":[1,1]}class Po extends g{constructor(){super(...arguments);a(this,"name","IasPublisherOptimizationPlugin");a(this,"gptWrapper");a(this,"adNodeManager");a(this,"consent",!1);a(this,"initialized",!1);a(this,"hooks",{onConsentUpdated:e=>{w(e)&&(this.consent=!0,this.initialize())},onBeforeFirstCallAdsRequest:()=>{this.setInitialAdNodesTargeting()},onInitPageTargeting:e=>{Object.assign(e,Nt)},onAdEngineInit:e=>{this.adNodeManager=e.adNodeManager,this.gptWrapper=e.gptWrapper,this.initialize()},onAdEngineReset:()=>{var e,t;this.consent&&((e=this.gptWrapper)==null||e.setTargeting(Nt),(t=window.__iasPET)!=null&&t.queue&&window.__iasPET.queue.push({adSlots:this.getPETSlots(),dataHandler:this.iasDataHandler.bind(this)}))}})}static isEnabled(e,t){return!!t.icIASPublisherOptimization&&super.isEnabled(e,t)}async initialize(){if(!(!this.consent||!this.gptWrapper||!this.adNodeManager||this.initialized))try{this.initialized=!0,this.setup(),await _e("ias-publisher-optimization",Ro)}catch{}}setup(){window.__iasPET=window.__iasPET??{},window.__iasPET.queue=window.__iasPET.queue??[],window.__iasPET.pubId=Co,window.__iasPET.queue.push({adSlots:this.getPETSlots(),dataHandler:this.iasDataHandler.bind(this)})}setInitialAdNodesTargeting(){this.getWatchedAdNodes().forEach(e=>{e.getTargeting("vw").length===0&&e.setTargeting("vw",P)})}getPETSlots(){const e=[];return this.getWatchedAdNodes().forEach(t=>{const n=this.getSlotSize(t),s={adUnitPath:t.getAdUnitPath()??"",adSlotId:t.getSlotName(),size:n};t.getSlotType()==="video"&&(s.type="video",s.size=[1,1]),e.push(s)}),e}getSlotSize(e){const t=e.getDefaultSizes(),n=fi(t);return Array.isArray(n)?n:[1,1]}getWatchedAdNodes(){var t;return(((t=this.adNodeManager)==null?void 0:t.getAdNodes())??[]).filter(n=>this.getWatchedSlotList().includes(n.getSlotName())||this.getWatchedSlotList().includes(n.getBaseSlotName()))}getWatchedSlotList(){return kt[ke()]??kt.default}iasDataHandler(e){try{const t=JSON.parse(e);this.updateGenericTargeting(t),this.updateSlotTargeting(t),this.updateBrandSafetyTargeting(t)}catch(t){h({code:nr,message:"Failed to parse IAS targeting data",error:t,priority:c.P3})}}updateGenericTargeting(e){var s,o;const t={fr:(e==null?void 0:e.fr)??""},n=(s=e.custom)==null?void 0:s["ias-kw"];n&&(t["ias-kw"]=n),(o=this.gptWrapper)==null||o.setTargeting(t)}updateSlotTargeting(e){var t;if(e.slots)for(const[n,s]of Object.entries(e.slots))(t=this.gptWrapper)==null||t.setSlotTargeting(n,"vw",s.vw??s.vw_vv)}updateBrandSafetyTargeting(e){var t;if(e.brandSafety){const n=e.brandSafety;let s;const o={};No.forEach(d=>{n[d]&&(o[d]=n[d],(typeof s>"u"||Pt[s]<Pt[n[d]])&&(s=n[d]))}),o.b_ias=s??P,(t=this.gptWrapper)==null||t.setTargeting(o)}}getDebugState(){var e,t;return{isInitialized:this.initialized,queueItemsCount:((t=(e=window.__iasPET)==null?void 0:e.queue)==null?void 0:t.length)??0}}}function ko(){(function(r,i){r[i]=r[i]||{nlsQ:function(e,t,n,s,o,d){return o=r.document,s=o.createElement("script"),s.defer=1,s.src=(r.location.protocol==="http:"?"http:":"https:")+"//cdn-gl.imrworldwide.com/conf/"+e+".js#name="+t+"&ns="+i,d=o.getElementsByTagName("script")[0],d.parentNode.insertBefore(s,d),r[i][t]=r[i][t]||{g:n||{},ggPM:function(l,u,b,v,N){(r[i][t].q=r[i][t].q||[]).push([l,u,b,v,N])}},r[i][t]}}})(window,"NOLBUNDLE")}class wo extends g{constructor(){super(...arguments);a(this,"name","NielsenPlugin");a(this,"NIELSEN_KEY","P26086A07-C7FB-4124-A679-8AC404198BA7");a(this,"nielsenWindowConfig",{});a(this,"isLoaded",!1);a(this,"gptWrapper");a(this,"consent",!1);a(this,"hooks",{onConsentUpdated:e=>{this.consent=w(e),this.consent&&this.init()},onAfterGptWrapperInit:e=>{this.gptWrapper=e,this.consent&&this.init()}})}getDebugState(){return{isScriptLoaded:this.isLoaded,isDebugModeEnabled:this.nielsenWindowConfig.nol_sdkDebug==="debug"}}static isEnabled(e,t){return!!t.icNielsen&&super.isEnabled(e,t)}getNielsenInstance(){return ko(),H("nielsen-dcr-debug")&&(this.nielsenWindowConfig.nol_sdkDebug="debug"),window==null?void 0:window.NOLBUNDLE.nlsQ(this.NIELSEN_KEY,"nlsnInstance",this.nielsenWindowConfig)}init(){var d,l,u;if(this.isLoaded||!this.gptWrapper)return;const e=this.getNielsenInstance(),t=(d=this.gptWrapper.getTargeting("s0v"))==null?void 0:d.join(","),n=(l=this.gptWrapper.getTargeting("artid"))==null?void 0:l.join(","),s=(u=this.gptWrapper.getTargeting("s1"))==null?void 0:u.join(","),o={type:"static",assetid:`fandom.com/${t}/${s}/${n}`,section:`FANDOM ${t==null?void 0:t.replace(/_/g," ").toUpperCase()} NETWORK`};e.ggPM("static",o),this.isLoaded=!0}}const Pe=class Pe extends g{constructor(){super(...arguments);a(this,"name","BlockthroughReadershipLinkPlugin");a(this,"isInitialized",!1);a(this,"adEngine",null);a(this,"hooks",{onConsentUpdated:e=>{w(e)&&this.initialize()},onAdEngineInit:e=>{this.adEngine=e},onBeforeAdsRequest:e=>{var s;const t=(s=this.adEngine)==null?void 0:s.monetizationTierEngine;if(!t){h({code:rr,message:"Monetization tier engine is not available, cannot add Blockthrough readership link classes",priority:c.P2});return}const n=`tier${t.getCurrentTier()}`;for(const o of e){const d=o.getElement();d&&!d.classList.contains(n)&&d.classList.add(n)}}})}static isEnabled(e,t){return oe()!==Ie?!1:!!t.icBlockthroughReadershipLink&&super.isEnabled(e,t)}adjustPrebidAdserverTargetingConfig(){var e;(e=this.usePlugin(y))==null||e.addPrebidReadyCallback(t=>{t.bidderSettings=Xe(t.bidderSettings,us)})}async initialize(){if(!this.isInitialized){this.isInitialized=!0;try{p(A,{type:_.VENDOR_TIME_UPDATE,eventName:"bt-loader_started",time:performance.now()}),this.adjustPrebidAdserverTargetingConfig(),await q(Pe.SCRIPT_URL),p(A,{type:_.VENDOR_TIME_UPDATE,eventName:"bt-loader_loaded",time:performance.now()})}catch{p(A,{type:_.VENDOR_TIME_UPDATE,eventName:"bt-loader_error_loading",time:performance.now()})}}}};a(Pe,"SCRIPT_URL","https://btloader.com/tag?o=5199505043488768&upapi=true");let Ke=Pe;class Lo extends g{constructor(e){super(e);a(this,"name","AdLabelPlugin");a(this,"translatedAdLabel");a(this,"excludedSlots",new Set(["top_leaderboard","floor_adhesion","left_panel_ad","mobile_drawer_ad"]));a(this,"hooks",{onAdEngineInit:e=>{this.registerSlotRenderHandler(e.gptWrapper)}});a(this,"api",{addLabelToSlot:e=>{this.addLabelToSlot(e)}});const t=document.querySelector(".ae-translatable-label");this.translatedAdLabel=t instanceof HTMLElement?t:null}addLabelToSlot(e){if(this.excludedSlots.has(e))return;const t=document.getElementById(e);if(!t||!this.translatedAdLabel)return;const n=`label-${e}`;if(document.getElementById(n))return;const s=this.cloneTranslatedLabel(n);t.appendChild(s)}registerSlotRenderHandler(e){e.addEventListener("slotRenderEnded",t=>{const n=t.slot.getSlotElementId();t.isEmpty||this.addLabelToSlot(n)})}cloneTranslatedLabel(e){const t=this.translatedAdLabel.cloneNode(!0);t.classList.remove("dsa-advertisement-label-clickable"),t.id=e;const n=t.querySelector(".dsa-advertisement-label-icon");return n==null||n.remove(),t}getDebugState(){return{hasTranslatedLabel:!!this.translatedAdLabel,excludedSlotNames:Array.from(this.excludedSlots)}}}class Do extends g{constructor(e,t){super(e);a(this,"name","PrebidIdSyncingPlugin");a(this,"YAHOO_BIT",0);a(this,"ID5_BIT",1);a(this,"HEM_BIT",2);a(this,"LIVEINTENT_BIT",3);a(this,"PUBCID_BIT",4);a(this,"UID2_BIT",5);a(this,"LIVE_RAMP_ATS_BIT",6);a(this,"UID_BIT",7);a(this,"BIT_PLACEHOLDER","x");a(this,"ID_STRING_LENGTH",16);a(this,"PRESENT_PLACEHOLDER","P");a(this,"ABSENT_PLACEHOLDER","A");a(this,"LIVE_CONNECT_PLACEHOLDER","L");a(this,"MEDIA_WIKI_PLACEHOLDER","M");a(this,"pbjs");a(this,"ID_MAP",{[this.YAHOO_BIT]:e=>this.getDefaultBitStatus(e,"yahoo.com"),[this.ID5_BIT]:e=>this.getDefaultBitStatus(e,"id5-sync.com"),[this.HEM_BIT]:()=>this.getHEMBitStatus(),[this.LIVEINTENT_BIT]:e=>this.getDefaultBitStatus(e,"liveintent.com"),[this.PUBCID_BIT]:e=>this.getDefaultBitStatus(e,"pubcid.org"),[this.UID2_BIT]:e=>this.getDefaultBitStatus(e,"uidapi.com"),[this.LIVE_RAMP_ATS_BIT]:e=>this.getDefaultBitStatus(e,"liveramp.com"),[this.UID_BIT]:e=>this.getDefaultBitStatus(e,"adserver.org")});a(this,"hooks",{onBiddersInit:e=>{var t;this.configureLiveIntentTargeting(e),(t=this.usePlugin(y))==null||t.addPrebidReadyCallback(n=>{this.pbjs=n,this.pbjs.onEvent("requestBids",()=>{this.generateBoiAndSyncGptTargeting(e),this.updateLiveIntentTargeting(e)})})}});this.instantConfig=t}getDebugState(){return{boiString:this.generateBoiString()}}getDefaultBitStatus(e,t){return e.find(n=>n.source===t)?this.PRESENT_PLACEHOLDER:this.ABSENT_PLACEHOLDER}getHEMBitStatus(){var e,t,n;switch(!0){case this.checkIfLiveConnectSha2HEMIsPresent():return this.LIVE_CONNECT_PLACEHOLDER;case!!((n=(t=(e=Kt())==null?void 0:e.opts)==null?void 0:t.userEmailHashes)!=null&&n.length):return this.MEDIA_WIKI_PLACEHOLDER;default:return this.ABSENT_PLACEHOLDER}}configureLiveIntentTargeting(e){var s;const t=this.instantConfig.icLiveIntentConnectedId,n=t?"t1":"t0";if((s=e.gptWrapper)==null||s.setTargeting("li-module-enabled",[n]),!t){window.liModuleEnabled=!1;return}window.liModuleEnabled=!0}updateLiveIntentTargeting(e){var n;if(!this.instantConfig.icLiveIntentConnectedId)return;const t=this.getIds().some(s=>s.source.includes("liveintent.com"));(n=e.gptWrapper)==null||n.setTargeting("li-module-enabled",[`t1-${t?"e1":"e0"}`])}getIds(){var e;return((e=this.pbjs)==null?void 0:e.getUserIdsAsEids())??[]}generateBoiString(){const e=this.getIds();let t="";for(let n=0;n<this.ID_STRING_LENGTH;n++){const s=this.ID_MAP[n];if(s){const o=s(e);t+=o}else t+=this.BIT_PLACEHOLDER}return t}generateBoiAndSyncGptTargeting(e){const t=this.generateBoiString();e.gptWrapper.setTargeting("boi",t),this.getIds().forEach(n=>{var s;(s=n.uids[0])!=null&&s.id&&p(Qe.IDENTITY_INFO,{partnerName:n.source,partnerIdentityId:n.uids[0].id})})}checkIfLiveConnectSha2HEMIsPresent(){var e;try{return((e=this.usePlugin($))==null?void 0:e.checkIfSha2HemAvailable())??!1}catch{return!1}}}function fe(r,i){const e=Object.entries(r);return!r||e.length===0?[]:e.reduce((t,[n,s])=>{const o=mi(n,i),{instantConfig:d}=i;return s!=null&&s.isEnabled(o,d)&&(o==null?void 0:o.enabled)!==!1&&t.push(new s(o,d)),t},[])}function mi(r,i){var e;return((e=i==null?void 0:i.plugins)==null?void 0:e[r])??{}}class Fo{constructor(i,e){a(this,"experimentPluginMap",new Map);this.pluginClasses=i;const t=this.identifyActiveExperiment();if(!t)return;const n=Object.entries(i);for(const[s,o]of n){const d=mi(s,e);if(o.experimentName==t.name&&o.isEnabled(d,e.instantConfig)){const l=new o(d,e.instantConfig);l.setExperimentGroup(t.group),this.experimentPluginMap.set(l.experimentName,l)}}}checkExpiration(i){const e=i.codeDeletionDate;new Date().getTime()>=e.getTime()&&m({code:Pr,message:`Experiment ${i.experimentName} has passed its codeDeletionDate`,priority:c.P4})}identifyActiveExperiment(){const i=we("force-sse");if(i){const e=li(i);if(e)return e}return Ea()}getExperimentPlugins(){return[...this.experimentPluginMap.values()]}}const Ve="control";class bi extends g{constructor(e){super(e);a(this,"experimentName");a(this,"currentGroup",Ve);this.experimentName=this.constructor.experimentName}getDebugState(){return{experimentName:this.experimentName,currentGroup:this.currentGroup,variantNames:[...this.variantNames],codeDeletionDate:this.codeDeletionDate.toISOString()}}setExperimentGroup(e){[Ve].concat(this.variantNames).includes(e)?this.currentGroup=e:(h({code:Ki,message:`Unknown experiment group "${e}" set for ${this.experimentName}; defaulting to control`,priority:c.P2}),this.currentGroup=Ve)}}a(bi,"experimentName","missing");class Si extends bi{constructor(){super(...arguments);a(this,"name","ExpMuse15427");a(this,"variantNames",["variant1"]);a(this,"codeDeletionDate",new Date("2026-01-31"));a(this,"slotsToRemoveByApp",{fandomdesktop:["bottom_leaderboard","mid_boxad"],fandommobile:["bottom_leaderboard","floor_adhesion"]});a(this,"hooks",{onInitSlotConfigMap:e=>{var s;if(this.currentGroup!=="variant1")return;const{app:t,baseSlots:n}=e;(s=this.slotsToRemoveByApp[t])==null||s.forEach(o=>{n[o]&&(n[o].isFirstCall=!1)})}})}}a(Si,"experimentName","muse-15427");const Oo="https://ats-wrapper.privacymanager.io/ats-modules/2be88350-78eb-4214-96b8-3a489d2aa7d6/ats.js";class Bo extends g{constructor(){super(...arguments);a(this,"name","LiveRampATSPlugin");a(this,"initialized",!1);a(this,"isScriptLoaded",!1);a(this,"hooks",{onConsentUpdated:e=>{if(!w(e)){this.shouldClearEnvelope(e)&&this.processOptOut();return}this.initialize()},onAdEngineReset:()=>{const e=this.usePlugin($);e&&this.processHems(e).catch(t=>{m({code:vr,message:"LiveRamp ATS re-processing HEMs failed",priority:c.P3,error:t})})}})}static isEnabled(e,t){return!!t.icPrebidLiveRampATS&&super.isEnabled(e,t)}async initialize(){if(!this.initialized){this.initialized=!0;try{const e=this.usePlugin($);if(!e)return;await this.loadScript(),await this.processHems(e)}catch(e){m({code:Tr,message:"LiveRamp ATS initialization failed",priority:c.P3,error:e})}}}async loadScript(){if(!this.isScriptLoaded)try{this.isScriptLoaded=!0,await q({src:Oo,isAsyncOrDeferOtherwise:!0,node:"first"})}catch(e){this.isScriptLoaded=!1,m({code:yr,message:"LiveRamp ATS script failed to load",priority:c.P3,error:e})}}async processHems(e){const t=await e.waitForHems();if(!t)return;const n=[t.sha1,t.sha2,t.md5].filter(o=>!!o);if(n.length===0)return;this.setupLrEnvelopePresentListener(),(await this.getAtsModule()).setAdditionalData({type:"emailHashes",id:n})}getAtsModule(){return new Promise(e=>{if(window.atsenvelopemodule)return e(window.atsenvelopemodule);window.addEventListener("envelopeModuleReady",()=>{e(window.atsenvelopemodule)},{once:!0})})}setupLrEnvelopePresentListener(){window.addEventListener("lrEnvelopePresent",()=>{const e=this.usePlugin(y);e==null||e.addPrebidReadyCallback(t=>{t.refreshUserIds({submoduleNames:[ei]})})},{once:!0})}shouldClearEnvelope(e){return(e==null?void 0:e.consentApi)==="usp"}async processOptOut(){await this.loadScript(),(await this.getAtsModule()).invalidateEnvelope(),this.initialized=!1}}const Mo=r=>r.getEvents().some(i=>{var e,t;return i.eventType==="auctionDebug"&&((e=i.args)==null?void 0:e.type)==="WARNING"&&typeof((t=i.args)==null?void 0:t.arguments)<"u"&&[...i.args.arguments].some(n=>String(n).includes("TCF timeout waiting for CMP to load"))}),xo=()=>typeof window.OneTrust<"u"&&typeof window.OneTrust.geolocationResponse=="object"&&typeof window.OneTrust.UpdateConsent=="function",ue=class ue extends g{constructor(e,t){super(e);a(this,"name","AuctionCmpTrackingPlugin");a(this,"state",{cmpApiAvailable:!1,oneTrustAvailable:!1,auctionStarted:!1,auctionTimedOut:0,adsRendered:!1,numberOfIdPartners:0});a(this,"trackingSent",!1);a(this,"cleanup",()=>{});a(this,"hooks",{onBiddersInit:()=>{var e;this.enabled&&(this.setTimeoutForTracking(),(e=this.usePlugin(y))==null||e.addPrebidReadyCallback(t=>{t.onEvent("auctionInit",()=>{this.setTimeoutForTracking(),this.state.cmpApiAvailable=!Mo(t),this.state.oneTrustAvailable=xo(),this.state.auctionStarted=!0}),t.onEvent("auctionTimeout",()=>{this.setTimeoutForTracking(),this.state.auctionTimedOut=1}),t.onEvent("auctionEnd",()=>{this.setTimeoutForTracking(),this.state.numberOfIdPartners=t.getUserIdsAsEids().length})}))},onFirstRenderCycleComplete:(e,t)=>{this.enabled&&(this.state.adsRendered=t.length>0,this.trackingSent||(this.cleanup(),this.sendTracking()))}});this.instantConfig=t}get enabled(){return!!this.instantConfig.odysseyAuctionCmpTracking}setTimeoutForTracking(e=2*this.instantConfig.icAdEngineAuctionTimeoutMS){this.cleanup();const t=setTimeout(()=>{this.trackingSent||(this.state.auctionTimedOut=2,this.sendTracking())},e);this.cleanup=()=>clearTimeout(t)}getConsentRegion(){var t;const e=(t=window.fandomCmp)==null?void 0:t.consentApi;return e==="usp"?"US":e==="tcf"?"EU":"RoW"}encodeState(){return Object.values(this.state).map(e=>typeof e=="boolean"?Number(e):e).join(",")}sendTracking(){this.enabled&&(this.trackingSent=!0,p(Ut.TRACKING_EVENT,{event_type:ue.TRACKING_EVENT_NAME,ga_category:ue.TRACKING_EVENT_NAME,ga_label:this.getConsentRegion(),ga_value:this.encodeState()}))}getDebugState(){return{isEnabled:this.enabled,hasTrackingSent:this.trackingSent,cmpApiAvailable:this.state.cmpApiAvailable,oneTrustAvailable:this.state.oneTrustAvailable,hasAuctionStarted:this.state.auctionStarted,auctionTimeoutStatus:this.state.auctionTimedOut,hasAdsRendered:this.state.adsRendered,numberOfIdPartners:this.state.numberOfIdPartners,consentRegion:this.getConsentRegion(),encodedState:this.encodeState()}}};a(ue,"TRACKING_EVENT_NAME","odyssey_cmp_tracking");let Ye=ue;const Uo={fandomdesktop:["incontent_leaderboard","bottom_leaderboard","floor_adhesion","lightbox_leaderboard","mid_boxad","left_panel_ad","featured","incontent_player"],fandommobile:["incontent_boxad","bottom_leaderboard","interstitial","lightbox_leaderboard","mobile_drawer_ad","featured","incontent_player"]};function Vo(r){r.bundles=r.bundles??[],r.bundles.includes("exclusion_list")||r.bundles.push("exclusion_list")}class Wo extends g{constructor(e){super(e);a(this,"name","RegisteredUserPlugin");a(this,"config");a(this,"adEngine");a(this,"removedSlots",[]);a(this,"hooks",{onInitSlotConfigMap:e=>{const t=oe();if(t===Ie)return;const n=this.handleAdNodeCreationError.bind(this);window.addEventListener("error",n),t===In?(this.removeSlotsForRegisteredUsers(e),this.removeAdsWhenCommentsEnterViewport(e)):t===Rn&&this.removeAllSlots(e)},onInitPageTargeting:e=>{oe()!==Ie&&Vo(e)},onAdEngineInit:e=>{this.adEngine=e}});this.config=Uo}getDebugState(){return{config:this.config,removedSlots:this.removedSlots,userState:oe()}}handleAdNodeCreationError(e){const t=e.message.match(/AdNode for element with id\[(.*)\] could not be created./);if(!t)return;const n=t[1],s=J(n);if(this.wasSlotRemoved(s)){e.preventDefault();return}}removeSlots(e,t){t.forEach(n=>{e.baseSlots[n]?e.baseSlots[n].enabled=!1:e.videoSlots[n]&&(e.videoSlots[n].enabled=!1),this.removedSlots.push(n)}),this.removeAdNodes(t)}removeSlotsForRegisteredUsers(e){const{app:t}=e,n=this.config[t];this.removeSlots(e,n)}removeAllSlots(e){const t=[...Object.keys(e.baseSlots),...Object.keys(e.videoSlots)];this.removeSlots(e,t)}removeAdNodes(e){if(e.some(n=>J(n)==="top_leaderboard")&&(this.removeTopLeaderboardWrapper(),e=e.filter(n=>J(n)!=="top_leaderboard")),this.adEngine){e.forEach(n=>{const s=this.adEngine.adNodeManager.getAdNodeByName(n);s&&(s.collapse(),this.adEngine.adNodeManager.removeAdNode(s))});return}e.forEach(n=>{document.querySelectorAll(`${T.ELEMENT_NAME}#${n}, ${L.ELEMENT_NAME}#${n}`).forEach(s=>{s.remove()})})}getCommentsAndDiscussionsContainers(){return["#articleComments",".article-comments-collapsible-menu","#article-discussions"].map(n=>document.querySelector(n)).filter(n=>n!==null)}removeAdsWhenCommentsEnterViewport(e){const t=this.getCommentsAndDiscussionsContainers();if(t.length===0)return;if(t.find(o=>Ze(o,100))){this.removeAllSlots(e);return}const n={root:null,rootMargin:"100px 0px 100px 0px",threshold:0},s=new IntersectionObserver(o=>{o.forEach(d=>{d.isIntersecting&&(this.removeAllSlots(e),s.disconnect())})},n);t.forEach(o=>s.observe(o))}removeTopLeaderboardWrapper(){var e;(e=document.querySelector(".top_leaderboard-odyssey-wrapper"))==null||e.remove()}wasSlotRemoved(e){return!!this.removedSlots.find(t=>t===e)}}const zo=[{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"floor_adhesion",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.46},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"incontent_boxad",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.27},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"incontent_boxad",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.35},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"floor_adhesion",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.25},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"top_leaderboard",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.3},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"bottom_leaderboard",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.22},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"mid_boxad",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.24},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"top_leaderboard",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.26},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"incontent_boxad",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.16},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"top_boxad",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.25},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"top_boxad",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.39},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"incontent_boxad",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.19},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"incontent_leaderboard",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.24},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"bottom_leaderboard",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.18},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"bottom_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.13},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"top_boxad",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.19},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"top_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.2},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"top_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.14},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"top_boxad",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.17},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"incontent_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.17},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"mid_boxad",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.16},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"lightbox_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.2},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"bottom_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.14},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"floor_adhesion",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.25},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"lightbox_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.24},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"incontent_boxad",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.14},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"floor_adhesion",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.21},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"incontent_boxad",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.13},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"top_leaderboard",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.17},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"mid_boxad",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.12},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"incontent_boxad",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.14},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"top_boxad",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.12},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"top_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.16},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"incontent_leaderboard",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.12},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"incontent_boxad",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.12},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"top_boxad",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.18},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"bottom_leaderboard",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.13},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"incontent_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.1},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"top_boxad",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.11},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"mid_boxad",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.11},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"top_leaderboard",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.11},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"top_boxad",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.14},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"bottom_leaderboard",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.1},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"lightbox_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.17},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"bottom_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.1},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"lightbox_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.13},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"top_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.1},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"bottom_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.1},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"incontent_leaderboard",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.23},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"mid_boxad",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.2},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"incontent_leaderboard",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.15},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"floor_adhesion",tier:"4",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.41},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"mid_boxad",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.14},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"floor_adhesion",tier:"3",pageStrategy:"tlf_5perc_v01"},calculateFloor:()=>.25},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"floor_adhesion",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.64},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"incontent_boxad",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.39},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"incontent_boxad",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.47},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"floor_adhesion",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.34},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"top_leaderboard",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.4},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"bottom_leaderboard",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.3},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"mid_boxad",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.33},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"top_leaderboard",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.36},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"incontent_boxad",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.2},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"top_boxad",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.35},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"top_boxad",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.58},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"incontent_boxad",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.22},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"incontent_leaderboard",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.31},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"bottom_leaderboard",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.25},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"bottom_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.16},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"top_boxad",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.24},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"top_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.26},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"top_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.16},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"top_boxad",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.21},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"incontent_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.2},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"mid_boxad",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.19},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"lightbox_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.25},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"bottom_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.17},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"floor_adhesion",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.31},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"lightbox_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.31},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"incontent_boxad",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.19},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"floor_adhesion",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.26},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"incontent_boxad",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.16},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"top_leaderboard",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.24},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"mid_boxad",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.16},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"incontent_boxad",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.2},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"top_boxad",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.16},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"top_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.23},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"incontent_leaderboard",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.15},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"incontent_boxad",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.15},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"top_boxad",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.26},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"bottom_leaderboard",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.17},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"incontent_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.12},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"top_boxad",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.13},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"mid_boxad",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.13},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"top_leaderboard",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.15},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"top_boxad",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.19},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"bottom_leaderboard",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.13},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"lightbox_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.24},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"bottom_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.11},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"lightbox_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.17},{criteria:{geo:"au",skin:"ucp_mobile",baseSlotName:"top_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.11},{criteria:{geo:"au",skin:"ucp_desktop",baseSlotName:"bottom_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.11},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"incontent_leaderboard",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.33},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"mid_boxad",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.26},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"incontent_leaderboard",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.18},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"floor_adhesion",tier:"4",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.56},{criteria:{geo:"us",skin:"ucp_mobile",baseSlotName:"mid_boxad",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.17},{criteria:{geo:"us",skin:"ucp_desktop",baseSlotName:"floor_adhesion",tier:"3",pageStrategy:"tlf_10perc_v01"},calculateFloor:()=>.35}];function Go(r,i,e){const t={"*":Je.data.default};for(const n of i){const s=n.getSlotName(),o=Ho(n,r);o&&(t[s]=o.calculateFloor(e))}return t}function _i(r,i){const e=r.gptWrapper.getAllTargeting({raw:!0});return zo.filter(n=>{const s=X(n.criteria.tier,e.tier[0]),o=X(n.criteria.geo,e.geo[0]),d=X(n.criteria.skin,e.skin[0]),l=i===void 0||X(n.criteria.pageStrategy,i);return s&&o&&l&&d})}function Ho(r,i){const e=r.getBaseSlotName(),t=i.filter(n=>X(n.criteria.baseSlotName,e));if(t.length!==0)return t.length>1&&h({code:Fi,message:`DynamicPriceFloor: Unexpected number of matching dynamic floor configs for this slot ${e}`,priority:c.P3}),t[0]}const ee="ay_floor",me="ay_floor_g",Ce="f_hb_floor",qo="hb_pb";function wt(r,i,e){if(r<=1||r>=3.5)return r;const t=Number((r-e).toFixed(2)),n=Number((t%i).toFixed(2));return n===i?r:Number((r-n).toFixed(2))}function Ei(r){let i;return r>=3.5?i=3.5:r>=2?i=wt(r,.03,2):r>=1?i=wt(r,.02,1):r>=0?i=r:i=0,i.toFixed(2)}function $o(r){var n,s;const i=parseFloat((n=r.getTargeting(qo))==null?void 0:n[0]);if(isNaN(i))return;const e=parseFloat((s=r.getTargeting(ee))==null?void 0:s[0]);if(i<e)return;const t=Ei(i);r.clearTargeting(ee),r.clearTargeting(me),r.setTargeting(ee,t),r.setTargeting(me,"beatPrebid")}function jo(r,i){const e=r.getSlotName(),t=i[e];if(t){r.clearTargeting(ee),r.clearTargeting(me),r.clearTargeting(Ce);const n=Ei(t);r.setTargeting(ee,n),r.setTargeting(me,"getFloors"),r.setTargeting(Ce,t.toFixed(2))}}function Ko(r){let i=5381;for(let e=0;e<r.length;e++){const t=r.charCodeAt(e);i=(i<<5)+i+t,i|=0}return(i>>>0).toString(16)}function Yo(r){const i=["geo","monetization","tier","skin"].map(e=>{const t=r[e],n=Array.isArray(t)?t.sort().join(","):t;return`${e}=${n}`}).join("&");return{targetingStr:i,hash:Ko(i)}}const Qo=[{floorStrategy:"fndm_0",buckets:["47","51","66","70","74","78","82","86","90","94"]},{floorStrategy:"fndm_0",buckets:["49","53","68","72","76","80","84","88","92","96"]},{floorStrategy:"tlf_5perc_v01",buckets:["48","52","67","71","75","79","83","87","91","95"]},{floorStrategy:"tlf_10perc_v01",buckets:["50","54","69","73","77","81","85","89","93","97"]}];function Xo(r){if(!r.icDynamicFloorStrategies.tlf||!Zo(r.adEngine))return!1;const i=ed(r.adEngine),e=Ot(),t=Jo(i,e);return t?{testGroup:"tlf",floorStrategy:t}:{testGroup:"tlf_nobucket",floorStrategy:"fndm_0"}}function Zo(r){return _i(r).length>0}function Jo(r,i){if(i==="")return!1;for(const e of Qo)if((X(r,"us")?e.buckets.slice(0,3):e.buckets).includes(i))return e.floorStrategy;return!1}function ed(r){return r.gptWrapper.getTargeting("geo")[0]}const td=["ctrl","fndm_0","tlf_5perc_v01","tlf_10perc_v01"],id=[nd,Xo];function rd(r,i){for(const e of id){const t=e({icDynamicFloorStrategies:r,adEngine:i});if(t)return t}return{testGroup:"none",floorStrategy:"fndm_0"}}function nd(r){const i=we("dyn_flr_src");if(i){if(td.includes(i))return{testGroup:"query_override",floorStrategy:i};console.error("Unsupported query param used for dyn_flr_src")}return!1}class sd extends g{constructor(e,t){super(e);a(this,"name","DynamicPriceFloorPlugin");a(this,"floorStrategy");a(this,"testGroup");a(this,"initialized",!1);a(this,"adEngine");a(this,"floorValues");a(this,"cohortHashResult");a(this,"icDynamicFloorStrategies");a(this,"tlbBidPrice");a(this,"targetingDebugStates",[]);a(this,"hooks",{onAdEngineInit:e=>{this.adEngine=e;const{testGroup:t,floorStrategy:n}=rd(this.icDynamicFloorStrategies,e);this.testGroup=t,this.floorStrategy=n,this.trackBidsReceived(),this.initialized=!0,this.setCohortHash(),this.calculateFloors(),this.setPrebidFloorConfig(),this.scheduleBeatPrebidTargeting(),e.gptWrapper.setTargeting({dyn_floor_src:this.floorStrategy,dyn_ads_test:this.testGroup}),this.setDynAdsRand()},onConsentUpdated:()=>{this.adEngine&&(this.setCohortHash(),this.calculateFloors(),this.setPrebidFloorConfig())},onBeforeAdsRequest:e=>{e.forEach(t=>{this.targetingDebugStates.push({slotName:t.getSlotName(),hb_pb:t.getTargeting("hb_pb")[0],ay_floor:t.getTargeting("ay_floor")[0],ay_floor_g:t.getTargeting("ay_floor_g")[0],f_hb_floor:t.getTargeting(Ce)[0]})})},onCreateBidderAdUnit:(e,t,n)=>{if(je("prebid",e,n))for(const s of n)this.resetFloorKeyValues(s);je("a9",e,n)&&this.setA9FloorOnAuction(n)}});this.icDynamicFloorStrategies={beatPrebid:!0,tlf:!1,...t.icDynamicFloorStrategies}}static isEnabled(e,t){return!!(t!=null&&t.icDynamicFloorEnabled)&&super.isEnabled(e,t)}getDebugState(){return{icDynamicFloorStrategies:{...this.icDynamicFloorStrategies},testGroup:this.testGroup,floorStrategy:this.floorStrategy,tlbBidPrice:this.tlbBidPrice,floorValues:{...this.floorValues},cohortHashResult:{...this.cohortHashResult},targetingDebugStates:this.targetingDebugStates}}calculateFloors(){if(!this.isGetFloorsEligible())return;const e=_i(this.adEngine,this.floorStrategy),t=this.adEngine.adNodeManager.getAdNodes();this.floorValues=Go(e,t,this.tlbBidPrice)}setPrebidFloorConfig(){if(!this.isGetFloorsEligible())return;if(!this.floorValues){h({code:Oi,message:"Expected floorValues to already be calculated",priority:c.P3});return}const e=this.usePlugin(y);e==null||e.addPrebidReadyCallback(t=>{t.setConfig({floors:{data:{...Je.data,schema:{fields:["adUnitCode"]},values:this.floorValues}}})})}isGetFloorsEligible(){return!(!this.initialized||["ctrl","fndm_0"].includes(this.floorStrategy))}setA9FloorOnAuction(e){this.isGetFloorsEligible()&&this.floorValues&&e.slots.forEach(t=>{var s,o;let n=((s=this.floorValues)==null?void 0:s[t.slotID])??((o=this.floorValues)==null?void 0:o["*"])??void 0;n?n=Math.round(n*100):n=Yt,t.floor={currency:"USD",value:n}})}trackBidsReceived(){var e;(e=this.usePlugin(y))==null||e.addPrebidReadyCallback(t=>{t.onEvent("auctionEnd",n=>{this.tlbBidPrice===void 0&&(n.bidsReceived.forEach(s=>{s.adUnitCode==="top_leaderboard"&&(this.tlbBidPrice=Math.max(this.tlbBidPrice??0,s.cpm))}),this.tlbBidPrice!==void 0&&(this.calculateFloors(),this.setPrebidFloorConfig()))})})}scheduleBeatPrebidTargeting(){var e;["ctrl"].includes(this.floorStrategy)||(e=this.usePlugin(y))==null||e.addPrebidReadyCallback(t=>{t.onEvent("setTargeting",n=>{Object.keys(n).forEach(s=>{const o=this.adEngine.adNodeManager.getAdNodeByName(s);o&&$o(o)})})})}resetFloorKeyValues(e){const t=this.adEngine.adNodeManager.getAdNodeByName(e.code);t&&(t.clearTargeting(ee),t.clearTargeting(me),t.clearTargeting(Ce),this.isGetFloorsEligible()&&this.floorValues&&jo(t,this.floorValues))}setCohortHash(){if(!this.adEngine){h({code:Bi,priority:c.P3,message:"dyn_ads_cohort attempted to be set without this.adEngine"});return}this.cohortHashResult=Yo(this.adEngine.gptWrapper.getAllTargeting({raw:!0})),this.adEngine.gptWrapper.setTargeting({dyn_ads_cohort:this.cohortHashResult.hash})}setDynAdsRand(){const e=Math.floor(Math.random()*100).toString().padStart(2,"0");this.adEngine.gptWrapper.setTargeting({dyn_ads_rand:e})}}function ad(r){return fe({A9Plugin:aa,AudigentPlugin:So,BlockthroughReadershipLinkPlugin:Ke,BrandMetricsPlugin:go,CaptifyPlugin:uo,ConfiantPlugin:Qa,DoubleVerifyPlugin:yo,IasPublisherOptimizationPlugin:Po,IntentIqPlugin:lo,LiveConnectPlugin:$,LiveRampATSPlugin:Bo,LotamePlugin:Ya,NielsenPlugin:wo},r)}function od(r){return fe({ConsentManagementPrebidPlugin:oa,PrebidPlugin:y,ServerToServerPlugin:wa,PrebidIdSyncingPlugin:Do,JWPlayerRTDPrebidPlugin:Io},r)}function dd(r){return fe({DynamicPriceFloorPlugin:sd},r)}async function ld(){const{config:r,activeLabradorKeyValues:i}=await Ht(),e=await Vn(r,i,ke()),t=Object.fromEntries(fe({InterstitialPlugin:vo,FloorAdhesionPlugin:oi,TopStrategyTunerPlugin:ja,SlotRefresherPlugin:pe,VastUrlPlugin:$e,LightboxLeaderboardPlugin:Ka,InContentPlayerPlugin:ui,InContentLeaderboardPlugin:Re,PageLevelTargetingPlugin:ya},e).map(u=>[u.name,u])),n=new Fo({ExpMuse15427:Si},e),s=[...Object.values(t),...fe({TrackingPlugin:ni,AuctionCmpTrackingPlugin:Ye,HeavyAdsDetectionPlugin:ii,DynamicSlotPlugin:ga,FandomTaxonomyPlugin:Zt,PerformanceTestPlugin:va,AdLabelPlugin:Lo,RepeatableSlotsPlugin:Ca,DigitalServicesActPlugin:da,OpenRtbPlugin:et,RegisteredUserPlugin:Wo},e),...dd(e),...od(e),...ad(e),...n.getExperimentPlugins(),...await en()],o=new Map(s.map(u=>[u.constructor,u]));s.forEach(u=>{u.setPlugins(o)}),performance.mark(R.AE_AFTER_INIT_PLUGINS);const d={flags:i};p(Mt.LABRADOR_KEYVALUES,d);const l=await Bn(e,s);return l.start(),{exposedPlugins:t,adEngine:l}}function cd(r,i,...e){const t=document.createElement(r);return i&&Object.keys(i).forEach(n=>{n.startsWith("on")?t.addEventListener(n.slice(2).toLowerCase(),i[n]):n==="ref"?i[n].current=t:t[n]=i[n]}),t.append(...e.filter(n=>!!n)),t}window.jsxRenderer=cd;function ud(){typeof Promise.withResolvers!="function"&&(Promise.withResolvers=()=>{let r,i;return{promise:new Promise((t,n)=>{r=t,i=n}),resolve:r,reject:i}})}ud();performance.mark(R.AE_FIRST_LINE_EXEC);ld().then(({exposedPlugins:r,adEngine:i})=>{var e;window.fandomAds=new Qr(r,i,(e=window.fandomAds)==null?void 0:e.cmd)}).catch(r=>{h({code:sr,message:"Failed to load ad engine",priority:c.P1,error:r})});export{g as A,c as I,E as M,y as P,zt as U,hd as V,k as _,H as a,Ft as b,G as c,he as d,la as e,Da as f,we as g,Ee as h,S as i,nn as j,Lt as k,Xe as m,h as r};
//# sourceMappingURL=main.js.map
